/*!
 * jQuery JavaScript Library v1.4.2
 * http://jquery.com/
 *
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2010, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Sat Feb 13 22:33:48 2010 -0500
 */
(function(A,w){function ma(){if(!c.isReady){try{s.documentElement.doScroll("left")}catch(a){setTimeout(ma,1);return}c.ready()}}function Qa(a,b){b.src?c.ajax({url:b.src,async:false,dataType:"script"}):c.globalEval(b.text||b.textContent||b.innerHTML||"");b.parentNode&&b.parentNode.removeChild(b)}function X(a,b,d,f,e,j){var i=a.length;if(typeof b==="object"){for(var o in b)X(a,o,b[o],f,e,d);return a}if(d!==w){f=!j&&f&&c.isFunction(d);for(o=0;o<i;o++)e(a[o],b,f?d.call(a[o],o,e(a[o],b)):d,j);return a}return i?
e(a[0],b):w}function J(){return(new Date).getTime()}function Y(){return false}function Z(){return true}function na(a,b,d){d[0].type=a;return c.event.handle.apply(b,d)}function oa(a){var b,d=[],f=[],e=arguments,j,i,o,k,n,r;i=c.data(this,"events");if(!(a.liveFired===this||!i||!i.live||a.button&&a.type==="click")){a.liveFired=this;var u=i.live.slice(0);for(k=0;k<u.length;k++){i=u[k];i.origType.replace(O,"")===a.type?f.push(i.selector):u.splice(k--,1)}j=c(a.target).closest(f,a.currentTarget);n=0;for(r=
j.length;n<r;n++)for(k=0;k<u.length;k++){i=u[k];if(j[n].selector===i.selector){o=j[n].elem;f=null;if(i.preType==="mouseenter"||i.preType==="mouseleave")f=c(a.relatedTarget).closest(i.selector)[0];if(!f||f!==o)d.push({elem:o,handleObj:i})}}n=0;for(r=d.length;n<r;n++){j=d[n];a.currentTarget=j.elem;a.data=j.handleObj.data;a.handleObj=j.handleObj;if(j.handleObj.origHandler.apply(j.elem,e)===false){b=false;break}}return b}}function pa(a,b){return"live."+(a&&a!=="*"?a+".":"")+b.replace(/\./g,"`").replace(/ /g,
"&")}function qa(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function ra(a,b){var d=0;b.each(function(){if(this.nodeName===(a[d]&&a[d].nodeName)){var f=c.data(a[d++]),e=c.data(this,f);if(f=f&&f.events){delete e.handle;e.events={};for(var j in f)for(var i in f[j])c.event.add(this,j,f[j][i],f[j][i].data)}}})}function sa(a,b,d){var f,e,j;b=b&&b[0]?b[0].ownerDocument||b[0]:s;if(a.length===1&&typeof a[0]==="string"&&a[0].length<512&&b===s&&!ta.test(a[0])&&(c.support.checkClone||!ua.test(a[0]))){e=
true;if(j=c.fragments[a[0]])if(j!==1)f=j}if(!f){f=b.createDocumentFragment();c.clean(a,b,f,d)}if(e)c.fragments[a[0]]=j?f:1;return{fragment:f,cacheable:e}}function K(a,b){var d={};c.each(va.concat.apply([],va.slice(0,b)),function(){d[this]=a});return d}function wa(a){return"scrollTo"in a&&a.document?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var c=function(a,b){return new c.fn.init(a,b)},Ra=A.jQuery,Sa=A.$,s=A.document,T,Ta=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,Ua=/^.[^:#\[\.,]*$/,Va=/\S/,
Wa=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,Xa=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,P=navigator.userAgent,xa=false,Q=[],L,$=Object.prototype.toString,aa=Object.prototype.hasOwnProperty,ba=Array.prototype.push,R=Array.prototype.slice,ya=Array.prototype.indexOf;c.fn=c.prototype={init:function(a,b){var d,f;if(!a)return this;if(a.nodeType){this.context=this[0]=a;this.length=1;return this}if(a==="body"&&!b){this.context=s;this[0]=s.body;this.selector="body";this.length=1;return this}if(typeof a==="string")if((d=Ta.exec(a))&&
(d[1]||!b))if(d[1]){f=b?b.ownerDocument||b:s;if(a=Xa.exec(a))if(c.isPlainObject(b)){a=[s.createElement(a[1])];c.fn.attr.call(a,b,true)}else a=[f.createElement(a[1])];else{a=sa([d[1]],[f]);a=(a.cacheable?a.fragment.cloneNode(true):a.fragment).childNodes}return c.merge(this,a)}else{if(b=s.getElementById(d[2])){if(b.id!==d[2])return T.find(a);this.length=1;this[0]=b}this.context=s;this.selector=a;return this}else if(!b&&/^\w+$/.test(a)){this.selector=a;this.context=s;a=s.getElementsByTagName(a);return c.merge(this,
a)}else return!b||b.jquery?(b||T).find(a):c(b).find(a);else if(c.isFunction(a))return T.ready(a);if(a.selector!==w){this.selector=a.selector;this.context=a.context}return c.makeArray(a,this)},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return R.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this.slice(a)[0]:this[a]},pushStack:function(a,b,d){var f=c();c.isArray(a)?ba.apply(f,a):c.merge(f,a);f.prevObject=this;f.context=this.context;if(b===
"find")f.selector=this.selector+(this.selector?" ":"")+d;else if(b)f.selector=this.selector+"."+b+"("+d+")";return f},each:function(a,b){return c.each(this,a,b)},ready:function(a){c.bindReady();if(c.isReady)a.call(s,c);else Q&&Q.push(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(R.apply(this,arguments),"slice",R.call(arguments).join(","))},map:function(a){return this.pushStack(c.map(this,
function(b,d){return a.call(b,d,b)}))},end:function(){return this.prevObject||c(null)},push:ba,sort:[].sort,splice:[].splice};c.fn.init.prototype=c.fn;c.extend=c.fn.extend=function(){var a=arguments[0]||{},b=1,d=arguments.length,f=false,e,j,i,o;if(typeof a==="boolean"){f=a;a=arguments[1]||{};b=2}if(typeof a!=="object"&&!c.isFunction(a))a={};if(d===b){a=this;--b}for(;b<d;b++)if((e=arguments[b])!=null)for(j in e){i=a[j];o=e[j];if(a!==o)if(f&&o&&(c.isPlainObject(o)||c.isArray(o))){i=i&&(c.isPlainObject(i)||
c.isArray(i))?i:c.isArray(o)?[]:{};a[j]=c.extend(f,i,o)}else if(o!==w)a[j]=o}return a};c.extend({noConflict:function(a){A.$=Sa;if(a)A.jQuery=Ra;return c},isReady:false,ready:function(){if(!c.isReady){if(!s.body)return setTimeout(c.ready,13);c.isReady=true;if(Q){for(var a,b=0;a=Q[b++];)a.call(s,c);Q=null}c.fn.triggerHandler&&c(s).triggerHandler("ready")}},bindReady:function(){if(!xa){xa=true;if(s.readyState==="complete")return c.ready();if(s.addEventListener){s.addEventListener("DOMContentLoaded",
L,false);A.addEventListener("load",c.ready,false)}else if(s.attachEvent){s.attachEvent("onreadystatechange",L);A.attachEvent("onload",c.ready);var a=false;try{a=A.frameElement==null}catch(b){}s.documentElement.doScroll&&a&&ma()}}},isFunction:function(a){return $.call(a)==="[object Function]"},isArray:function(a){return $.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||$.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!aa.call(a,"constructor")&&!aa.call(a.constructor.prototype,
"isPrototypeOf"))return false;var b;for(b in a);return b===w||aa.call(a,b)},isEmptyObject:function(a){for(var b in a)return false;return true},error:function(a){throw a;},parseJSON:function(a){if(typeof a!=="string"||!a)return null;a=c.trim(a);if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return A.JSON&&A.JSON.parse?A.JSON.parse(a):(new Function("return "+
a))();else c.error("Invalid JSON: "+a)},noop:function(){},globalEval:function(a){if(a&&Va.test(a)){var b=s.getElementsByTagName("head")[0]||s.documentElement,d=s.createElement("script");d.type="text/javascript";if(c.support.scriptEval)d.appendChild(s.createTextNode(a));else d.text=a;b.insertBefore(d,b.firstChild);b.removeChild(d)}},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,b,d){var f,e=0,j=a.length,i=j===w||c.isFunction(a);if(d)if(i)for(f in a){if(b.apply(a[f],
d)===false)break}else for(;e<j;){if(b.apply(a[e++],d)===false)break}else if(i)for(f in a){if(b.call(a[f],f,a[f])===false)break}else for(d=a[0];e<j&&b.call(d,e,d)!==false;d=a[++e]);return a},trim:function(a){return(a||"").replace(Wa,"")},makeArray:function(a,b){b=b||[];if(a!=null)a.length==null||typeof a==="string"||c.isFunction(a)||typeof a!=="function"&&a.setInterval?ba.call(b,a):c.merge(b,a);return b},inArray:function(a,b){if(b.indexOf)return b.indexOf(a);for(var d=0,f=b.length;d<f;d++)if(b[d]===
a)return d;return-1},merge:function(a,b){var d=a.length,f=0;if(typeof b.length==="number")for(var e=b.length;f<e;f++)a[d++]=b[f];else for(;b[f]!==w;)a[d++]=b[f++];a.length=d;return a},grep:function(a,b,d){for(var f=[],e=0,j=a.length;e<j;e++)!d!==!b(a[e],e)&&f.push(a[e]);return f},map:function(a,b,d){for(var f=[],e,j=0,i=a.length;j<i;j++){e=b(a[j],j,d);if(e!=null)f[f.length]=e}return f.concat.apply([],f)},guid:1,proxy:function(a,b,d){if(arguments.length===2)if(typeof b==="string"){d=a;a=d[b];b=w}else if(b&&
!c.isFunction(b)){d=b;b=w}if(!b&&a)b=function(){return a.apply(d||this,arguments)};if(a)b.guid=a.guid=a.guid||b.guid||c.guid++;return b},uaMatch:function(a){a=a.toLowerCase();a=/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||!/compatible/.test(a)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}},browser:{}});P=c.uaMatch(P);if(P.browser){c.browser[P.browser]=true;c.browser.version=P.version}if(c.browser.webkit)c.browser.safari=
true;if(ya)c.inArray=function(a,b){return ya.call(b,a)};T=c(s);if(s.addEventListener)L=function(){s.removeEventListener("DOMContentLoaded",L,false);c.ready()};else if(s.attachEvent)L=function(){if(s.readyState==="complete"){s.detachEvent("onreadystatechange",L);c.ready()}};(function(){c.support={};var a=s.documentElement,b=s.createElement("script"),d=s.createElement("div"),f="script"+J();d.style.display="none";d.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";
var e=d.getElementsByTagName("*"),j=d.getElementsByTagName("a")[0];if(!(!e||!e.length||!j)){c.support={leadingWhitespace:d.firstChild.nodeType===3,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/red/.test(j.getAttribute("style")),hrefNormalized:j.getAttribute("href")==="/a",opacity:/^0.55$/.test(j.style.opacity),cssFloat:!!j.style.cssFloat,checkOn:d.getElementsByTagName("input")[0].value==="on",optSelected:s.createElement("select").appendChild(s.createElement("option")).selected,
parentNode:d.removeChild(d.appendChild(s.createElement("div"))).parentNode===null,deleteExpando:true,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null};b.type="text/javascript";try{b.appendChild(s.createTextNode("window."+f+"=1;"))}catch(i){}a.insertBefore(b,a.firstChild);if(A[f]){c.support.scriptEval=true;delete A[f]}try{delete b.test}catch(o){c.support.deleteExpando=false}a.removeChild(b);if(d.attachEvent&&d.fireEvent){d.attachEvent("onclick",function k(){c.support.noCloneEvent=
false;d.detachEvent("onclick",k)});d.cloneNode(true).fireEvent("onclick")}d=s.createElement("div");d.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";a=s.createDocumentFragment();a.appendChild(d.firstChild);c.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;c(function(){var k=s.createElement("div");k.style.width=k.style.paddingLeft="1px";s.body.appendChild(k);c.boxModel=c.support.boxModel=k.offsetWidth===2;s.body.removeChild(k).style.display="none"});a=function(k){var n=
s.createElement("div");k="on"+k;var r=k in n;if(!r){n.setAttribute(k,"return;");r=typeof n[k]==="function"}return r};c.support.submitBubbles=a("submit");c.support.changeBubbles=a("change");a=b=d=e=j=null}})();c.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};var G="jQuery"+J(),Ya=0,za={};c.extend({cache:{},expando:G,noData:{embed:true,object:true,
applet:true},data:function(a,b,d){if(!(a.nodeName&&c.noData[a.nodeName.toLowerCase()])){a=a==A?za:a;var f=a[G],e=c.cache;if(!f&&typeof b==="string"&&d===w)return null;f||(f=++Ya);if(typeof b==="object"){a[G]=f;e[f]=c.extend(true,{},b)}else if(!e[f]){a[G]=f;e[f]={}}a=e[f];if(d!==w)a[b]=d;return typeof b==="string"?a[b]:a}},removeData:function(a,b){if(!(a.nodeName&&c.noData[a.nodeName.toLowerCase()])){a=a==A?za:a;var d=a[G],f=c.cache,e=f[d];if(b){if(e){delete e[b];c.isEmptyObject(e)&&c.removeData(a)}}else{if(c.support.deleteExpando)delete a[c.expando];
else a.removeAttribute&&a.removeAttribute(c.expando);delete f[d]}}}});c.fn.extend({data:function(a,b){if(typeof a==="undefined"&&this.length)return c.data(this[0]);else if(typeof a==="object")return this.each(function(){c.data(this,a)});var d=a.split(".");d[1]=d[1]?"."+d[1]:"";if(b===w){var f=this.triggerHandler("getData"+d[1]+"!",[d[0]]);if(f===w&&this.length)f=c.data(this[0],a);return f===w&&d[1]?this.data(d[0]):f}else return this.trigger("setData"+d[1]+"!",[d[0],b]).each(function(){c.data(this,
a,b)})},removeData:function(a){return this.each(function(){c.removeData(this,a)})}});c.extend({queue:function(a,b,d){if(a){b=(b||"fx")+"queue";var f=c.data(a,b);if(!d)return f||[];if(!f||c.isArray(d))f=c.data(a,b,c.makeArray(d));else f.push(d);return f}},dequeue:function(a,b){b=b||"fx";var d=c.queue(a,b),f=d.shift();if(f==="inprogress")f=d.shift();if(f){b==="fx"&&d.unshift("inprogress");f.call(a,function(){c.dequeue(a,b)})}}});c.fn.extend({queue:function(a,b){if(typeof a!=="string"){b=a;a="fx"}if(b===
w)return c.queue(this[0],a);return this.each(function(){var d=c.queue(this,a,b);a==="fx"&&d[0]!=="inprogress"&&c.dequeue(this,a)})},dequeue:function(a){return this.each(function(){c.dequeue(this,a)})},delay:function(a,b){a=c.fx?c.fx.speeds[a]||a:a;b=b||"fx";return this.queue(b,function(){var d=this;setTimeout(function(){c.dequeue(d,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])}});var Aa=/[\n\t]/g,ca=/\s+/,Za=/\r/g,$a=/href|src|style/,ab=/(button|input)/i,bb=/(button|input|object|select|textarea)/i,
cb=/^(a|area)$/i,Ba=/radio|checkbox/;c.fn.extend({attr:function(a,b){return X(this,a,b,true,c.attr)},removeAttr:function(a){return this.each(function(){c.attr(this,a,"");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(c.isFunction(a))return this.each(function(n){var r=c(this);r.addClass(a.call(this,n,r.attr("class")))});if(a&&typeof a==="string")for(var b=(a||"").split(ca),d=0,f=this.length;d<f;d++){var e=this[d];if(e.nodeType===1)if(e.className){for(var j=" "+e.className+" ",
i=e.className,o=0,k=b.length;o<k;o++)if(j.indexOf(" "+b[o]+" ")<0)i+=" "+b[o];e.className=c.trim(i)}else e.className=a}return this},removeClass:function(a){if(c.isFunction(a))return this.each(function(k){var n=c(this);n.removeClass(a.call(this,k,n.attr("class")))});if(a&&typeof a==="string"||a===w)for(var b=(a||"").split(ca),d=0,f=this.length;d<f;d++){var e=this[d];if(e.nodeType===1&&e.className)if(a){for(var j=(" "+e.className+" ").replace(Aa," "),i=0,o=b.length;i<o;i++)j=j.replace(" "+b[i]+" ",
" ");e.className=c.trim(j)}else e.className=""}return this},toggleClass:function(a,b){var d=typeof a,f=typeof b==="boolean";if(c.isFunction(a))return this.each(function(e){var j=c(this);j.toggleClass(a.call(this,e,j.attr("class"),b),b)});return this.each(function(){if(d==="string")for(var e,j=0,i=c(this),o=b,k=a.split(ca);e=k[j++];){o=f?o:!i.hasClass(e);i[o?"addClass":"removeClass"](e)}else if(d==="undefined"||d==="boolean"){this.className&&c.data(this,"__className__",this.className);this.className=
this.className||a===false?"":c.data(this,"__className__")||""}})},hasClass:function(a){a=" "+a+" ";for(var b=0,d=this.length;b<d;b++)if((" "+this[b].className+" ").replace(Aa," ").indexOf(a)>-1)return true;return false},val:function(a){if(a===w){var b=this[0];if(b){if(c.nodeName(b,"option"))return(b.attributes.value||{}).specified?b.value:b.text;if(c.nodeName(b,"select")){var d=b.selectedIndex,f=[],e=b.options;b=b.type==="select-one";if(d<0)return null;var j=b?d:0;for(d=b?d+1:e.length;j<d;j++){var i=
e[j];if(i.selected){a=c(i).val();if(b)return a;f.push(a)}}return f}if(Ba.test(b.type)&&!c.support.checkOn)return b.getAttribute("value")===null?"on":b.value;return(b.value||"").replace(Za,"")}return w}var o=c.isFunction(a);return this.each(function(k){var n=c(this),r=a;if(this.nodeType===1){if(o)r=a.call(this,k,n.val());if(typeof r==="number")r+="";if(c.isArray(r)&&Ba.test(this.type))this.checked=c.inArray(n.val(),r)>=0;else if(c.nodeName(this,"select")){var u=c.makeArray(r);c("option",this).each(function(){this.selected=
c.inArray(c(this).val(),u)>=0});if(!u.length)this.selectedIndex=-1}else this.value=r}})}});c.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(a,b,d,f){if(!a||a.nodeType===3||a.nodeType===8)return w;if(f&&b in c.attrFn)return c(a)[b](d);f=a.nodeType!==1||!c.isXMLDoc(a);var e=d!==w;b=f&&c.props[b]||b;if(a.nodeType===1){var j=$a.test(b);if(b in a&&f&&!j){if(e){b==="type"&&ab.test(a.nodeName)&&a.parentNode&&c.error("type property can't be changed");
a[b]=d}if(c.nodeName(a,"form")&&a.getAttributeNode(b))return a.getAttributeNode(b).nodeValue;if(b==="tabIndex")return(b=a.getAttributeNode("tabIndex"))&&b.specified?b.value:bb.test(a.nodeName)||cb.test(a.nodeName)&&a.href?0:w;return a[b]}if(!c.support.style&&f&&b==="style"){if(e)a.style.cssText=""+d;return a.style.cssText}e&&a.setAttribute(b,""+d);a=!c.support.hrefNormalized&&f&&j?a.getAttribute(b,2):a.getAttribute(b);return a===null?w:a}return c.style(a,b,d)}});var O=/\.(.*)$/,db=function(a){return a.replace(/[^\w\s\.\|`]/g,
function(b){return"\\"+b})};c.event={add:function(a,b,d,f){if(!(a.nodeType===3||a.nodeType===8)){if(a.setInterval&&a!==A&&!a.frameElement)a=A;var e,j;if(d.handler){e=d;d=e.handler}if(!d.guid)d.guid=c.guid++;if(j=c.data(a)){var i=j.events=j.events||{},o=j.handle;if(!o)j.handle=o=function(){return typeof c!=="undefined"&&!c.event.triggered?c.event.handle.apply(o.elem,arguments):w};o.elem=a;b=b.split(" ");for(var k,n=0,r;k=b[n++];){j=e?c.extend({},e):{handler:d,data:f};if(k.indexOf(".")>-1){r=k.split(".");
k=r.shift();j.namespace=r.slice(0).sort().join(".")}else{r=[];j.namespace=""}j.type=k;j.guid=d.guid;var u=i[k],z=c.event.special[k]||{};if(!u){u=i[k]=[];if(!z.setup||z.setup.call(a,f,r,o)===false)if(a.addEventListener)a.addEventListener(k,o,false);else a.attachEvent&&a.attachEvent("on"+k,o)}if(z.add){z.add.call(a,j);if(!j.handler.guid)j.handler.guid=d.guid}u.push(j);c.event.global[k]=true}a=null}}},global:{},remove:function(a,b,d,f){if(!(a.nodeType===3||a.nodeType===8)){var e,j=0,i,o,k,n,r,u,z=c.data(a),
C=z&&z.events;if(z&&C){if(b&&b.type){d=b.handler;b=b.type}if(!b||typeof b==="string"&&b.charAt(0)==="."){b=b||"";for(e in C)c.event.remove(a,e+b)}else{for(b=b.split(" ");e=b[j++];){n=e;i=e.indexOf(".")<0;o=[];if(!i){o=e.split(".");e=o.shift();k=new RegExp("(^|\\.)"+c.map(o.slice(0).sort(),db).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(r=C[e])if(d){n=c.event.special[e]||{};for(B=f||0;B<r.length;B++){u=r[B];if(d.guid===u.guid){if(i||k.test(u.namespace)){f==null&&r.splice(B--,1);n.remove&&n.remove.call(a,u)}if(f!=
null)break}}if(r.length===0||f!=null&&r.length===1){if(!n.teardown||n.teardown.call(a,o)===false)Ca(a,e,z.handle);delete C[e]}}else for(var B=0;B<r.length;B++){u=r[B];if(i||k.test(u.namespace)){c.event.remove(a,n,u.handler,B);r.splice(B--,1)}}}if(c.isEmptyObject(C)){if(b=z.handle)b.elem=null;delete z.events;delete z.handle;c.isEmptyObject(z)&&c.removeData(a)}}}}},trigger:function(a,b,d,f){var e=a.type||a;if(!f){a=typeof a==="object"?a[G]?a:c.extend(c.Event(e),a):c.Event(e);if(e.indexOf("!")>=0){a.type=
e=e.slice(0,-1);a.exclusive=true}if(!d){a.stopPropagation();c.event.global[e]&&c.each(c.cache,function(){this.events&&this.events[e]&&c.event.trigger(a,b,this.handle.elem)})}if(!d||d.nodeType===3||d.nodeType===8)return w;a.result=w;a.target=d;b=c.makeArray(b);b.unshift(a)}a.currentTarget=d;(f=c.data(d,"handle"))&&f.apply(d,b);f=d.parentNode||d.ownerDocument;try{if(!(d&&d.nodeName&&c.noData[d.nodeName.toLowerCase()]))if(d["on"+e]&&d["on"+e].apply(d,b)===false)a.result=false}catch(j){}if(!a.isPropagationStopped()&&
f)c.event.trigger(a,b,f,true);else if(!a.isDefaultPrevented()){f=a.target;var i,o=c.nodeName(f,"a")&&e==="click",k=c.event.special[e]||{};if((!k._default||k._default.call(d,a)===false)&&!o&&!(f&&f.nodeName&&c.noData[f.nodeName.toLowerCase()])){try{if(f[e]){if(i=f["on"+e])f["on"+e]=null;c.event.triggered=true;f[e]()}}catch(n){}if(i)f["on"+e]=i;c.event.triggered=false}}},handle:function(a){var b,d,f,e;a=arguments[0]=c.event.fix(a||A.event);a.currentTarget=this;b=a.type.indexOf(".")<0&&!a.exclusive;
if(!b){d=a.type.split(".");a.type=d.shift();f=new RegExp("(^|\\.)"+d.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")}e=c.data(this,"events");d=e[a.type];if(e&&d){d=d.slice(0);e=0;for(var j=d.length;e<j;e++){var i=d[e];if(b||f.test(i.namespace)){a.handler=i.handler;a.data=i.data;a.handleObj=i;i=i.handler.apply(this,arguments);if(i!==w){a.result=i;if(i===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),
fix:function(a){if(a[G])return a;var b=a;a=c.Event(b);for(var d=this.props.length,f;d;){f=this.props[--d];a[f]=b[f]}if(!a.target)a.target=a.srcElement||s;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){b=s.documentElement;d=s.body;a.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||
d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0)}if(!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode))a.which=a.charCode||a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==w)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1E8,proxy:c.proxy,special:{ready:{setup:c.bindReady,teardown:c.noop},live:{add:function(a){c.event.add(this,a.origType,c.extend({},a,{handler:oa}))},remove:function(a){var b=true,d=a.origType.replace(O,"");c.each(c.data(this,
"events").live||[],function(){if(d===this.origType.replace(O,""))return b=false});b&&c.event.remove(this,a.origType,oa)}},beforeunload:{setup:function(a,b,d){if(this.setInterval)this.onbeforeunload=d;return false},teardown:function(a,b){if(this.onbeforeunload===b)this.onbeforeunload=null}}}};var Ca=s.removeEventListener?function(a,b,d){a.removeEventListener(b,d,false)}:function(a,b,d){a.detachEvent("on"+b,d)};c.Event=function(a){if(!this.preventDefault)return new c.Event(a);if(a&&a.type){this.originalEvent=
a;this.type=a.type}else this.type=a;this.timeStamp=J();this[G]=true};c.Event.prototype={preventDefault:function(){this.isDefaultPrevented=Z;var a=this.originalEvent;if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=Z;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Z;this.stopPropagation()},isDefaultPrevented:Y,isPropagationStopped:Y,
isImmediatePropagationStopped:Y};var Da=function(a){var b=a.relatedTarget;try{for(;b&&b!==this;)b=b.parentNode;if(b!==this){a.type=a.data;c.event.handle.apply(this,arguments)}}catch(d){}},Ea=function(a){a.type=a.data;c.event.handle.apply(this,arguments)};c.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){c.event.special[a]={setup:function(d){c.event.add(this,b,d&&d.selector?Ea:Da,a)},teardown:function(d){c.event.remove(this,b,d&&d.selector?Ea:Da)}}});if(!c.support.submitBubbles)c.event.special.submit=
{setup:function(){if(this.nodeName.toLowerCase()!=="form"){c.event.add(this,"click.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="submit"||d==="image")&&c(b).closest("form").length)return na("submit",this,arguments)});c.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="text"||d==="password")&&c(b).closest("form").length&&a.keyCode===13)return na("submit",this,arguments)})}else return false},teardown:function(){c.event.remove(this,".specialSubmit")}};
if(!c.support.changeBubbles){var da=/textarea|input|select/i,ea,Fa=function(a){var b=a.type,d=a.value;if(b==="radio"||b==="checkbox")d=a.checked;else if(b==="select-multiple")d=a.selectedIndex>-1?c.map(a.options,function(f){return f.selected}).join("-"):"";else if(a.nodeName.toLowerCase()==="select")d=a.selectedIndex;return d},fa=function(a,b){var d=a.target,f,e;if(!(!da.test(d.nodeName)||d.readOnly)){f=c.data(d,"_change_data");e=Fa(d);if(a.type!=="focusout"||d.type!=="radio")c.data(d,"_change_data",
e);if(!(f===w||e===f))if(f!=null||e){a.type="change";return c.event.trigger(a,b,d)}}};c.event.special.change={filters:{focusout:fa,click:function(a){var b=a.target,d=b.type;if(d==="radio"||d==="checkbox"||b.nodeName.toLowerCase()==="select")return fa.call(this,a)},keydown:function(a){var b=a.target,d=b.type;if(a.keyCode===13&&b.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(d==="checkbox"||d==="radio")||d==="select-multiple")return fa.call(this,a)},beforeactivate:function(a){a=a.target;c.data(a,
"_change_data",Fa(a))}},setup:function(){if(this.type==="file")return false;for(var a in ea)c.event.add(this,a+".specialChange",ea[a]);return da.test(this.nodeName)},teardown:function(){c.event.remove(this,".specialChange");return da.test(this.nodeName)}};ea=c.event.special.change.filters}s.addEventListener&&c.each({focus:"focusin",blur:"focusout"},function(a,b){function d(f){f=c.event.fix(f);f.type=b;return c.event.handle.call(this,f)}c.event.special[b]={setup:function(){this.addEventListener(a,
d,true)},teardown:function(){this.removeEventListener(a,d,true)}}});c.each(["bind","one"],function(a,b){c.fn[b]=function(d,f,e){if(typeof d==="object"){for(var j in d)this[b](j,f,d[j],e);return this}if(c.isFunction(f)){e=f;f=w}var i=b==="one"?c.proxy(e,function(k){c(this).unbind(k,i);return e.apply(this,arguments)}):e;if(d==="unload"&&b!=="one")this.one(d,f,e);else{j=0;for(var o=this.length;j<o;j++)c.event.add(this[j],d,i,f)}return this}});c.fn.extend({unbind:function(a,b){if(typeof a==="object"&&
!a.preventDefault)for(var d in a)this.unbind(d,a[d]);else{d=0;for(var f=this.length;d<f;d++)c.event.remove(this[d],a,b)}return this},delegate:function(a,b,d,f){return this.live(b,d,f,a)},undelegate:function(a,b,d){return arguments.length===0?this.unbind("live"):this.die(b,null,d,a)},trigger:function(a,b){return this.each(function(){c.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){a=c.Event(a);a.preventDefault();a.stopPropagation();c.event.trigger(a,b,this[0]);return a.result}},
toggle:function(a){for(var b=arguments,d=1;d<b.length;)c.proxy(a,b[d++]);return this.click(c.proxy(a,function(f){var e=(c.data(this,"lastToggle"+a.guid)||0)%d;c.data(this,"lastToggle"+a.guid,e+1);f.preventDefault();return b[e].apply(this,arguments)||false}))},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Ga={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};c.each(["live","die"],function(a,b){c.fn[b]=function(d,f,e,j){var i,o=0,k,n,r=j||this.selector,
u=j?this:c(this.context);if(c.isFunction(f)){e=f;f=w}for(d=(d||"").split(" ");(i=d[o++])!=null;){j=O.exec(i);k="";if(j){k=j[0];i=i.replace(O,"")}if(i==="hover")d.push("mouseenter"+k,"mouseleave"+k);else{n=i;if(i==="focus"||i==="blur"){d.push(Ga[i]+k);i+=k}else i=(Ga[i]||i)+k;b==="live"?u.each(function(){c.event.add(this,pa(i,r),{data:f,selector:r,handler:e,origType:i,origHandler:e,preType:n})}):u.unbind(pa(i,r),e)}}return this}});c.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),
function(a,b){c.fn[b]=function(d){return d?this.bind(b,d):this.trigger(b)};if(c.attrFn)c.attrFn[b]=true});A.attachEvent&&!A.addEventListener&&A.attachEvent("onunload",function(){for(var a in c.cache)if(c.cache[a].handle)try{c.event.remove(c.cache[a].handle.elem)}catch(b){}});(function(){function a(g){for(var h="",l,m=0;g[m];m++){l=g[m];if(l.nodeType===3||l.nodeType===4)h+=l.nodeValue;else if(l.nodeType!==8)h+=a(l.childNodes)}return h}function b(g,h,l,m,q,p){q=0;for(var v=m.length;q<v;q++){var t=m[q];
if(t){t=t[g];for(var y=false;t;){if(t.sizcache===l){y=m[t.sizset];break}if(t.nodeType===1&&!p){t.sizcache=l;t.sizset=q}if(t.nodeName.toLowerCase()===h){y=t;break}t=t[g]}m[q]=y}}}function d(g,h,l,m,q,p){q=0;for(var v=m.length;q<v;q++){var t=m[q];if(t){t=t[g];for(var y=false;t;){if(t.sizcache===l){y=m[t.sizset];break}if(t.nodeType===1){if(!p){t.sizcache=l;t.sizset=q}if(typeof h!=="string"){if(t===h){y=true;break}}else if(k.filter(h,[t]).length>0){y=t;break}}t=t[g]}m[q]=y}}}var f=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,
e=0,j=Object.prototype.toString,i=false,o=true;[0,0].sort(function(){o=false;return 0});var k=function(g,h,l,m){l=l||[];var q=h=h||s;if(h.nodeType!==1&&h.nodeType!==9)return[];if(!g||typeof g!=="string")return l;for(var p=[],v,t,y,S,H=true,M=x(h),I=g;(f.exec(""),v=f.exec(I))!==null;){I=v[3];p.push(v[1]);if(v[2]){S=v[3];break}}if(p.length>1&&r.exec(g))if(p.length===2&&n.relative[p[0]])t=ga(p[0]+p[1],h);else for(t=n.relative[p[0]]?[h]:k(p.shift(),h);p.length;){g=p.shift();if(n.relative[g])g+=p.shift();
t=ga(g,t)}else{if(!m&&p.length>1&&h.nodeType===9&&!M&&n.match.ID.test(p[0])&&!n.match.ID.test(p[p.length-1])){v=k.find(p.shift(),h,M);h=v.expr?k.filter(v.expr,v.set)[0]:v.set[0]}if(h){v=m?{expr:p.pop(),set:z(m)}:k.find(p.pop(),p.length===1&&(p[0]==="~"||p[0]==="+")&&h.parentNode?h.parentNode:h,M);t=v.expr?k.filter(v.expr,v.set):v.set;if(p.length>0)y=z(t);else H=false;for(;p.length;){var D=p.pop();v=D;if(n.relative[D])v=p.pop();else D="";if(v==null)v=h;n.relative[D](y,v,M)}}else y=[]}y||(y=t);y||k.error(D||
g);if(j.call(y)==="[object Array]")if(H)if(h&&h.nodeType===1)for(g=0;y[g]!=null;g++){if(y[g]&&(y[g]===true||y[g].nodeType===1&&E(h,y[g])))l.push(t[g])}else for(g=0;y[g]!=null;g++)y[g]&&y[g].nodeType===1&&l.push(t[g]);else l.push.apply(l,y);else z(y,l);if(S){k(S,q,l,m);k.uniqueSort(l)}return l};k.uniqueSort=function(g){if(B){i=o;g.sort(B);if(i)for(var h=1;h<g.length;h++)g[h]===g[h-1]&&g.splice(h--,1)}return g};k.matches=function(g,h){return k(g,null,null,h)};k.find=function(g,h,l){var m,q;if(!g)return[];
for(var p=0,v=n.order.length;p<v;p++){var t=n.order[p];if(q=n.leftMatch[t].exec(g)){var y=q[1];q.splice(1,1);if(y.substr(y.length-1)!=="\\"){q[1]=(q[1]||"").replace(/\\/g,"");m=n.find[t](q,h,l);if(m!=null){g=g.replace(n.match[t],"");break}}}}m||(m=h.getElementsByTagName("*"));return{set:m,expr:g}};k.filter=function(g,h,l,m){for(var q=g,p=[],v=h,t,y,S=h&&h[0]&&x(h[0]);g&&h.length;){for(var H in n.filter)if((t=n.leftMatch[H].exec(g))!=null&&t[2]){var M=n.filter[H],I,D;D=t[1];y=false;t.splice(1,1);if(D.substr(D.length-
1)!=="\\"){if(v===p)p=[];if(n.preFilter[H])if(t=n.preFilter[H](t,v,l,p,m,S)){if(t===true)continue}else y=I=true;if(t)for(var U=0;(D=v[U])!=null;U++)if(D){I=M(D,t,U,v);var Ha=m^!!I;if(l&&I!=null)if(Ha)y=true;else v[U]=false;else if(Ha){p.push(D);y=true}}if(I!==w){l||(v=p);g=g.replace(n.match[H],"");if(!y)return[];break}}}if(g===q)if(y==null)k.error(g);else break;q=g}return v};k.error=function(g){throw"Syntax error, unrecognized expression: "+g;};var n=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,
CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(g){return g.getAttribute("href")}},
relative:{"+":function(g,h){var l=typeof h==="string",m=l&&!/\W/.test(h);l=l&&!m;if(m)h=h.toLowerCase();m=0;for(var q=g.length,p;m<q;m++)if(p=g[m]){for(;(p=p.previousSibling)&&p.nodeType!==1;);g[m]=l||p&&p.nodeName.toLowerCase()===h?p||false:p===h}l&&k.filter(h,g,true)},">":function(g,h){var l=typeof h==="string";if(l&&!/\W/.test(h)){h=h.toLowerCase();for(var m=0,q=g.length;m<q;m++){var p=g[m];if(p){l=p.parentNode;g[m]=l.nodeName.toLowerCase()===h?l:false}}}else{m=0;for(q=g.length;m<q;m++)if(p=g[m])g[m]=
l?p.parentNode:p.parentNode===h;l&&k.filter(h,g,true)}},"":function(g,h,l){var m=e++,q=d;if(typeof h==="string"&&!/\W/.test(h)){var p=h=h.toLowerCase();q=b}q("parentNode",h,m,g,p,l)},"~":function(g,h,l){var m=e++,q=d;if(typeof h==="string"&&!/\W/.test(h)){var p=h=h.toLowerCase();q=b}q("previousSibling",h,m,g,p,l)}},find:{ID:function(g,h,l){if(typeof h.getElementById!=="undefined"&&!l)return(g=h.getElementById(g[1]))?[g]:[]},NAME:function(g,h){if(typeof h.getElementsByName!=="undefined"){var l=[];
h=h.getElementsByName(g[1]);for(var m=0,q=h.length;m<q;m++)h[m].getAttribute("name")===g[1]&&l.push(h[m]);return l.length===0?null:l}},TAG:function(g,h){return h.getElementsByTagName(g[1])}},preFilter:{CLASS:function(g,h,l,m,q,p){g=" "+g[1].replace(/\\/g,"")+" ";if(p)return g;p=0;for(var v;(v=h[p])!=null;p++)if(v)if(q^(v.className&&(" "+v.className+" ").replace(/[\t\n]/g," ").indexOf(g)>=0))l||m.push(v);else if(l)h[p]=false;return false},ID:function(g){return g[1].replace(/\\/g,"")},TAG:function(g){return g[1].toLowerCase()},
CHILD:function(g){if(g[1]==="nth"){var h=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(g[2]==="even"&&"2n"||g[2]==="odd"&&"2n+1"||!/\D/.test(g[2])&&"0n+"+g[2]||g[2]);g[2]=h[1]+(h[2]||1)-0;g[3]=h[3]-0}g[0]=e++;return g},ATTR:function(g,h,l,m,q,p){h=g[1].replace(/\\/g,"");if(!p&&n.attrMap[h])g[1]=n.attrMap[h];if(g[2]==="~=")g[4]=" "+g[4]+" ";return g},PSEUDO:function(g,h,l,m,q){if(g[1]==="not")if((f.exec(g[3])||"").length>1||/^\w/.test(g[3]))g[3]=k(g[3],null,null,h);else{g=k.filter(g[3],h,l,true^q);l||m.push.apply(m,
g);return false}else if(n.match.POS.test(g[0])||n.match.CHILD.test(g[0]))return true;return g},POS:function(g){g.unshift(true);return g}},filters:{enabled:function(g){return g.disabled===false&&g.type!=="hidden"},disabled:function(g){return g.disabled===true},checked:function(g){return g.checked===true},selected:function(g){return g.selected===true},parent:function(g){return!!g.firstChild},empty:function(g){return!g.firstChild},has:function(g,h,l){return!!k(l[3],g).length},header:function(g){return/h\d/i.test(g.nodeName)},
text:function(g){return"text"===g.type},radio:function(g){return"radio"===g.type},checkbox:function(g){return"checkbox"===g.type},file:function(g){return"file"===g.type},password:function(g){return"password"===g.type},submit:function(g){return"submit"===g.type},image:function(g){return"image"===g.type},reset:function(g){return"reset"===g.type},button:function(g){return"button"===g.type||g.nodeName.toLowerCase()==="button"},input:function(g){return/input|select|textarea|button/i.test(g.nodeName)}},
setFilters:{first:function(g,h){return h===0},last:function(g,h,l,m){return h===m.length-1},even:function(g,h){return h%2===0},odd:function(g,h){return h%2===1},lt:function(g,h,l){return h<l[3]-0},gt:function(g,h,l){return h>l[3]-0},nth:function(g,h,l){return l[3]-0===h},eq:function(g,h,l){return l[3]-0===h}},filter:{PSEUDO:function(g,h,l,m){var q=h[1],p=n.filters[q];if(p)return p(g,l,h,m);else if(q==="contains")return(g.textContent||g.innerText||a([g])||"").indexOf(h[3])>=0;else if(q==="not"){h=
h[3];l=0;for(m=h.length;l<m;l++)if(h[l]===g)return false;return true}else k.error("Syntax error, unrecognized expression: "+q)},CHILD:function(g,h){var l=h[1],m=g;switch(l){case "only":case "first":for(;m=m.previousSibling;)if(m.nodeType===1)return false;if(l==="first")return true;m=g;case "last":for(;m=m.nextSibling;)if(m.nodeType===1)return false;return true;case "nth":l=h[2];var q=h[3];if(l===1&&q===0)return true;h=h[0];var p=g.parentNode;if(p&&(p.sizcache!==h||!g.nodeIndex)){var v=0;for(m=p.firstChild;m;m=
m.nextSibling)if(m.nodeType===1)m.nodeIndex=++v;p.sizcache=h}g=g.nodeIndex-q;return l===0?g===0:g%l===0&&g/l>=0}},ID:function(g,h){return g.nodeType===1&&g.getAttribute("id")===h},TAG:function(g,h){return h==="*"&&g.nodeType===1||g.nodeName.toLowerCase()===h},CLASS:function(g,h){return(" "+(g.className||g.getAttribute("class"))+" ").indexOf(h)>-1},ATTR:function(g,h){var l=h[1];g=n.attrHandle[l]?n.attrHandle[l](g):g[l]!=null?g[l]:g.getAttribute(l);l=g+"";var m=h[2];h=h[4];return g==null?m==="!=":m===
"="?l===h:m==="*="?l.indexOf(h)>=0:m==="~="?(" "+l+" ").indexOf(h)>=0:!h?l&&g!==false:m==="!="?l!==h:m==="^="?l.indexOf(h)===0:m==="$="?l.substr(l.length-h.length)===h:m==="|="?l===h||l.substr(0,h.length+1)===h+"-":false},POS:function(g,h,l,m){var q=n.setFilters[h[2]];if(q)return q(g,l,h,m)}}},r=n.match.POS;for(var u in n.match){n.match[u]=new RegExp(n.match[u].source+/(?![^\[]*\])(?![^\(]*\))/.source);n.leftMatch[u]=new RegExp(/(^(?:.|\r|\n)*?)/.source+n.match[u].source.replace(/\\(\d+)/g,function(g,
h){return"\\"+(h-0+1)}))}var z=function(g,h){g=Array.prototype.slice.call(g,0);if(h){h.push.apply(h,g);return h}return g};try{Array.prototype.slice.call(s.documentElement.childNodes,0)}catch(C){z=function(g,h){h=h||[];if(j.call(g)==="[object Array]")Array.prototype.push.apply(h,g);else if(typeof g.length==="number")for(var l=0,m=g.length;l<m;l++)h.push(g[l]);else for(l=0;g[l];l++)h.push(g[l]);return h}}var B;if(s.documentElement.compareDocumentPosition)B=function(g,h){if(!g.compareDocumentPosition||
!h.compareDocumentPosition){if(g==h)i=true;return g.compareDocumentPosition?-1:1}g=g.compareDocumentPosition(h)&4?-1:g===h?0:1;if(g===0)i=true;return g};else if("sourceIndex"in s.documentElement)B=function(g,h){if(!g.sourceIndex||!h.sourceIndex){if(g==h)i=true;return g.sourceIndex?-1:1}g=g.sourceIndex-h.sourceIndex;if(g===0)i=true;return g};else if(s.createRange)B=function(g,h){if(!g.ownerDocument||!h.ownerDocument){if(g==h)i=true;return g.ownerDocument?-1:1}var l=g.ownerDocument.createRange(),m=
h.ownerDocument.createRange();l.setStart(g,0);l.setEnd(g,0);m.setStart(h,0);m.setEnd(h,0);g=l.compareBoundaryPoints(Range.START_TO_END,m);if(g===0)i=true;return g};(function(){var g=s.createElement("div"),h="script"+(new Date).getTime();g.innerHTML="<a name='"+h+"'/>";var l=s.documentElement;l.insertBefore(g,l.firstChild);if(s.getElementById(h)){n.find.ID=function(m,q,p){if(typeof q.getElementById!=="undefined"&&!p)return(q=q.getElementById(m[1]))?q.id===m[1]||typeof q.getAttributeNode!=="undefined"&&
q.getAttributeNode("id").nodeValue===m[1]?[q]:w:[]};n.filter.ID=function(m,q){var p=typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id");return m.nodeType===1&&p&&p.nodeValue===q}}l.removeChild(g);l=g=null})();(function(){var g=s.createElement("div");g.appendChild(s.createComment(""));if(g.getElementsByTagName("*").length>0)n.find.TAG=function(h,l){l=l.getElementsByTagName(h[1]);if(h[1]==="*"){h=[];for(var m=0;l[m];m++)l[m].nodeType===1&&h.push(l[m]);l=h}return l};g.innerHTML="<a href='#'></a>";
if(g.firstChild&&typeof g.firstChild.getAttribute!=="undefined"&&g.firstChild.getAttribute("href")!=="#")n.attrHandle.href=function(h){return h.getAttribute("href",2)};g=null})();s.querySelectorAll&&function(){var g=k,h=s.createElement("div");h.innerHTML="<p class='TEST'></p>";if(!(h.querySelectorAll&&h.querySelectorAll(".TEST").length===0)){k=function(m,q,p,v){q=q||s;if(!v&&q.nodeType===9&&!x(q))try{return z(q.querySelectorAll(m),p)}catch(t){}return g(m,q,p,v)};for(var l in g)k[l]=g[l];h=null}}();
(function(){var g=s.createElement("div");g.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!g.getElementsByClassName||g.getElementsByClassName("e").length===0)){g.lastChild.className="e";if(g.getElementsByClassName("e").length!==1){n.order.splice(1,0,"CLASS");n.find.CLASS=function(h,l,m){if(typeof l.getElementsByClassName!=="undefined"&&!m)return l.getElementsByClassName(h[1])};g=null}}})();var E=s.compareDocumentPosition?function(g,h){return!!(g.compareDocumentPosition(h)&16)}:
function(g,h){return g!==h&&(g.contains?g.contains(h):true)},x=function(g){return(g=(g?g.ownerDocument||g:0).documentElement)?g.nodeName!=="HTML":false},ga=function(g,h){var l=[],m="",q;for(h=h.nodeType?[h]:h;q=n.match.PSEUDO.exec(g);){m+=q[0];g=g.replace(n.match.PSEUDO,"")}g=n.relative[g]?g+"*":g;q=0;for(var p=h.length;q<p;q++)k(g,h[q],l);return k.filter(m,l)};c.find=k;c.expr=k.selectors;c.expr[":"]=c.expr.filters;c.unique=k.uniqueSort;c.text=a;c.isXMLDoc=x;c.contains=E})();var eb=/Until$/,fb=/^(?:parents|prevUntil|prevAll)/,
gb=/,/;R=Array.prototype.slice;var Ia=function(a,b,d){if(c.isFunction(b))return c.grep(a,function(e,j){return!!b.call(e,j,e)===d});else if(b.nodeType)return c.grep(a,function(e){return e===b===d});else if(typeof b==="string"){var f=c.grep(a,function(e){return e.nodeType===1});if(Ua.test(b))return c.filter(b,f,!d);else b=c.filter(b,f)}return c.grep(a,function(e){return c.inArray(e,b)>=0===d})};c.fn.extend({find:function(a){for(var b=this.pushStack("","find",a),d=0,f=0,e=this.length;f<e;f++){d=b.length;
c.find(a,this[f],b);if(f>0)for(var j=d;j<b.length;j++)for(var i=0;i<d;i++)if(b[i]===b[j]){b.splice(j--,1);break}}return b},has:function(a){var b=c(a);return this.filter(function(){for(var d=0,f=b.length;d<f;d++)if(c.contains(this,b[d]))return true})},not:function(a){return this.pushStack(Ia(this,a,false),"not",a)},filter:function(a){return this.pushStack(Ia(this,a,true),"filter",a)},is:function(a){return!!a&&c.filter(a,this).length>0},closest:function(a,b){if(c.isArray(a)){var d=[],f=this[0],e,j=
{},i;if(f&&a.length){e=0;for(var o=a.length;e<o;e++){i=a[e];j[i]||(j[i]=c.expr.match.POS.test(i)?c(i,b||this.context):i)}for(;f&&f.ownerDocument&&f!==b;){for(i in j){e=j[i];if(e.jquery?e.index(f)>-1:c(f).is(e)){d.push({selector:i,elem:f});delete j[i]}}f=f.parentNode}}return d}var k=c.expr.match.POS.test(a)?c(a,b||this.context):null;return this.map(function(n,r){for(;r&&r.ownerDocument&&r!==b;){if(k?k.index(r)>-1:c(r).is(a))return r;r=r.parentNode}return null})},index:function(a){if(!a||typeof a===
"string")return c.inArray(this[0],a?c(a):this.parent().children());return c.inArray(a.jquery?a[0]:a,this)},add:function(a,b){a=typeof a==="string"?c(a,b||this.context):c.makeArray(a);b=c.merge(this.get(),a);return this.pushStack(qa(a[0])||qa(b[0])?b:c.unique(b))},andSelf:function(){return this.add(this.prevObject)}});c.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return c.dir(a,"parentNode")},parentsUntil:function(a,b,d){return c.dir(a,"parentNode",
d)},next:function(a){return c.nth(a,2,"nextSibling")},prev:function(a){return c.nth(a,2,"previousSibling")},nextAll:function(a){return c.dir(a,"nextSibling")},prevAll:function(a){return c.dir(a,"previousSibling")},nextUntil:function(a,b,d){return c.dir(a,"nextSibling",d)},prevUntil:function(a,b,d){return c.dir(a,"previousSibling",d)},siblings:function(a){return c.sibling(a.parentNode.firstChild,a)},children:function(a){return c.sibling(a.firstChild)},contents:function(a){return c.nodeName(a,"iframe")?
a.contentDocument||a.contentWindow.document:c.makeArray(a.childNodes)}},function(a,b){c.fn[a]=function(d,f){var e=c.map(this,b,d);eb.test(a)||(f=d);if(f&&typeof f==="string")e=c.filter(f,e);e=this.length>1?c.unique(e):e;if((this.length>1||gb.test(f))&&fb.test(a))e=e.reverse();return this.pushStack(e,a,R.call(arguments).join(","))}});c.extend({filter:function(a,b,d){if(d)a=":not("+a+")";return c.find.matches(a,b)},dir:function(a,b,d){var f=[];for(a=a[b];a&&a.nodeType!==9&&(d===w||a.nodeType!==1||!c(a).is(d));){a.nodeType===
1&&f.push(a);a=a[b]}return f},nth:function(a,b,d){b=b||1;for(var f=0;a;a=a[d])if(a.nodeType===1&&++f===b)break;return a},sibling:function(a,b){for(var d=[];a;a=a.nextSibling)a.nodeType===1&&a!==b&&d.push(a);return d}});var Ja=/ jQuery\d+="(?:\d+|null)"/g,V=/^\s+/,Ka=/(<([\w:]+)[^>]*?)\/>/g,hb=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,La=/<([\w:]+)/,ib=/<tbody/i,jb=/<|&#?\w+;/,ta=/<script|<object|<embed|<option|<style/i,ua=/checked\s*(?:[^=]|=\s*.checked.)/i,Ma=function(a,b,d){return hb.test(d)?
a:b+"></"+d+">"},F={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};F.optgroup=F.option;F.tbody=F.tfoot=F.colgroup=F.caption=F.thead;F.th=F.td;if(!c.support.htmlSerialize)F._default=[1,"div<div>","</div>"];c.fn.extend({text:function(a){if(c.isFunction(a))return this.each(function(b){var d=
c(this);d.text(a.call(this,b,d.text()))});if(typeof a!=="object"&&a!==w)return this.empty().append((this[0]&&this[0].ownerDocument||s).createTextNode(a));return c.text(this)},wrapAll:function(a){if(c.isFunction(a))return this.each(function(d){c(this).wrapAll(a.call(this,d))});if(this[0]){var b=c(a,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var d=this;d.firstChild&&d.firstChild.nodeType===1;)d=d.firstChild;return d}).append(this)}return this},
wrapInner:function(a){if(c.isFunction(a))return this.each(function(b){c(this).wrapInner(a.call(this,b))});return this.each(function(){var b=c(this),d=b.contents();d.length?d.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){c(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){c.nodeName(this,"body")||c(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},
prepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,this)});else if(arguments.length){var a=c(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,
this.nextSibling)});else if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,c(arguments[0]).toArray());return a}},remove:function(a,b){for(var d=0,f;(f=this[d])!=null;d++)if(!a||c.filter(a,[f]).length){if(!b&&f.nodeType===1){c.cleanData(f.getElementsByTagName("*"));c.cleanData([f])}f.parentNode&&f.parentNode.removeChild(f)}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++)for(b.nodeType===1&&c.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);
return this},clone:function(a){var b=this.map(function(){if(!c.support.noCloneEvent&&!c.isXMLDoc(this)){var d=this.outerHTML,f=this.ownerDocument;if(!d){d=f.createElement("div");d.appendChild(this.cloneNode(true));d=d.innerHTML}return c.clean([d.replace(Ja,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(V,"")],f)[0]}else return this.cloneNode(true)});if(a===true){ra(this,b);ra(this.find("*"),b.find("*"))}return b},html:function(a){if(a===w)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(Ja,
""):null;else if(typeof a==="string"&&!ta.test(a)&&(c.support.leadingWhitespace||!V.test(a))&&!F[(La.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Ka,Ma);try{for(var b=0,d=this.length;b<d;b++)if(this[b].nodeType===1){c.cleanData(this[b].getElementsByTagName("*"));this[b].innerHTML=a}}catch(f){this.empty().append(a)}}else c.isFunction(a)?this.each(function(e){var j=c(this),i=j.html();j.empty().append(function(){return a.call(this,e,i)})}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&
this[0].parentNode){if(c.isFunction(a))return this.each(function(b){var d=c(this),f=d.html();d.replaceWith(a.call(this,b,f))});if(typeof a!=="string")a=c(a).detach();return this.each(function(){var b=this.nextSibling,d=this.parentNode;c(this).remove();b?c(b).before(a):c(d).append(a)})}else return this.pushStack(c(c.isFunction(a)?a():a),"replaceWith",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,b,d){function f(u){return c.nodeName(u,"table")?u.getElementsByTagName("tbody")[0]||
u.appendChild(u.ownerDocument.createElement("tbody")):u}var e,j,i=a[0],o=[],k;if(!c.support.checkClone&&arguments.length===3&&typeof i==="string"&&ua.test(i))return this.each(function(){c(this).domManip(a,b,d,true)});if(c.isFunction(i))return this.each(function(u){var z=c(this);a[0]=i.call(this,u,b?z.html():w);z.domManip(a,b,d)});if(this[0]){e=i&&i.parentNode;e=c.support.parentNode&&e&&e.nodeType===11&&e.childNodes.length===this.length?{fragment:e}:sa(a,this,o);k=e.fragment;if(j=k.childNodes.length===
1?(k=k.firstChild):k.firstChild){b=b&&c.nodeName(j,"tr");for(var n=0,r=this.length;n<r;n++)d.call(b?f(this[n],j):this[n],n>0||e.cacheable||this.length>1?k.cloneNode(true):k)}o.length&&c.each(o,Qa)}return this}});c.fragments={};c.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){c.fn[a]=function(d){var f=[];d=c(d);var e=this.length===1&&this[0].parentNode;if(e&&e.nodeType===11&&e.childNodes.length===1&&d.length===1){d[b](this[0]);
return this}else{e=0;for(var j=d.length;e<j;e++){var i=(e>0?this.clone(true):this).get();c.fn[b].apply(c(d[e]),i);f=f.concat(i)}return this.pushStack(f,a,d.selector)}}});c.extend({clean:function(a,b,d,f){b=b||s;if(typeof b.createElement==="undefined")b=b.ownerDocument||b[0]&&b[0].ownerDocument||s;for(var e=[],j=0,i;(i=a[j])!=null;j++){if(typeof i==="number")i+="";if(i){if(typeof i==="string"&&!jb.test(i))i=b.createTextNode(i);else if(typeof i==="string"){i=i.replace(Ka,Ma);var o=(La.exec(i)||["",
""])[1].toLowerCase(),k=F[o]||F._default,n=k[0],r=b.createElement("div");for(r.innerHTML=k[1]+i+k[2];n--;)r=r.lastChild;if(!c.support.tbody){n=ib.test(i);o=o==="table"&&!n?r.firstChild&&r.firstChild.childNodes:k[1]==="<table>"&&!n?r.childNodes:[];for(k=o.length-1;k>=0;--k)c.nodeName(o[k],"tbody")&&!o[k].childNodes.length&&o[k].parentNode.removeChild(o[k])}!c.support.leadingWhitespace&&V.test(i)&&r.insertBefore(b.createTextNode(V.exec(i)[0]),r.firstChild);i=r.childNodes}if(i.nodeType)e.push(i);else e=
c.merge(e,i)}}if(d)for(j=0;e[j];j++)if(f&&c.nodeName(e[j],"script")&&(!e[j].type||e[j].type.toLowerCase()==="text/javascript"))f.push(e[j].parentNode?e[j].parentNode.removeChild(e[j]):e[j]);else{e[j].nodeType===1&&e.splice.apply(e,[j+1,0].concat(c.makeArray(e[j].getElementsByTagName("script"))));d.appendChild(e[j])}return e},cleanData:function(a){for(var b,d,f=c.cache,e=c.event.special,j=c.support.deleteExpando,i=0,o;(o=a[i])!=null;i++)if(d=o[c.expando]){b=f[d];if(b.events)for(var k in b.events)e[k]?
c.event.remove(o,k):Ca(o,k,b.handle);if(j)delete o[c.expando];else o.removeAttribute&&o.removeAttribute(c.expando);delete f[d]}}});var kb=/z-?index|font-?weight|opacity|zoom|line-?height/i,Na=/alpha\([^)]*\)/,Oa=/opacity=([^)]*)/,ha=/float/i,ia=/-([a-z])/ig,lb=/([A-Z])/g,mb=/^-?\d+(?:px)?$/i,nb=/^-?\d/,ob={position:"absolute",visibility:"hidden",display:"block"},pb=["Left","Right"],qb=["Top","Bottom"],rb=s.defaultView&&s.defaultView.getComputedStyle,Pa=c.support.cssFloat?"cssFloat":"styleFloat",ja=
function(a,b){return b.toUpperCase()};c.fn.css=function(a,b){return X(this,a,b,true,function(d,f,e){if(e===w)return c.curCSS(d,f);if(typeof e==="number"&&!kb.test(f))e+="px";c.style(d,f,e)})};c.extend({style:function(a,b,d){if(!a||a.nodeType===3||a.nodeType===8)return w;if((b==="width"||b==="height")&&parseFloat(d)<0)d=w;var f=a.style||a,e=d!==w;if(!c.support.opacity&&b==="opacity"){if(e){f.zoom=1;b=parseInt(d,10)+""==="NaN"?"":"alpha(opacity="+d*100+")";a=f.filter||c.curCSS(a,"filter")||"";f.filter=
Na.test(a)?a.replace(Na,b):b}return f.filter&&f.filter.indexOf("opacity=")>=0?parseFloat(Oa.exec(f.filter)[1])/100+"":""}if(ha.test(b))b=Pa;b=b.replace(ia,ja);if(e)f[b]=d;return f[b]},css:function(a,b,d,f){if(b==="width"||b==="height"){var e,j=b==="width"?pb:qb;function i(){e=b==="width"?a.offsetWidth:a.offsetHeight;f!=="border"&&c.each(j,function(){f||(e-=parseFloat(c.curCSS(a,"padding"+this,true))||0);if(f==="margin")e+=parseFloat(c.curCSS(a,"margin"+this,true))||0;else e-=parseFloat(c.curCSS(a,
"border"+this+"Width",true))||0})}a.offsetWidth!==0?i():c.swap(a,ob,i);return Math.max(0,Math.round(e))}return c.curCSS(a,b,d)},curCSS:function(a,b,d){var f,e=a.style;if(!c.support.opacity&&b==="opacity"&&a.currentStyle){f=Oa.test(a.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"";return f===""?"1":f}if(ha.test(b))b=Pa;if(!d&&e&&e[b])f=e[b];else if(rb){if(ha.test(b))b="float";b=b.replace(lb,"-$1").toLowerCase();e=a.ownerDocument.defaultView;if(!e)return null;if(a=e.getComputedStyle(a,null))f=
a.getPropertyValue(b);if(b==="opacity"&&f==="")f="1"}else if(a.currentStyle){d=b.replace(ia,ja);f=a.currentStyle[b]||a.currentStyle[d];if(!mb.test(f)&&nb.test(f)){b=e.left;var j=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;e.left=d==="fontSize"?"1em":f||0;f=e.pixelLeft+"px";e.left=b;a.runtimeStyle.left=j}}return f},swap:function(a,b,d){var f={};for(var e in b){f[e]=a.style[e];a.style[e]=b[e]}d.call(a);for(e in b)a.style[e]=f[e]}});if(c.expr&&c.expr.filters){c.expr.filters.hidden=function(a){var b=
a.offsetWidth,d=a.offsetHeight,f=a.nodeName.toLowerCase()==="tr";return b===0&&d===0&&!f?true:b>0&&d>0&&!f?false:c.curCSS(a,"display")==="none"};c.expr.filters.visible=function(a){return!c.expr.filters.hidden(a)}}var sb=J(),tb=/<script(.|\s)*?\/script>/gi,ub=/select|textarea/i,vb=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,N=/=\?(&|$)/,ka=/\?/,wb=/(\?|&)_=.*?(&|$)/,xb=/^(\w+:)?\/\/([^\/?#]+)/,yb=/%20/g,zb=c.fn.load;c.fn.extend({load:function(a,b,d){if(typeof a!==
"string")return zb.call(this,a);else if(!this.length)return this;var f=a.indexOf(" ");if(f>=0){var e=a.slice(f,a.length);a=a.slice(0,f)}f="GET";if(b)if(c.isFunction(b)){d=b;b=null}else if(typeof b==="object"){b=c.param(b,c.ajaxSettings.traditional);f="POST"}var j=this;c.ajax({url:a,type:f,dataType:"html",data:b,complete:function(i,o){if(o==="success"||o==="notmodified")j.html(e?c("<div />").append(i.responseText.replace(tb,"")).find(e):i.responseText);d&&j.each(d,[i.responseText,o,i])}});return this},
serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?c.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ub.test(this.nodeName)||vb.test(this.type))}).map(function(a,b){a=c(this).val();return a==null?null:c.isArray(a)?c.map(a,function(d){return{name:b.name,value:d}}):{name:b.name,value:a}}).get()}});c.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),
function(a,b){c.fn[b]=function(d){return this.bind(b,d)}});c.extend({get:function(a,b,d,f){if(c.isFunction(b)){f=f||d;d=b;b=null}return c.ajax({type:"GET",url:a,data:b,success:d,dataType:f})},getScript:function(a,b){return c.get(a,null,b,"script")},getJSON:function(a,b,d){return c.get(a,b,d,"json")},post:function(a,b,d,f){if(c.isFunction(b)){f=f||d;d=b;b={}}return c.ajax({type:"POST",url:a,data:b,success:d,dataType:f})},ajaxSetup:function(a){c.extend(c.ajaxSettings,a)},ajaxSettings:{url:location.href,
global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:A.XMLHttpRequest&&(A.location.protocol!=="file:"||!A.ActiveXObject)?function(){return new A.XMLHttpRequest}:function(){try{return new A.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(a){function b(){e.success&&
e.success.call(k,o,i,x);e.global&&f("ajaxSuccess",[x,e])}function d(){e.complete&&e.complete.call(k,x,i);e.global&&f("ajaxComplete",[x,e]);e.global&&!--c.active&&c.event.trigger("ajaxStop")}function f(q,p){(e.context?c(e.context):c.event).trigger(q,p)}var e=c.extend(true,{},c.ajaxSettings,a),j,i,o,k=a&&a.context||e,n=e.type.toUpperCase();if(e.data&&e.processData&&typeof e.data!=="string")e.data=c.param(e.data,e.traditional);if(e.dataType==="jsonp"){if(n==="GET")N.test(e.url)||(e.url+=(ka.test(e.url)?
"&":"?")+(e.jsonp||"callback")+"=?");else if(!e.data||!N.test(e.data))e.data=(e.data?e.data+"&":"")+(e.jsonp||"callback")+"=?";e.dataType="json"}if(e.dataType==="json"&&(e.data&&N.test(e.data)||N.test(e.url))){j=e.jsonpCallback||"jsonp"+sb++;if(e.data)e.data=(e.data+"").replace(N,"="+j+"$1");e.url=e.url.replace(N,"="+j+"$1");e.dataType="script";A[j]=A[j]||function(q){o=q;b();d();A[j]=w;try{delete A[j]}catch(p){}z&&z.removeChild(C)}}if(e.dataType==="script"&&e.cache===null)e.cache=false;if(e.cache===
false&&n==="GET"){var r=J(),u=e.url.replace(wb,"$1_="+r+"$2");e.url=u+(u===e.url?(ka.test(e.url)?"&":"?")+"_="+r:"")}if(e.data&&n==="GET")e.url+=(ka.test(e.url)?"&":"?")+e.data;e.global&&!c.active++&&c.event.trigger("ajaxStart");r=(r=xb.exec(e.url))&&(r[1]&&r[1]!==location.protocol||r[2]!==location.host);if(e.dataType==="script"&&n==="GET"&&r){var z=s.getElementsByTagName("head")[0]||s.documentElement,C=s.createElement("script");C.src=e.url;if(e.scriptCharset)C.charset=e.scriptCharset;if(!j){var B=
false;C.onload=C.onreadystatechange=function(){if(!B&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){B=true;b();d();C.onload=C.onreadystatechange=null;z&&C.parentNode&&z.removeChild(C)}}}z.insertBefore(C,z.firstChild);return w}var E=false,x=e.xhr();if(x){e.username?x.open(n,e.url,e.async,e.username,e.password):x.open(n,e.url,e.async);try{if(e.data||a&&a.contentType)x.setRequestHeader("Content-Type",e.contentType);if(e.ifModified){c.lastModified[e.url]&&x.setRequestHeader("If-Modified-Since",
c.lastModified[e.url]);c.etag[e.url]&&x.setRequestHeader("If-None-Match",c.etag[e.url])}r||x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Accept",e.dataType&&e.accepts[e.dataType]?e.accepts[e.dataType]+", */*":e.accepts._default)}catch(ga){}if(e.beforeSend&&e.beforeSend.call(k,x,e)===false){e.global&&!--c.active&&c.event.trigger("ajaxStop");x.abort();return false}e.global&&f("ajaxSend",[x,e]);var g=x.onreadystatechange=function(q){if(!x||x.readyState===0||q==="abort"){E||
d();E=true;if(x)x.onreadystatechange=c.noop}else if(!E&&x&&(x.readyState===4||q==="timeout")){E=true;x.onreadystatechange=c.noop;i=q==="timeout"?"timeout":!c.httpSuccess(x)?"error":e.ifModified&&c.httpNotModified(x,e.url)?"notmodified":"success";var p;if(i==="success")try{o=c.httpData(x,e.dataType,e)}catch(v){i="parsererror";p=v}if(i==="success"||i==="notmodified")j||b();else c.handleError(e,x,i,p);d();q==="timeout"&&x.abort();if(e.async)x=null}};try{var h=x.abort;x.abort=function(){x&&h.call(x);
g("abort")}}catch(l){}e.async&&e.timeout>0&&setTimeout(function(){x&&!E&&g("timeout")},e.timeout);try{x.send(n==="POST"||n==="PUT"||n==="DELETE"?e.data:null)}catch(m){c.handleError(e,x,null,m);d()}e.async||g();return x}},handleError:function(a,b,d,f){if(a.error)a.error.call(a.context||a,b,d,f);if(a.global)(a.context?c(a.context):c.event).trigger("ajaxError",[b,a,f])},active:0,httpSuccess:function(a){try{return!a.status&&location.protocol==="file:"||a.status>=200&&a.status<300||a.status===304||a.status===
1223||a.status===0}catch(b){}return false},httpNotModified:function(a,b){var d=a.getResponseHeader("Last-Modified"),f=a.getResponseHeader("Etag");if(d)c.lastModified[b]=d;if(f)c.etag[b]=f;return a.status===304||a.status===0},httpData:function(a,b,d){var f=a.getResponseHeader("content-type")||"",e=b==="xml"||!b&&f.indexOf("xml")>=0;a=e?a.responseXML:a.responseText;e&&a.documentElement.nodeName==="parsererror"&&c.error("parsererror");if(d&&d.dataFilter)a=d.dataFilter(a,b);if(typeof a==="string")if(b===
"json"||!b&&f.indexOf("json")>=0)a=c.parseJSON(a);else if(b==="script"||!b&&f.indexOf("javascript")>=0)c.globalEval(a);return a},param:function(a,b){function d(i,o){if(c.isArray(o))c.each(o,function(k,n){b||/\[\]$/.test(i)?f(i,n):d(i+"["+(typeof n==="object"||c.isArray(n)?k:"")+"]",n)});else!b&&o!=null&&typeof o==="object"?c.each(o,function(k,n){d(i+"["+k+"]",n)}):f(i,o)}function f(i,o){o=c.isFunction(o)?o():o;e[e.length]=encodeURIComponent(i)+"="+encodeURIComponent(o)}var e=[];if(b===w)b=c.ajaxSettings.traditional;
if(c.isArray(a)||a.jquery)c.each(a,function(){f(this.name,this.value)});else for(var j in a)d(j,a[j]);return e.join("&").replace(yb,"+")}});var la={},Ab=/toggle|show|hide/,Bb=/^([+-]=)?([\d+-.]+)(.*)$/,W,va=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];c.fn.extend({show:function(a,b){if(a||a===0)return this.animate(K("show",3),a,b);else{a=0;for(b=this.length;a<b;a++){var d=c.data(this[a],"olddisplay");
this[a].style.display=d||"";if(c.css(this[a],"display")==="none"){d=this[a].nodeName;var f;if(la[d])f=la[d];else{var e=c("<"+d+" />").appendTo("body");f=e.css("display");if(f==="none")f="block";e.remove();la[d]=f}c.data(this[a],"olddisplay",f)}}a=0;for(b=this.length;a<b;a++)this[a].style.display=c.data(this[a],"olddisplay")||"";return this}},hide:function(a,b){if(a||a===0)return this.animate(K("hide",3),a,b);else{a=0;for(b=this.length;a<b;a++){var d=c.data(this[a],"olddisplay");!d&&d!=="none"&&c.data(this[a],
"olddisplay",c.css(this[a],"display"))}a=0;for(b=this.length;a<b;a++)this[a].style.display="none";return this}},_toggle:c.fn.toggle,toggle:function(a,b){var d=typeof a==="boolean";if(c.isFunction(a)&&c.isFunction(b))this._toggle.apply(this,arguments);else a==null||d?this.each(function(){var f=d?a:c(this).is(":hidden");c(this)[f?"show":"hide"]()}):this.animate(K("toggle",3),a,b);return this},fadeTo:function(a,b,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,d)},
animate:function(a,b,d,f){var e=c.speed(b,d,f);if(c.isEmptyObject(a))return this.each(e.complete);return this[e.queue===false?"each":"queue"](function(){var j=c.extend({},e),i,o=this.nodeType===1&&c(this).is(":hidden"),k=this;for(i in a){var n=i.replace(ia,ja);if(i!==n){a[n]=a[i];delete a[i];i=n}if(a[i]==="hide"&&o||a[i]==="show"&&!o)return j.complete.call(this);if((i==="height"||i==="width")&&this.style){j.display=c.css(this,"display");j.overflow=this.style.overflow}if(c.isArray(a[i])){(j.specialEasing=
j.specialEasing||{})[i]=a[i][1];a[i]=a[i][0]}}if(j.overflow!=null)this.style.overflow="hidden";j.curAnim=c.extend({},a);c.each(a,function(r,u){var z=new c.fx(k,j,r);if(Ab.test(u))z[u==="toggle"?o?"show":"hide":u](a);else{var C=Bb.exec(u),B=z.cur(true)||0;if(C){u=parseFloat(C[2]);var E=C[3]||"px";if(E!=="px"){k.style[r]=(u||1)+E;B=(u||1)/z.cur(true)*B;k.style[r]=B+E}if(C[1])u=(C[1]==="-="?-1:1)*u+B;z.custom(B,u,E)}else z.custom(B,u,"")}});return true})},stop:function(a,b){var d=c.timers;a&&this.queue([]);
this.each(function(){for(var f=d.length-1;f>=0;f--)if(d[f].elem===this){b&&d[f](true);d.splice(f,1)}});b||this.dequeue();return this}});c.each({slideDown:K("show",1),slideUp:K("hide",1),slideToggle:K("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(a,b){c.fn[a]=function(d,f){return this.animate(b,d,f)}});c.extend({speed:function(a,b,d){var f=a&&typeof a==="object"?a:{complete:d||!d&&b||c.isFunction(a)&&a,duration:a,easing:d&&b||b&&!c.isFunction(b)&&b};f.duration=c.fx.off?0:typeof f.duration===
"number"?f.duration:c.fx.speeds[f.duration]||c.fx.speeds._default;f.old=f.complete;f.complete=function(){f.queue!==false&&c(this).dequeue();c.isFunction(f.old)&&f.old.call(this)};return f},easing:{linear:function(a,b,d,f){return d+f*a},swing:function(a,b,d,f){return(-Math.cos(a*Math.PI)/2+0.5)*f+d}},timers:[],fx:function(a,b,d){this.options=b;this.elem=a;this.prop=d;if(!b.orig)b.orig={}}});c.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(c.fx.step[this.prop]||
c.fx.step._default)(this);if((this.prop==="height"||this.prop==="width")&&this.elem.style)this.elem.style.display="block"},cur:function(a){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];return(a=parseFloat(c.css(this.elem,this.prop,a)))&&a>-10000?a:parseFloat(c.curCSS(this.elem,this.prop))||0},custom:function(a,b,d){function f(j){return e.step(j)}this.startTime=J();this.start=a;this.end=b;this.unit=d||this.unit||"px";this.now=this.start;
this.pos=this.state=0;var e=this;f.elem=this.elem;if(f()&&c.timers.push(f)&&!W)W=setInterval(c.fx.tick,13)},show:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());c(this.elem).show()},hide:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(a){var b=J(),d=true;if(a||b>=this.options.duration+this.startTime){this.now=
this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var f in this.options.curAnim)if(this.options.curAnim[f]!==true)d=false;if(d){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;a=c.data(this.elem,"olddisplay");this.elem.style.display=a?a:this.options.display;if(c.css(this.elem,"display")==="none")this.elem.style.display="block"}this.options.hide&&c(this.elem).hide();if(this.options.hide||this.options.show)for(var e in this.options.curAnim)c.style(this.elem,
e,this.options.orig[e]);this.options.complete.call(this.elem)}return false}else{e=b-this.startTime;this.state=e/this.options.duration;a=this.options.easing||(c.easing.swing?"swing":"linear");this.pos=c.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||a](this.state,e,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};c.extend(c.fx,{tick:function(){for(var a=c.timers,b=0;b<a.length;b++)a[b]()||a.splice(b--,1);a.length||
c.fx.stop()},stop:function(){clearInterval(W);W=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){c.style(a.elem,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null)a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(c.expr&&c.expr.filters)c.expr.filters.animated=function(a){return c.grep(c.timers,function(b){return a===b.elem}).length};c.fn.offset="getBoundingClientRect"in s.documentElement?
function(a){var b=this[0];if(a)return this.each(function(e){c.offset.setOffset(this,a,e)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);var d=b.getBoundingClientRect(),f=b.ownerDocument;b=f.body;f=f.documentElement;return{top:d.top+(self.pageYOffset||c.support.boxModel&&f.scrollTop||b.scrollTop)-(f.clientTop||b.clientTop||0),left:d.left+(self.pageXOffset||c.support.boxModel&&f.scrollLeft||b.scrollLeft)-(f.clientLeft||b.clientLeft||0)}}:function(a){var b=
this[0];if(a)return this.each(function(r){c.offset.setOffset(this,a,r)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);c.offset.initialize();var d=b.offsetParent,f=b,e=b.ownerDocument,j,i=e.documentElement,o=e.body;f=(e=e.defaultView)?e.getComputedStyle(b,null):b.currentStyle;for(var k=b.offsetTop,n=b.offsetLeft;(b=b.parentNode)&&b!==o&&b!==i;){if(c.offset.supportsFixedPosition&&f.position==="fixed")break;j=e?e.getComputedStyle(b,null):b.currentStyle;
k-=b.scrollTop;n-=b.scrollLeft;if(b===d){k+=b.offsetTop;n+=b.offsetLeft;if(c.offset.doesNotAddBorder&&!(c.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(b.nodeName))){k+=parseFloat(j.borderTopWidth)||0;n+=parseFloat(j.borderLeftWidth)||0}f=d;d=b.offsetParent}if(c.offset.subtractsBorderForOverflowNotVisible&&j.overflow!=="visible"){k+=parseFloat(j.borderTopWidth)||0;n+=parseFloat(j.borderLeftWidth)||0}f=j}if(f.position==="relative"||f.position==="static"){k+=o.offsetTop;n+=o.offsetLeft}if(c.offset.supportsFixedPosition&&
f.position==="fixed"){k+=Math.max(i.scrollTop,o.scrollTop);n+=Math.max(i.scrollLeft,o.scrollLeft)}return{top:k,left:n}};c.offset={initialize:function(){var a=s.body,b=s.createElement("div"),d,f,e,j=parseFloat(c.curCSS(a,"marginTop",true))||0;c.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});b.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";
a.insertBefore(b,a.firstChild);d=b.firstChild;f=d.firstChild;e=d.nextSibling.firstChild.firstChild;this.doesNotAddBorder=f.offsetTop!==5;this.doesAddBorderForTableAndCells=e.offsetTop===5;f.style.position="fixed";f.style.top="20px";this.supportsFixedPosition=f.offsetTop===20||f.offsetTop===15;f.style.position=f.style.top="";d.style.overflow="hidden";d.style.position="relative";this.subtractsBorderForOverflowNotVisible=f.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==j;a.removeChild(b);
c.offset.initialize=c.noop},bodyOffset:function(a){var b=a.offsetTop,d=a.offsetLeft;c.offset.initialize();if(c.offset.doesNotIncludeMarginInBodyOffset){b+=parseFloat(c.curCSS(a,"marginTop",true))||0;d+=parseFloat(c.curCSS(a,"marginLeft",true))||0}return{top:b,left:d}},setOffset:function(a,b,d){if(/static/.test(c.curCSS(a,"position")))a.style.position="relative";var f=c(a),e=f.offset(),j=parseInt(c.curCSS(a,"top",true),10)||0,i=parseInt(c.curCSS(a,"left",true),10)||0;if(c.isFunction(b))b=b.call(a,
d,e);d={top:b.top-e.top+j,left:b.left-e.left+i};"using"in b?b.using.call(a,d):f.css(d)}};c.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),d=this.offset(),f=/^body|html$/i.test(b[0].nodeName)?{top:0,left:0}:b.offset();d.top-=parseFloat(c.curCSS(a,"marginTop",true))||0;d.left-=parseFloat(c.curCSS(a,"marginLeft",true))||0;f.top+=parseFloat(c.curCSS(b[0],"borderTopWidth",true))||0;f.left+=parseFloat(c.curCSS(b[0],"borderLeftWidth",true))||0;return{top:d.top-
f.top,left:d.left-f.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||s.body;a&&!/^body|html$/i.test(a.nodeName)&&c.css(a,"position")==="static";)a=a.offsetParent;return a})}});c.each(["Left","Top"],function(a,b){var d="scroll"+b;c.fn[d]=function(f){var e=this[0],j;if(!e)return null;if(f!==w)return this.each(function(){if(j=wa(this))j.scrollTo(!a?f:c(j).scrollLeft(),a?f:c(j).scrollTop());else this[d]=f});else return(j=wa(e))?"pageXOffset"in j?j[a?"pageYOffset":
"pageXOffset"]:c.support.boxModel&&j.document.documentElement[d]||j.document.body[d]:e[d]}});c.each(["Height","Width"],function(a,b){var d=b.toLowerCase();c.fn["inner"+b]=function(){return this[0]?c.css(this[0],d,false,"padding"):null};c.fn["outer"+b]=function(f){return this[0]?c.css(this[0],d,false,f?"margin":"border"):null};c.fn[d]=function(f){var e=this[0];if(!e)return f==null?null:this;if(c.isFunction(f))return this.each(function(j){var i=c(this);i[d](f.call(this,j,i[d]()))});return"scrollTo"in
e&&e.document?e.document.compatMode==="CSS1Compat"&&e.document.documentElement["client"+b]||e.document.body["client"+b]:e.nodeType===9?Math.max(e.documentElement["client"+b],e.body["scroll"+b],e.documentElement["scroll"+b],e.body["offset"+b],e.documentElement["offset"+b]):f===w?c.css(e,d):this.css(d,typeof f==="string"?f:f+"px")}});A.jQuery=A.$=c})(window);
/**
 * Copyright (c) 2010, Ben Firshman
 * All rights reserved.
 *  
 * Redistribution and use in source and binary forms, with or without 
 * modification, are permitted provided that the following conditions are met:
 *  
 *  * Redistributions of source code must retain the above copyright notice, this 
 *    list of conditions and the following disclaimer.
 *  * Redistributions in binary form must reproduce the above copyright notice, 
 *    this list of conditions and the following disclaimer in the documentation 
 *    and/or other materials provided with the distribution.
 *  * The names of its contributors may not be used to endorse or promote products 
 *    derived from this software without specific prior written permission.
 *  
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND 
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR 
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES 
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; 
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON 
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT 
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SWFObject v2.2 <http://code.google.com/p/swfobject/>
 * is released under the MIT License
 * <http://www.opensource.org/licenses/mit-license.php>
 */
var swfobject=function(){var m="undefined",t="object",W="Shockwave Flash",bh="ShockwaveFlash.ShockwaveFlash",F="application/x-shockwave-flash",X="SWFObjectExprInst",Y="onreadystatechange",r=window,j=document,w=navigator,Z=false,G=[bi],x=[],H=[],B=[],D,I,O,ba,z=false,J=false,u,P,bb=true,f=function(){var a=typeof j.getElementById!=m&&typeof j.getElementsByTagName!=m&&typeof j.createElement!=m,c=w.userAgent.toLowerCase(),b=w.platform.toLowerCase(),d=b?/win/.test(b):/win/.test(c),g=b?/mac/.test(b):/mac/.test(c),i=/webkit/.test(c)?parseFloat(c.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,h=!+"\v1",o=[0,0,0],l=null;if(typeof w.plugins!=m&&typeof w.plugins[W]==t){l=w.plugins[W].description;if(l&&!(typeof w.mimeTypes!=m&&w.mimeTypes[F]&&!w.mimeTypes[F].enabledPlugin)){Z=true;h=false;l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1");o[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10);o[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10);o[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof r.ActiveXObject!=m){try{var q=new ActiveXObject(bh);if(q){l=q.GetVariable("$version");if(l){h=true;l=l.split(" ")[1].split(",");o=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)]}}}catch(e){}}return{w3:a,pv:o,wk:i,ie:h,win:d,mac:g}}(),bo=function(){if(!f.w3){return}if((typeof j.readyState!=m&&j.readyState=="complete")||(typeof j.readyState==m&&(j.getElementsByTagName("body")[0]||j.body))){C()}if(!z){if(typeof j.addEventListener!=m){j.addEventListener("DOMContentLoaded",C,false)}if(f.ie&&f.win){j.attachEvent(Y,function(){if(j.readyState=="complete"){j.detachEvent(Y,arguments.callee);C()}});if(r==top){(function(){if(z){return}try{j.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()})()}}if(f.wk){(function(){if(z){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}C()})()}bc(C)}}();function C(){if(z){return}try{var a=j.getElementsByTagName("body")[0].appendChild(y("span"));a.parentNode.removeChild(a)}catch(e){return}z=true;var c=G.length;for(var b=0;b<c;b++){G[b]()}}function bd(a){if(z){a()}else{G[G.length]=a}}function bc(a){if(typeof r.addEventListener!=m){r.addEventListener("load",a,false)}else if(typeof j.addEventListener!=m){j.addEventListener("load",a,false)}else if(typeof r.attachEvent!=m){bj(r,"onload",a)}else if(typeof r.onload=="function"){var c=r.onload;r.onload=function(){c();a()}}else{r.onload=a}}function bi(){if(Z){bk()}else{Q()}}function bk(){var c=j.getElementsByTagName("body")[0];var b=y(t);b.setAttribute("type",F);var d=c.appendChild(b);if(d){var g=0;(function(){if(typeof d.GetVariable!=m){var a=d.GetVariable("$version");if(a){a=a.split(" ")[1].split(",");f.pv=[parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10)]}}else if(g<10){g++;setTimeout(arguments.callee,10);return}c.removeChild(b);d=null;Q()})()}else{Q()}}function Q(){var a=x.length;if(a>0){for(var c=0;c<a;c++){var b=x[c].id;var d=x[c].callbackFn;var g={success:false,id:b};if(f.pv[0]>0){var i=s(b);if(i){if(K(x[c].swfVersion)&&!(f.wk&&f.wk<312)){A(b,true);if(d){g.success=true;g.ref=R(b);d(g)}}else if(x[c].expressInstall&&S()){var h={};h.data=x[c].expressInstall;h.width=i.getAttribute("width")||"0";h.height=i.getAttribute("height")||"0";if(i.getAttribute("class")){h.styleclass=i.getAttribute("class")}if(i.getAttribute("align")){h.align=i.getAttribute("align")}var o={};var l=i.getElementsByTagName("param");var q=l.length;for(var p=0;p<q;p++){if(l[p].getAttribute("name").toLowerCase()!="movie"){o[l[p].getAttribute("name")]=l[p].getAttribute("value")}}T(h,o,b,d)}else{bl(i);if(d){d(g)}}}}else{A(b,true);if(d){var v=R(b);if(v&&typeof v.SetVariable!=m){g.success=true;g.ref=v}d(g)}}}}}function R(a){var c=null;var b=s(a);if(b&&b.nodeName=="OBJECT"){if(typeof b.SetVariable!=m){c=b}else{var d=b.getElementsByTagName(t)[0];if(d){c=d}}}return c}function S(){return!J&&K("6.0.65")&&(f.win||f.mac)&&!(f.wk&&f.wk<312)}function T(a,c,b,d){J=true;O=d||null;ba={success:false,id:b};var g=s(b);if(g){if(g.nodeName=="OBJECT"){D=U(g);I=null}else{D=g;I=b}a.id=X;if(typeof a.width==m||(!/%$/.test(a.width)&&parseInt(a.width,10)<310)){a.width="310"}if(typeof a.height==m||(!/%$/.test(a.height)&&parseInt(a.height,10)<137)){a.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var i=f.ie&&f.win?"ActiveX":"PlugIn",h="MMredirectURL="+r.location.toString().replace(/&/g,"%26")+"&MMplayerType="+i+"&MMdoctitle="+j.title;if(typeof c.flashvars!=m){c.flashvars+="&"+h}else{c.flashvars=h}if(f.ie&&f.win&&g.readyState!=4){var o=y("div");b+="SWFObjectNew";o.setAttribute("id",b);g.parentNode.insertBefore(o,g);g.style.display="none";(function(){if(g.readyState==4){g.parentNode.removeChild(g)}else{setTimeout(arguments.callee,10)}})()}V(a,c,b)}}function bl(a){if(f.ie&&f.win&&a.readyState!=4){var c=y("div");a.parentNode.insertBefore(c,a);c.parentNode.replaceChild(U(a),c);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}else{a.parentNode.replaceChild(U(a),a)}}function U(a){var c=y("div");if(f.win&&f.ie){c.innerHTML=a.innerHTML}else{var b=a.getElementsByTagName(t)[0];if(b){var d=b.childNodes;if(d){var g=d.length;for(var i=0;i<g;i++){if(!(d[i].nodeType==1&&d[i].nodeName=="PARAM")&&!(d[i].nodeType==8)){c.appendChild(d[i].cloneNode(true))}}}}}return c}function V(a,c,b){var d,g=s(b);if(f.wk&&f.wk<312){return d}if(g){if(typeof a.id==m){a.id=b}if(f.ie&&f.win){var i="";for(var h in a){if(a[h]!=Object.prototype[h]){if(h.toLowerCase()=="data"){c.movie=a[h]}else if(h.toLowerCase()=="styleclass"){i+=' class="'+a[h]+'"'}else if(h.toLowerCase()!="classid"){i+=' '+h+'="'+a[h]+'"'}}}var o="";for(var l in c){if(c[l]!=Object.prototype[l]){o+='<param name="'+l+'" value="'+c[l]+'" />'}}g.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+'>'+o+'</object>';H[H.length]=a.id;d=s(a.id)}else{var q=y(t);q.setAttribute("type",F);for(var p in a){if(a[p]!=Object.prototype[p]){if(p.toLowerCase()=="styleclass"){q.setAttribute("class",a[p])}else if(p.toLowerCase()!="classid"){q.setAttribute(p,a[p])}}}for(var n in c){if(c[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){bm(q,n,c[n])}}g.parentNode.replaceChild(q,g);d=q}}return d}function bm(a,c,b){var d=y("param");d.setAttribute("name",c);d.setAttribute("value",b);a.appendChild(d)}function be(a){var c=s(a);if(c&&c.nodeName=="OBJECT"){if(f.ie&&f.win){c.style.display="none";(function(){if(c.readyState==4){bn(a)}else{setTimeout(arguments.callee,10)}})()}else{c.parentNode.removeChild(c)}}}function bn(a){var c=s(a);if(c){for(var b in c){if(typeof c[b]=="function"){c[b]=null}}c.parentNode.removeChild(c)}}function s(a){var c=null;try{c=j.getElementById(a)}catch(e){}return c}function y(a){return j.createElement(a)}function bj(a,c,b){a.attachEvent(c,b);B[B.length]=[a,c,b]}function K(a){var c=f.pv,b=a.split(".");b[0]=parseInt(b[0],10);b[1]=parseInt(b[1],10)||0;b[2]=parseInt(b[2],10)||0;return(c[0]>b[0]||(c[0]==b[0]&&c[1]>b[1])||(c[0]==b[0]&&c[1]==b[1]&&c[2]>=b[2]))?true:false}function bf(a,c,b,d){if(f.ie&&f.mac){return}var g=j.getElementsByTagName("head")[0];if(!g){return}var i=(b&&typeof b=="string")?b:"screen";if(d){u=null;P=null}if(!u||P!=i){var h=y("style");h.setAttribute("type","text/css");h.setAttribute("media",i);u=g.appendChild(h);if(f.ie&&f.win&&typeof j.styleSheets!=m&&j.styleSheets.length>0){u=j.styleSheets[j.styleSheets.length-1]}P=i}if(f.ie&&f.win){if(u&&typeof u.addRule==t){u.addRule(a,c)}}else{if(u&&typeof j.createTextNode!=m){u.appendChild(j.createTextNode(a+" {"+c+"}"))}}}function A(a,c){if(!bb){return}var b=c?"visible":"hidden";if(z&&s(a)){s(a).style.visibility=b}else{bf("#"+a,"visibility:"+b)}}function bg(a){var c=/[\\\"<>\.;]/;var b=c.exec(a)!=null;return b&&typeof encodeURIComponent!=m?encodeURIComponent(a):a}var bp=function(){if(f.ie&&f.win){window.attachEvent("onunload",function(){var a=B.length;for(var c=0;c<a;c++){B[c][0].detachEvent(B[c][1],B[c][2])}var b=H.length;for(var d=0;d<b;d++){be(H[d])}for(var g in f){f[g]=null}f=null;for(var i in swfobject){swfobject[i]=null}swfobject=null})}}();return{registerObject:function(a,c,b,d){if(f.w3&&a&&c){var g={};g.id=a;g.swfVersion=c;g.expressInstall=b;g.callbackFn=d;x[x.length]=g;A(a,false)}else if(d){d({success:false,id:a})}},getObjectById:function(a){if(f.w3){return R(a)}},embedSWF:function(i,h,o,l,q,p,v,L,M,E){var N={success:false,id:h};if(f.w3&&!(f.wk&&f.wk<312)&&i&&h&&o&&l&&q){A(h,false);bd(function(){o+="";l+="";var a={};if(M&&typeof M===t){for(var c in M){a[c]=M[c]}}a.data=i;a.width=o;a.height=l;var b={};if(L&&typeof L===t){for(var d in L){b[d]=L[d]}}if(v&&typeof v===t){for(var k in v){if(typeof b.flashvars!=m){b.flashvars+="&"+k+"="+v[k]}else{b.flashvars=k+"="+v[k]}}}if(K(q)){var g=V(a,b,h);if(a.id==h){A(h,true)}N.success=true;N.ref=g}else if(p&&S()){a.data=p;T(a,b,h,E);return}else{A(h,true)}if(E){E(N)}})}else if(E){E(N)}},switchOffAutoHideShow:function(){bb=false},ua:f,getFlashPlayerVersion:function(){return{major:f.pv[0],minor:f.pv[1],release:f.pv[2]}},hasFlashPlayerVersion:K,createSWF:function(a,c,b){if(f.w3){return V(a,c,b)}else{return undefined}},showExpressInstall:function(a,c,b,d){if(f.w3&&S()){T(a,c,b,d)}},removeSWF:function(a){if(f.w3){be(a)}},createCSS:function(a,c,b,d){if(f.w3){bf(a,c,b,d)}},addDomLoadEvent:bd,addLoadEvent:bc,getQueryParamValue:function(a){var c=j.location.search||j.location.hash;if(c){if(/\?/.test(c)){c=c.split("?")[1]}if(a==null){return bg(c)}var b=c.split("&");for(var d=0;d<b.length;d++){if(b[d].substring(0,b[d].indexOf("="))==a){return bg(b[d].substring((b[d].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(J){var a=s(X);if(a&&D){a.parentNode.replaceChild(D,a);if(I){A(I,true);if(f.ie&&f.win){D.style.display="block"}}if(O){O(ba)}}J=false}}}}();window.AudioContext=window.AudioContext||window.webkitAudioContext;function DynamicAudio(a){if(this instanceof arguments.callee){if(typeof this.init==="function"){this.init.apply(this,(a&&a.callee)?a:arguments)}}else{return new arguments.callee(arguments)}}DynamicAudio.VERSION="0.2";DynamicAudio.nextId=1;DynamicAudio.prototype={nextId:null,swf:'dynamicaudio.swf',audioContext:null,flashWrapper:null,flashElement:null,init:function(c){var b=this;b.id=DynamicAudio.nextId++;if(c&&typeof c['swf']!=='undefined'){b.swf=c['swf']}try{b.audioContext=new AudioContext()}catch(e){console.log('Couldn\'t create AudioContext:'+e+', falling back to flash player');b.flashWrapper=document.createElement('div');b.flashWrapper.id='dynamicaudio-flashwrapper-'+b.id;var d=b.flashWrapper.style;d['position']='fixed';d['width']=d['height']='8px';d['bottom']=d['left']='0px';d['overflow']='hidden';b.flashElement=document.createElement('div');b.flashElement.id='dynamicaudio-flashelement-'+b.id;b.flashWrapper.appendChild(b.flashElement);document.body.appendChild(b.flashWrapper);swfobject.embedSWF(b.swf,b.flashElement.id,"8","8","9.0.0",null,null,{'allowScriptAccess':'always'},null,function(a){b.flashElement=a.ref})}},write:function(a){if(this.audioContext!==null){this.webAudioWrite(a)}else if(this.flashElement!==null){var c=new Array(a.length);for(var b=a.length-1;b!==0;b--){c[b]=this.floatToIntSample(a[b])}this.flashElement.write(c.join(' '))}},writeInt:function(a){if(this.audioContext!==null){this.webAudioWrite(a,this.intToFloatSample)}else if(this.flashElement!==null){this.flashElement.write(a.join(' '))}},webAudioWrite:function(a,c){var b=this.audioContext.createBuffer(2,a.length,this.audioContext.sampleRate);var d=b.getChannelData(0);var g=b.getChannelData(1);var i=0;if(c){for(var h=0;h<a.length;h+=2){d[i]=c(a[h]);g[i]=c(a[h+1]);i++}}else{for(var h=0;h<a.length;h+=2){d[i]=a[h];g[i]=a[h+1];i++}}var o=this.audioContext.createBufferSource();o.buffer=b;o.connect(this.audioContext.destination);o.start()},intToFloatSample:function(a){return a/32768},floatToIntSample:function(a){return Math.floor(a*32768)}};var JSNES=function(opts){this.opts={ui:JSNES.DummyUI,swfPath:"lib/",preferredFrameRate:60,fpsInterval:500,showDisplay:true,emulateSound:true,sampleRate:44100,CPU_FREQ_NTSC:1789772.5,CPU_FREQ_PAL:1773447.4};if(typeof opts!="undefined"){var key;for(key in this.opts){if(typeof opts[key]!="undefined"){this.opts[key]=opts[key]}}}this.frameTime=1e3/this.opts.preferredFrameRate;this.ui=new this.opts.ui(this);this.cpu=new JSNES.CPU(this);this.ppu=new JSNES.PPU(this);this.papu=new JSNES.PAPU(this);this.mmap=null;this.keyboard=new JSNES.Keyboard;this.ui.updateStatus("Ready to load a ROM.")};JSNES.VERSION="<%= version %>";JSNES.prototype={isRunning:false,fpsFrameCount:0,romData:null,reset:function(){if(this.mmap!==null){this.mmap.reset()}this.cpu.reset();this.ppu.reset();this.papu.reset()},start:function(){var self=this;if(this.rom!==null&&this.rom.valid){if(!this.isRunning){this.isRunning=true;this.frameInterval=setInterval(function(){self.frame()},this.frameTime);this.resetFps();this.printFps();this.fpsInterval=setInterval(function(){self.printFps()},this.opts.fpsInterval)}}else{this.ui.updateStatus("There is no ROM loaded, or it is invalid.")}},frame:function(){this.ppu.startFrame();var cycles=0;var emulateSound=this.opts.emulateSound;var cpu=this.cpu;var ppu=this.ppu;var papu=this.papu;FRAMELOOP:for(;;){if(cpu.cyclesToHalt===0){cycles=cpu.emulate();if(emulateSound){papu.clockFrameCounter(cycles)}cycles*=3}else{if(cpu.cyclesToHalt>8){cycles=24;if(emulateSound){papu.clockFrameCounter(8)}cpu.cyclesToHalt-=8}else{cycles=cpu.cyclesToHalt*3;if(emulateSound){papu.clockFrameCounter(cpu.cyclesToHalt)}cpu.cyclesToHalt=0}}for(;cycles>0;cycles--){if(ppu.curX===ppu.spr0HitX&&ppu.f_spVisibility===1&&ppu.scanline-21===ppu.spr0HitY){ppu.setStatusFlag(ppu.STATUS_SPRITE0HIT,true)}if(ppu.requestEndFrame){ppu.nmiCounter--;if(ppu.nmiCounter===0){ppu.requestEndFrame=false;ppu.startVBlank();break FRAMELOOP}}ppu.curX++;if(ppu.curX===341){ppu.curX=0;ppu.endScanline()}}}this.fpsFrameCount++},printFps:function(){var now=+new Date;var s="Running";if(this.lastFpsTime){s+=": "+(this.fpsFrameCount/((now-this.lastFpsTime)/1e3)).toFixed(2)+" FPS"}this.ui.updateStatus(s);this.fpsFrameCount=0;this.lastFpsTime=now},stop:function(){clearInterval(this.frameInterval);clearInterval(this.fpsInterval);this.isRunning=false},reloadRom:function(){if(this.romData!==null){this.loadRom(this.romData)}},loadRom:function(data){if(this.isRunning){this.stop()}this.ui.updateStatus("Loading ROM...");this.rom=new JSNES.ROM(this);this.rom.load(data);if(this.rom.valid){this.reset();this.mmap=this.rom.createMapper();if(!this.mmap){return}this.mmap.loadROM();this.ppu.setMirroring(this.rom.getMirroringType());this.romData=data;this.ui.updateStatus("Successfully loaded. Ready to be started.")}else{this.ui.updateStatus("Invalid ROM!")}return this.rom.valid},resetFps:function(){this.lastFpsTime=null;this.fpsFrameCount=0},setFramerate:function(rate){this.opts.preferredFrameRate=rate;this.frameTime=1e3/rate;this.papu.setSampleRate(this.opts.sampleRate,false)},toJSON:function(){return{romData:this.romData,cpu:this.cpu.toJSON(),mmap:this.mmap.toJSON(),ppu:this.ppu.toJSON()}},fromJSON:function(s){this.loadRom(s.romData);this.cpu.fromJSON(s.cpu);this.mmap.fromJSON(s.mmap);this.ppu.fromJSON(s.ppu)}};JSNES.Utils={copyArrayElements:function(src,srcPos,dest,destPos,length){for(var i=0;i<length;++i){dest[destPos+i]=src[srcPos+i]}},copyArray:function(src){var dest=new Array(src.length);for(var i=0;i<src.length;i++){dest[i]=src[i]}return dest},fromJSON:function(obj,state){for(var i=0;i<obj.JSON_PROPERTIES.length;i++){obj[obj.JSON_PROPERTIES[i]]=state[obj.JSON_PROPERTIES[i]]}},toJSON:function(obj){var state={};for(var i=0;i<obj.JSON_PROPERTIES.length;i++){state[obj.JSON_PROPERTIES[i]]=obj[obj.JSON_PROPERTIES[i]]}return state},isIE:function(){return/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)}};JSNES.CPU=function(nes){this.nes=nes;this.mem=null;this.REG_ACC=null;this.REG_X=null;this.REG_Y=null;this.REG_SP=null;this.REG_PC=null;this.REG_PC_NEW=null;this.REG_STATUS=null;this.F_CARRY=null;this.F_DECIMAL=null;this.F_INTERRUPT=null;this.F_INTERRUPT_NEW=null;this.F_OVERFLOW=null;this.F_SIGN=null;this.F_ZERO=null;this.F_NOTUSED=null;this.F_NOTUSED_NEW=null;this.F_BRK=null;this.F_BRK_NEW=null;this.opdata=null;this.cyclesToHalt=null;this.crash=null;this.irqRequested=null;this.irqType=null;this.reset()};JSNES.CPU.prototype={IRQ_NORMAL:0,IRQ_NMI:1,IRQ_RESET:2,reset:function(){this.mem=new Array(65536);for(var i=0;i<8192;i++){this.mem[i]=255}for(var p=0;p<4;p++){var i=p*2048;this.mem[i+8]=247;this.mem[i+9]=239;this.mem[i+10]=223;this.mem[i+15]=191}for(var i=8193;i<this.mem.length;i++){this.mem[i]=0}this.REG_ACC=0;this.REG_X=0;this.REG_Y=0;this.REG_SP=511;this.REG_PC=32768-1;this.REG_PC_NEW=32768-1;this.REG_STATUS=40;this.setStatus(40);this.F_CARRY=0;this.F_DECIMAL=0;this.F_INTERRUPT=1;this.F_INTERRUPT_NEW=1;this.F_OVERFLOW=0;this.F_SIGN=0;this.F_ZERO=1;this.F_NOTUSED=1;this.F_NOTUSED_NEW=1;this.F_BRK=1;this.F_BRK_NEW=1;this.opdata=(new JSNES.CPU.OpData).opdata;this.cyclesToHalt=0;this.crash=false;this.irqRequested=false;this.irqType=null},emulate:function(){var temp;var add;if(this.irqRequested){temp=this.F_CARRY|(this.F_ZERO===0?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7;this.REG_PC_NEW=this.REG_PC;this.F_INTERRUPT_NEW=this.F_INTERRUPT;switch(this.irqType){case 0:{if(this.F_INTERRUPT!=0){break}this.doIrq(temp);break}case 1:{this.doNonMaskableInterrupt(temp);break}case 2:{this.doResetInterrupt();break}}this.REG_PC=this.REG_PC_NEW;this.F_INTERRUPT=this.F_INTERRUPT_NEW;this.F_BRK=this.F_BRK_NEW;this.irqRequested=false}var opinf=this.opdata[this.nes.mmap.load(this.REG_PC+1)];var cycleCount=opinf>>24;var cycleAdd=0;var addrMode=opinf>>8&255;var opaddr=this.REG_PC;this.REG_PC+=opinf>>16&255;var addr=0;switch(addrMode){case 0:{addr=this.load(opaddr+2);break}case 1:{addr=this.load(opaddr+2);if(addr<128){addr+=this.REG_PC}else{addr+=this.REG_PC-256}break}case 2:{break}case 3:{addr=this.load16bit(opaddr+2);break}case 4:{addr=this.REG_ACC;break}case 5:{addr=this.REG_PC;break}case 6:{addr=this.load(opaddr+2)+this.REG_X&255;break}case 7:{addr=this.load(opaddr+2)+this.REG_Y&255;break}case 8:{addr=this.load16bit(opaddr+2);if((addr&65280)!=(addr+this.REG_X&65280)){cycleAdd=1}addr+=this.REG_X;break}case 9:{addr=this.load16bit(opaddr+2);if((addr&65280)!=(addr+this.REG_Y&65280)){cycleAdd=1}addr+=this.REG_Y;break}case 10:{addr=this.load(opaddr+2);if((addr&65280)!=(addr+this.REG_X&65280)){cycleAdd=1}addr+=this.REG_X;addr&=255;addr=this.load16bit(addr);break}case 11:{addr=this.load16bit(this.load(opaddr+2));if((addr&65280)!=(addr+this.REG_Y&65280)){cycleAdd=1}addr+=this.REG_Y;break}case 12:{addr=this.load16bit(opaddr+2);if(addr<8191){addr=this.mem[addr]+(this.mem[addr&65280|(addr&255)+1&255]<<8)}else{addr=this.nes.mmap.load(addr)+(this.nes.mmap.load(addr&65280|(addr&255)+1&255)<<8)}break}}addr&=65535;switch(opinf&255){case 0:{temp=this.REG_ACC+this.load(addr)+this.F_CARRY;this.F_OVERFLOW=!(((this.REG_ACC^this.load(addr))&128)!=0)&&((this.REG_ACC^temp)&128)!=0?1:0;this.F_CARRY=temp>255?1:0;this.F_SIGN=temp>>7&1;this.F_ZERO=temp&255;this.REG_ACC=temp&255;cycleCount+=cycleAdd;break}case 1:{this.REG_ACC=this.REG_ACC&this.load(addr);this.F_SIGN=this.REG_ACC>>7&1;this.F_ZERO=this.REG_ACC;if(addrMode!=11)cycleCount+=cycleAdd;break}case 2:{if(addrMode==4){this.F_CARRY=this.REG_ACC>>7&1;this.REG_ACC=this.REG_ACC<<1&255;this.F_SIGN=this.REG_ACC>>7&1;this.F_ZERO=this.REG_ACC}else{temp=this.load(addr);this.F_CARRY=temp>>7&1;temp=temp<<1&255;this.F_SIGN=temp>>7&1;this.F_ZERO=temp;this.write(addr,temp)}break}case 3:{if(this.F_CARRY==0){cycleCount+=(opaddr&65280)!=(addr&65280)?2:1;this.REG_PC=addr}break}case 4:{if(this.F_CARRY==1){cycleCount+=(opaddr&65280)!=(addr&65280)?2:1;this.REG_PC=addr}break}case 5:{if(this.F_ZERO==0){cycleCount+=(opaddr&65280)!=(addr&65280)?2:1;this.REG_PC=addr}break}case 6:{temp=this.load(addr);this.F_SIGN=temp>>7&1;this.F_OVERFLOW=temp>>6&1;temp&=this.REG_ACC;this.F_ZERO=temp;break}case 7:{if(this.F_SIGN==1){cycleCount++;this.REG_PC=addr}break}case 8:{if(this.F_ZERO!=0){cycleCount+=(opaddr&65280)!=(addr&65280)?2:1;this.REG_PC=addr}break}case 9:{if(this.F_SIGN==0){cycleCount+=(opaddr&65280)!=(addr&65280)?2:1;this.REG_PC=addr}break}case 10:{this.REG_PC+=2;this.push(this.REG_PC>>8&255);this.push(this.REG_PC&255);this.F_BRK=1;this.push(this.F_CARRY|(this.F_ZERO==0?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7);this.F_INTERRUPT=1;this.REG_PC=this.load16bit(65534);this.REG_PC--;break}case 11:{if(this.F_OVERFLOW==0){cycleCount+=(opaddr&65280)!=(addr&65280)?2:1;this.REG_PC=addr}break}case 12:{if(this.F_OVERFLOW==1){cycleCount+=(opaddr&65280)!=(addr&65280)?2:1;this.REG_PC=addr}break}case 13:{this.F_CARRY=0;break}case 14:{this.F_DECIMAL=0;break}case 15:{this.F_INTERRUPT=0;break}case 16:{this.F_OVERFLOW=0;break}case 17:{temp=this.REG_ACC-this.load(addr);this.F_CARRY=temp>=0?1:0;this.F_SIGN=temp>>7&1;this.F_ZERO=temp&255;cycleCount+=cycleAdd;break}case 18:{temp=this.REG_X-this.load(addr);this.F_CARRY=temp>=0?1:0;this.F_SIGN=temp>>7&1;this.F_ZERO=temp&255;break}case 19:{temp=this.REG_Y-this.load(addr);this.F_CARRY=temp>=0?1:0;this.F_SIGN=temp>>7&1;this.F_ZERO=temp&255;break}case 20:{temp=this.load(addr)-1&255;this.F_SIGN=temp>>7&1;this.F_ZERO=temp;this.write(addr,temp);break}case 21:{this.REG_X=this.REG_X-1&255;this.F_SIGN=this.REG_X>>7&1;this.F_ZERO=this.REG_X;break}case 22:{this.REG_Y=this.REG_Y-1&255;this.F_SIGN=this.REG_Y>>7&1;this.F_ZERO=this.REG_Y;break}case 23:{this.REG_ACC=(this.load(addr)^this.REG_ACC)&255;this.F_SIGN=this.REG_ACC>>7&1;this.F_ZERO=this.REG_ACC;cycleCount+=cycleAdd;break}case 24:{temp=this.load(addr)+1&255;this.F_SIGN=temp>>7&1;this.F_ZERO=temp;this.write(addr,temp&255);break}case 25:{this.REG_X=this.REG_X+1&255;this.F_SIGN=this.REG_X>>7&1;this.F_ZERO=this.REG_X;break}case 26:{this.REG_Y++;this.REG_Y&=255;this.F_SIGN=this.REG_Y>>7&1;this.F_ZERO=this.REG_Y;break}case 27:{this.REG_PC=addr-1;break}case 28:{this.push(this.REG_PC>>8&255);this.push(this.REG_PC&255);this.REG_PC=addr-1;break}case 29:{this.REG_ACC=this.load(addr);this.F_SIGN=this.REG_ACC>>7&1;this.F_ZERO=this.REG_ACC;cycleCount+=cycleAdd;break}case 30:{this.REG_X=this.load(addr);this.F_SIGN=this.REG_X>>7&1;this.F_ZERO=this.REG_X;cycleCount+=cycleAdd;break}case 31:{this.REG_Y=this.load(addr);this.F_SIGN=this.REG_Y>>7&1;this.F_ZERO=this.REG_Y;cycleCount+=cycleAdd;break}case 32:{if(addrMode==4){temp=this.REG_ACC&255;this.F_CARRY=temp&1;temp>>=1;this.REG_ACC=temp}else{temp=this.load(addr)&255;this.F_CARRY=temp&1;temp>>=1;this.write(addr,temp)}this.F_SIGN=0;this.F_ZERO=temp;break}case 33:{break}case 34:{temp=(this.load(addr)|this.REG_ACC)&255;this.F_SIGN=temp>>7&1;this.F_ZERO=temp;this.REG_ACC=temp;if(addrMode!=11)cycleCount+=cycleAdd;break}case 35:{this.push(this.REG_ACC);break}case 36:{this.F_BRK=1;this.push(this.F_CARRY|(this.F_ZERO==0?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7);break}case 37:{this.REG_ACC=this.pull();this.F_SIGN=this.REG_ACC>>7&1;this.F_ZERO=this.REG_ACC;break}case 38:{temp=this.pull();this.F_CARRY=temp&1;this.F_ZERO=(temp>>1&1)==1?0:1;this.F_INTERRUPT=temp>>2&1;this.F_DECIMAL=temp>>3&1;this.F_BRK=temp>>4&1;this.F_NOTUSED=temp>>5&1;this.F_OVERFLOW=temp>>6&1;this.F_SIGN=temp>>7&1;this.F_NOTUSED=1;break}case 39:{if(addrMode==4){temp=this.REG_ACC;add=this.F_CARRY;this.F_CARRY=temp>>7&1;temp=(temp<<1&255)+add;this.REG_ACC=temp}else{temp=this.load(addr);add=this.F_CARRY;this.F_CARRY=temp>>7&1;temp=(temp<<1&255)+add;this.write(addr,temp)}this.F_SIGN=temp>>7&1;this.F_ZERO=temp;break}case 40:{if(addrMode==4){add=this.F_CARRY<<7;this.F_CARRY=this.REG_ACC&1;temp=(this.REG_ACC>>1)+add;this.REG_ACC=temp}else{temp=this.load(addr);add=this.F_CARRY<<7;this.F_CARRY=temp&1;temp=(temp>>1)+add;this.write(addr,temp)}this.F_SIGN=temp>>7&1;this.F_ZERO=temp;break}case 41:{temp=this.pull();this.F_CARRY=temp&1;this.F_ZERO=(temp>>1&1)==0?1:0;this.F_INTERRUPT=temp>>2&1;this.F_DECIMAL=temp>>3&1;this.F_BRK=temp>>4&1;this.F_NOTUSED=temp>>5&1;this.F_OVERFLOW=temp>>6&1;this.F_SIGN=temp>>7&1;this.REG_PC=this.pull();this.REG_PC+=this.pull()<<8;if(this.REG_PC==65535){return}this.REG_PC--;this.F_NOTUSED=1;break}case 42:{this.REG_PC=this.pull();this.REG_PC+=this.pull()<<8;if(this.REG_PC==65535){return}break}case 43:{temp=this.REG_ACC-this.load(addr)-(1-this.F_CARRY);this.F_SIGN=temp>>7&1;this.F_ZERO=temp&255;this.F_OVERFLOW=((this.REG_ACC^temp)&128)!=0&&((this.REG_ACC^this.load(addr))&128)!=0?1:0;this.F_CARRY=temp<0?0:1;this.REG_ACC=temp&255;if(addrMode!=11)cycleCount+=cycleAdd;break}case 44:{this.F_CARRY=1;break}case 45:{this.F_DECIMAL=1;break}case 46:{this.F_INTERRUPT=1;break}case 47:{this.write(addr,this.REG_ACC);break}case 48:{this.write(addr,this.REG_X);break}case 49:{this.write(addr,this.REG_Y);break}case 50:{this.REG_X=this.REG_ACC;this.F_SIGN=this.REG_ACC>>7&1;this.F_ZERO=this.REG_ACC;break}case 51:{this.REG_Y=this.REG_ACC;this.F_SIGN=this.REG_ACC>>7&1;this.F_ZERO=this.REG_ACC;break}case 52:{this.REG_X=this.REG_SP-256;this.F_SIGN=this.REG_SP>>7&1;this.F_ZERO=this.REG_X;break}case 53:{this.REG_ACC=this.REG_X;this.F_SIGN=this.REG_X>>7&1;this.F_ZERO=this.REG_X;break}case 54:{this.REG_SP=this.REG_X+256;this.stackWrap();break}case 55:{this.REG_ACC=this.REG_Y;this.F_SIGN=this.REG_Y>>7&1;this.F_ZERO=this.REG_Y;break}default:{this.nes.stop();this.nes.crashMessage="Game crashed, invalid opcode at address $"+opaddr.toString(16);break}}return cycleCount},load:function(addr){if(addr<8192){return this.mem[addr&2047]}else{return this.nes.mmap.load(addr)}},load16bit:function(addr){if(addr<8191){return this.mem[addr&2047]|this.mem[addr+1&2047]<<8}else{return this.nes.mmap.load(addr)|this.nes.mmap.load(addr+1)<<8}},write:function(addr,val){if(addr<8192){this.mem[addr&2047]=val}else{this.nes.mmap.write(addr,val)}},requestIrq:function(type){if(this.irqRequested){if(type==this.IRQ_NORMAL){return}}this.irqRequested=true;this.irqType=type},push:function(value){this.nes.mmap.write(this.REG_SP,value);this.REG_SP--;this.REG_SP=256|this.REG_SP&255},stackWrap:function(){this.REG_SP=256|this.REG_SP&255},pull:function(){this.REG_SP++;this.REG_SP=256|this.REG_SP&255;return this.nes.mmap.load(this.REG_SP)},pageCrossed:function(addr1,addr2){return(addr1&65280)!=(addr2&65280)},haltCycles:function(cycles){this.cyclesToHalt+=cycles},doNonMaskableInterrupt:function(status){if((this.nes.mmap.load(8192)&128)!=0){this.REG_PC_NEW++;this.push(this.REG_PC_NEW>>8&255);this.push(this.REG_PC_NEW&255);this.push(status);this.REG_PC_NEW=this.nes.mmap.load(65530)|this.nes.mmap.load(65531)<<8;this.REG_PC_NEW--}},doResetInterrupt:function(){this.REG_PC_NEW=this.nes.mmap.load(65532)|this.nes.mmap.load(65533)<<8;this.REG_PC_NEW--},doIrq:function(status){this.REG_PC_NEW++;this.push(this.REG_PC_NEW>>8&255);this.push(this.REG_PC_NEW&255);this.push(status);this.F_INTERRUPT_NEW=1;this.F_BRK_NEW=0;this.REG_PC_NEW=this.nes.mmap.load(65534)|this.nes.mmap.load(65535)<<8;this.REG_PC_NEW--},getStatus:function(){return this.F_CARRY|this.F_ZERO<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7},setStatus:function(st){this.F_CARRY=st&1;this.F_ZERO=st>>1&1;this.F_INTERRUPT=st>>2&1;this.F_DECIMAL=st>>3&1;this.F_BRK=st>>4&1;this.F_NOTUSED=st>>5&1;this.F_OVERFLOW=st>>6&1;this.F_SIGN=st>>7&1},JSON_PROPERTIES:["mem","cyclesToHalt","irqRequested","irqType","REG_ACC","REG_X","REG_Y","REG_SP","REG_PC","REG_PC_NEW","REG_STATUS","F_CARRY","F_DECIMAL","F_INTERRUPT","F_INTERRUPT_NEW","F_OVERFLOW","F_SIGN","F_ZERO","F_NOTUSED","F_NOTUSED_NEW","F_BRK","F_BRK_NEW"],toJSON:function(){return JSNES.Utils.toJSON(this)},fromJSON:function(s){JSNES.Utils.fromJSON(this,s)}};JSNES.CPU.OpData=function(){this.opdata=new Array(256);for(var i=0;i<256;i++)this.opdata[i]=255;this.setOp(this.INS_ADC,105,this.ADDR_IMM,2,2);this.setOp(this.INS_ADC,101,this.ADDR_ZP,2,3);this.setOp(this.INS_ADC,117,this.ADDR_ZPX,2,4);this.setOp(this.INS_ADC,109,this.ADDR_ABS,3,4);this.setOp(this.INS_ADC,125,this.ADDR_ABSX,3,4);this.setOp(this.INS_ADC,121,this.ADDR_ABSY,3,4);this.setOp(this.INS_ADC,97,this.ADDR_PREIDXIND,2,6);this.setOp(this.INS_ADC,113,this.ADDR_POSTIDXIND,2,5);this.setOp(this.INS_AND,41,this.ADDR_IMM,2,2);this.setOp(this.INS_AND,37,this.ADDR_ZP,2,3);this.setOp(this.INS_AND,53,this.ADDR_ZPX,2,4);this.setOp(this.INS_AND,45,this.ADDR_ABS,3,4);this.setOp(this.INS_AND,61,this.ADDR_ABSX,3,4);this.setOp(this.INS_AND,57,this.ADDR_ABSY,3,4);this.setOp(this.INS_AND,33,this.ADDR_PREIDXIND,2,6);this.setOp(this.INS_AND,49,this.ADDR_POSTIDXIND,2,5);this.setOp(this.INS_ASL,10,this.ADDR_ACC,1,2);this.setOp(this.INS_ASL,6,this.ADDR_ZP,2,5);this.setOp(this.INS_ASL,22,this.ADDR_ZPX,2,6);this.setOp(this.INS_ASL,14,this.ADDR_ABS,3,6);this.setOp(this.INS_ASL,30,this.ADDR_ABSX,3,7);this.setOp(this.INS_BCC,144,this.ADDR_REL,2,2);this.setOp(this.INS_BCS,176,this.ADDR_REL,2,2);this.setOp(this.INS_BEQ,240,this.ADDR_REL,2,2);this.setOp(this.INS_BIT,36,this.ADDR_ZP,2,3);this.setOp(this.INS_BIT,44,this.ADDR_ABS,3,4);this.setOp(this.INS_BMI,48,this.ADDR_REL,2,2);this.setOp(this.INS_BNE,208,this.ADDR_REL,2,2);this.setOp(this.INS_BPL,16,this.ADDR_REL,2,2);this.setOp(this.INS_BRK,0,this.ADDR_IMP,1,7);this.setOp(this.INS_BVC,80,this.ADDR_REL,2,2);this.setOp(this.INS_BVS,112,this.ADDR_REL,2,2);this.setOp(this.INS_CLC,24,this.ADDR_IMP,1,2);this.setOp(this.INS_CLD,216,this.ADDR_IMP,1,2);this.setOp(this.INS_CLI,88,this.ADDR_IMP,1,2);this.setOp(this.INS_CLV,184,this.ADDR_IMP,1,2);this.setOp(this.INS_CMP,201,this.ADDR_IMM,2,2);this.setOp(this.INS_CMP,197,this.ADDR_ZP,2,3);this.setOp(this.INS_CMP,213,this.ADDR_ZPX,2,4);this.setOp(this.INS_CMP,205,this.ADDR_ABS,3,4);this.setOp(this.INS_CMP,221,this.ADDR_ABSX,3,4);this.setOp(this.INS_CMP,217,this.ADDR_ABSY,3,4);this.setOp(this.INS_CMP,193,this.ADDR_PREIDXIND,2,6);this.setOp(this.INS_CMP,209,this.ADDR_POSTIDXIND,2,5);this.setOp(this.INS_CPX,224,this.ADDR_IMM,2,2);this.setOp(this.INS_CPX,228,this.ADDR_ZP,2,3);this.setOp(this.INS_CPX,236,this.ADDR_ABS,3,4);this.setOp(this.INS_CPY,192,this.ADDR_IMM,2,2);this.setOp(this.INS_CPY,196,this.ADDR_ZP,2,3);this.setOp(this.INS_CPY,204,this.ADDR_ABS,3,4);this.setOp(this.INS_DEC,198,this.ADDR_ZP,2,5);this.setOp(this.INS_DEC,214,this.ADDR_ZPX,2,6);this.setOp(this.INS_DEC,206,this.ADDR_ABS,3,6);this.setOp(this.INS_DEC,222,this.ADDR_ABSX,3,7);this.setOp(this.INS_DEX,202,this.ADDR_IMP,1,2);this.setOp(this.INS_DEY,136,this.ADDR_IMP,1,2);this.setOp(this.INS_EOR,73,this.ADDR_IMM,2,2);this.setOp(this.INS_EOR,69,this.ADDR_ZP,2,3);this.setOp(this.INS_EOR,85,this.ADDR_ZPX,2,4);this.setOp(this.INS_EOR,77,this.ADDR_ABS,3,4);this.setOp(this.INS_EOR,93,this.ADDR_ABSX,3,4);this.setOp(this.INS_EOR,89,this.ADDR_ABSY,3,4);this.setOp(this.INS_EOR,65,this.ADDR_PREIDXIND,2,6);this.setOp(this.INS_EOR,81,this.ADDR_POSTIDXIND,2,5);this.setOp(this.INS_INC,230,this.ADDR_ZP,2,5);this.setOp(this.INS_INC,246,this.ADDR_ZPX,2,6);this.setOp(this.INS_INC,238,this.ADDR_ABS,3,6);this.setOp(this.INS_INC,254,this.ADDR_ABSX,3,7);this.setOp(this.INS_INX,232,this.ADDR_IMP,1,2);this.setOp(this.INS_INY,200,this.ADDR_IMP,1,2);this.setOp(this.INS_JMP,76,this.ADDR_ABS,3,3);this.setOp(this.INS_JMP,108,this.ADDR_INDABS,3,5);this.setOp(this.INS_JSR,32,this.ADDR_ABS,3,6);this.setOp(this.INS_LDA,169,this.ADDR_IMM,2,2);this.setOp(this.INS_LDA,165,this.ADDR_ZP,2,3);this.setOp(this.INS_LDA,181,this.ADDR_ZPX,2,4);this.setOp(this.INS_LDA,173,this.ADDR_ABS,3,4);this.setOp(this.INS_LDA,189,this.ADDR_ABSX,3,4);this.setOp(this.INS_LDA,185,this.ADDR_ABSY,3,4);this.setOp(this.INS_LDA,161,this.ADDR_PREIDXIND,2,6);this.setOp(this.INS_LDA,177,this.ADDR_POSTIDXIND,2,5);this.setOp(this.INS_LDX,162,this.ADDR_IMM,2,2);this.setOp(this.INS_LDX,166,this.ADDR_ZP,2,3);this.setOp(this.INS_LDX,182,this.ADDR_ZPY,2,4);this.setOp(this.INS_LDX,174,this.ADDR_ABS,3,4);this.setOp(this.INS_LDX,190,this.ADDR_ABSY,3,4);this.setOp(this.INS_LDY,160,this.ADDR_IMM,2,2);this.setOp(this.INS_LDY,164,this.ADDR_ZP,2,3);this.setOp(this.INS_LDY,180,this.ADDR_ZPX,2,4);this.setOp(this.INS_LDY,172,this.ADDR_ABS,3,4);this.setOp(this.INS_LDY,188,this.ADDR_ABSX,3,4);this.setOp(this.INS_LSR,74,this.ADDR_ACC,1,2);this.setOp(this.INS_LSR,70,this.ADDR_ZP,2,5);this.setOp(this.INS_LSR,86,this.ADDR_ZPX,2,6);this.setOp(this.INS_LSR,78,this.ADDR_ABS,3,6);this.setOp(this.INS_LSR,94,this.ADDR_ABSX,3,7);this.setOp(this.INS_NOP,234,this.ADDR_IMP,1,2);this.setOp(this.INS_ORA,9,this.ADDR_IMM,2,2);this.setOp(this.INS_ORA,5,this.ADDR_ZP,2,3);this.setOp(this.INS_ORA,21,this.ADDR_ZPX,2,4);this.setOp(this.INS_ORA,13,this.ADDR_ABS,3,4);this.setOp(this.INS_ORA,29,this.ADDR_ABSX,3,4);this.setOp(this.INS_ORA,25,this.ADDR_ABSY,3,4);this.setOp(this.INS_ORA,1,this.ADDR_PREIDXIND,2,6);this.setOp(this.INS_ORA,17,this.ADDR_POSTIDXIND,2,5);this.setOp(this.INS_PHA,72,this.ADDR_IMP,1,3);this.setOp(this.INS_PHP,8,this.ADDR_IMP,1,3);this.setOp(this.INS_PLA,104,this.ADDR_IMP,1,4);this.setOp(this.INS_PLP,40,this.ADDR_IMP,1,4);this.setOp(this.INS_ROL,42,this.ADDR_ACC,1,2);this.setOp(this.INS_ROL,38,this.ADDR_ZP,2,5);this.setOp(this.INS_ROL,54,this.ADDR_ZPX,2,6);this.setOp(this.INS_ROL,46,this.ADDR_ABS,3,6);this.setOp(this.INS_ROL,62,this.ADDR_ABSX,3,7);this.setOp(this.INS_ROR,106,this.ADDR_ACC,1,2);this.setOp(this.INS_ROR,102,this.ADDR_ZP,2,5);this.setOp(this.INS_ROR,118,this.ADDR_ZPX,2,6);this.setOp(this.INS_ROR,110,this.ADDR_ABS,3,6);this.setOp(this.INS_ROR,126,this.ADDR_ABSX,3,7);this.setOp(this.INS_RTI,64,this.ADDR_IMP,1,6);this.setOp(this.INS_RTS,96,this.ADDR_IMP,1,6);this.setOp(this.INS_SBC,233,this.ADDR_IMM,2,2);this.setOp(this.INS_SBC,229,this.ADDR_ZP,2,3);this.setOp(this.INS_SBC,245,this.ADDR_ZPX,2,4);this.setOp(this.INS_SBC,237,this.ADDR_ABS,3,4);this.setOp(this.INS_SBC,253,this.ADDR_ABSX,3,4);this.setOp(this.INS_SBC,249,this.ADDR_ABSY,3,4);this.setOp(this.INS_SBC,225,this.ADDR_PREIDXIND,2,6);this.setOp(this.INS_SBC,241,this.ADDR_POSTIDXIND,2,5);this.setOp(this.INS_SEC,56,this.ADDR_IMP,1,2);this.setOp(this.INS_SED,248,this.ADDR_IMP,1,2);this.setOp(this.INS_SEI,120,this.ADDR_IMP,1,2);this.setOp(this.INS_STA,133,this.ADDR_ZP,2,3);this.setOp(this.INS_STA,149,this.ADDR_ZPX,2,4);this.setOp(this.INS_STA,141,this.ADDR_ABS,3,4);this.setOp(this.INS_STA,157,this.ADDR_ABSX,3,5);this.setOp(this.INS_STA,153,this.ADDR_ABSY,3,5);this.setOp(this.INS_STA,129,this.ADDR_PREIDXIND,2,6);this.setOp(this.INS_STA,145,this.ADDR_POSTIDXIND,2,6);this.setOp(this.INS_STX,134,this.ADDR_ZP,2,3);this.setOp(this.INS_STX,150,this.ADDR_ZPY,2,4);this.setOp(this.INS_STX,142,this.ADDR_ABS,3,4);this.setOp(this.INS_STY,132,this.ADDR_ZP,2,3);this.setOp(this.INS_STY,148,this.ADDR_ZPX,2,4);this.setOp(this.INS_STY,140,this.ADDR_ABS,3,4);this.setOp(this.INS_TAX,170,this.ADDR_IMP,1,2);this.setOp(this.INS_TAY,168,this.ADDR_IMP,1,2);this.setOp(this.INS_TSX,186,this.ADDR_IMP,1,2);this.setOp(this.INS_TXA,138,this.ADDR_IMP,1,2);this.setOp(this.INS_TXS,154,this.ADDR_IMP,1,2);this.setOp(this.INS_TYA,152,this.ADDR_IMP,1,2);this.cycTable=new Array(7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7);this.instname=new Array(56);this.instname[0]="ADC";this.instname[1]="AND";this.instname[2]="ASL";this.instname[3]="BCC";this.instname[4]="BCS";this.instname[5]="BEQ";this.instname[6]="BIT";this.instname[7]="BMI";this.instname[8]="BNE";this.instname[9]="BPL";this.instname[10]="BRK";this.instname[11]="BVC";this.instname[12]="BVS";this.instname[13]="CLC";this.instname[14]="CLD";this.instname[15]="CLI";this.instname[16]="CLV";this.instname[17]="CMP";this.instname[18]="CPX";this.instname[19]="CPY";this.instname[20]="DEC";this.instname[21]="DEX";this.instname[22]="DEY";this.instname[23]="EOR";this.instname[24]="INC";this.instname[25]="INX";this.instname[26]="INY";this.instname[27]="JMP";this.instname[28]="JSR";this.instname[29]="LDA";this.instname[30]="LDX";this.instname[31]="LDY";this.instname[32]="LSR";this.instname[33]="NOP";this.instname[34]="ORA";this.instname[35]="PHA";this.instname[36]="PHP";this.instname[37]="PLA";this.instname[38]="PLP";this.instname[39]="ROL";this.instname[40]="ROR";this.instname[41]="RTI";this.instname[42]="RTS";this.instname[43]="SBC";this.instname[44]="SEC";this.instname[45]="SED";this.instname[46]="SEI";this.instname[47]="STA";this.instname[48]="STX";this.instname[49]="STY";this.instname[50]="TAX";this.instname[51]="TAY";this.instname[52]="TSX";this.instname[53]="TXA";this.instname[54]="TXS";this.instname[55]="TYA";this.addrDesc=new Array("Zero Page           ","Relative            ","Implied             ","Absolute            ","Accumulator         ","Immediate           ","Zero Page,X         ","Zero Page,Y         ","Absolute,X          ","Absolute,Y          ","Preindexed Indirect ","Postindexed Indirect","Indirect Absolute   ")};JSNES.CPU.OpData.prototype={INS_ADC:0,INS_AND:1,INS_ASL:2,INS_BCC:3,INS_BCS:4,INS_BEQ:5,INS_BIT:6,INS_BMI:7,INS_BNE:8,INS_BPL:9,INS_BRK:10,INS_BVC:11,INS_BVS:12,INS_CLC:13,INS_CLD:14,INS_CLI:15,INS_CLV:16,INS_CMP:17,INS_CPX:18,INS_CPY:19,INS_DEC:20,INS_DEX:21,INS_DEY:22,INS_EOR:23,INS_INC:24,INS_INX:25,INS_INY:26,INS_JMP:27,INS_JSR:28,INS_LDA:29,INS_LDX:30,INS_LDY:31,INS_LSR:32,INS_NOP:33,INS_ORA:34,INS_PHA:35,INS_PHP:36,INS_PLA:37,INS_PLP:38,INS_ROL:39,INS_ROR:40,INS_RTI:41,INS_RTS:42,INS_SBC:43,INS_SEC:44,INS_SED:45,INS_SEI:46,INS_STA:47,INS_STX:48,INS_STY:49,INS_TAX:50,INS_TAY:51,INS_TSX:52,INS_TXA:53,INS_TXS:54,INS_TYA:55,INS_DUMMY:56,ADDR_ZP:0,ADDR_REL:1,ADDR_IMP:2,ADDR_ABS:3,ADDR_ACC:4,ADDR_IMM:5,ADDR_ZPX:6,ADDR_ZPY:7,ADDR_ABSX:8,ADDR_ABSY:9,ADDR_PREIDXIND:10,ADDR_POSTIDXIND:11,ADDR_INDABS:12,setOp:function(inst,op,addr,size,cycles){this.opdata[op]=inst&255|(addr&255)<<8|(size&255)<<16|(cycles&255)<<24}};JSNES.Keyboard=function(){var i;this.keys={KEY_A:0,KEY_B:1,KEY_SELECT:2,KEY_START:3,KEY_UP:4,KEY_DOWN:5,KEY_LEFT:6,KEY_RIGHT:7};this.state1=new Array(8);for(i=0;i<this.state1.length;i++){this.state1[i]=64}this.state2=new Array(8);for(i=0;i<this.state2.length;i++){this.state2[i]=64}};JSNES.Keyboard.prototype={setKey:function(key,value){switch(key){case 88:this.state1[this.keys.KEY_A]=value;break;case 89:this.state1[this.keys.KEY_B]=value;break;case 90:this.state1[this.keys.KEY_B]=value;break;case 17:this.state1[this.keys.KEY_SELECT]=value;break;case 13:this.state1[this.keys.KEY_START]=value;break;case 38:this.state1[this.keys.KEY_UP]=value;break;case 40:this.state1[this.keys.KEY_DOWN]=value;break;case 37:this.state1[this.keys.KEY_LEFT]=value;break;case 39:this.state1[this.keys.KEY_RIGHT]=value;break;case 103:this.state2[this.keys.KEY_A]=value;break;case 105:this.state2[this.keys.KEY_B]=value;break;case 99:this.state2[this.keys.KEY_SELECT]=value;break;case 97:this.state2[this.keys.KEY_START]=value;break;case 104:this.state2[this.keys.KEY_UP]=value;break;case 98:this.state2[this.keys.KEY_DOWN]=value;break;case 100:this.state2[this.keys.KEY_LEFT]=value;break;case 102:this.state2[this.keys.KEY_RIGHT]=value;break;default:return true}return false},keyDown:function(evt){if(!this.setKey(evt.keyCode,65)&&evt.preventDefault){evt.preventDefault()}},keyUp:function(evt){if(!this.setKey(evt.keyCode,64)&&evt.preventDefault){evt.preventDefault()}},keyPress:function(evt){evt.preventDefault()}};JSNES.Mappers={};JSNES.Mappers[0]=function(nes){this.nes=nes};JSNES.Mappers[0].prototype={reset:function(){this.joy1StrobeState=0;this.joy2StrobeState=0;this.joypadLastWrite=0;this.mousePressed=false;this.mouseX=null;this.mouseY=null},write:function(address,value){if(address<8192){this.nes.cpu.mem[address&2047]=value}else if(address>16407){this.nes.cpu.mem[address]=value;if(address>=24576&&address<32768){}}else if(address>8199&&address<16384){this.regWrite(8192+(address&7),value)}else{this.regWrite(address,value)}},writelow:function(address,value){if(address<8192){this.nes.cpu.mem[address&2047]=value}else if(address>16407){this.nes.cpu.mem[address]=value}else if(address>8199&&address<16384){this.regWrite(8192+(address&7),value)}else{this.regWrite(address,value)}},load:function(address){address&=65535;if(address>16407){return this.nes.cpu.mem[address]}else if(address>=8192){return this.regLoad(address)}else{return this.nes.cpu.mem[address&2047]}},regLoad:function(address){switch(address>>12){case 0:break;case 1:break;case 2:case 3:switch(address&7){case 0:return this.nes.cpu.mem[8192];case 1:return this.nes.cpu.mem[8193];case 2:return this.nes.ppu.readStatusRegister();case 3:return 0;case 4:return this.nes.ppu.sramLoad();case 5:return 0;case 6:return 0;case 7:return this.nes.ppu.vramLoad()}break;case 4:switch(address-16405){case 0:return this.nes.papu.readReg(address);case 1:return this.joy1Read();case 2:if(this.mousePressed){var sx=Math.max(0,this.mouseX-4);var ex=Math.min(256,this.mouseX+4);var sy=Math.max(0,this.mouseY-4);var ey=Math.min(240,this.mouseY+4);var w=0;for(var y=sy;y<ey;y++){for(var x=sx;x<ex;x++){if(this.nes.ppu.buffer[(y<<8)+x]==16777215){w|=1<<3;console.debug("Clicked on white!");break}}}w|=this.mousePressed?1<<4:0;return(this.joy2Read()|w)&65535}else{return this.joy2Read()}}break}return 0},regWrite:function(address,value){switch(address){case 8192:this.nes.cpu.mem[address]=value;this.nes.ppu.updateControlReg1(value);break;case 8193:this.nes.cpu.mem[address]=value;this.nes.ppu.updateControlReg2(value);break;case 8195:this.nes.ppu.writeSRAMAddress(value);break;case 8196:this.nes.ppu.sramWrite(value);break;case 8197:this.nes.ppu.scrollWrite(value);break;case 8198:this.nes.ppu.writeVRAMAddress(value);break;case 8199:this.nes.ppu.vramWrite(value);break;case 16404:this.nes.ppu.sramDMA(value);break;case 16405:this.nes.papu.writeReg(address,value);break;case 16406:if((value&1)===0&&(this.joypadLastWrite&1)===1){this.joy1StrobeState=0;this.joy2StrobeState=0}this.joypadLastWrite=value;break;case 16407:this.nes.papu.writeReg(address,value);break;default:if(address>=16384&&address<=16407){this.nes.papu.writeReg(address,value)}}},joy1Read:function(){var ret;switch(this.joy1StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:ret=this.nes.keyboard.state1[this.joy1StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:ret=0;break;case 19:ret=1;break;default:ret=0}this.joy1StrobeState++;if(this.joy1StrobeState==24){this.joy1StrobeState=0}return ret},joy2Read:function(){var ret;switch(this.joy2StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:ret=this.nes.keyboard.state2[this.joy2StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:ret=0;break;case 19:ret=1;break;default:ret=0}this.joy2StrobeState++;if(this.joy2StrobeState==24){this.joy2StrobeState=0}return ret},loadROM:function(){if(!this.nes.rom.valid||this.nes.rom.romCount<1){alert("NoMapper: Invalid ROM! Unable to load.");return}this.loadPRGROM();this.loadCHRROM();this.loadBatteryRam();this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},loadPRGROM:function(){if(this.nes.rom.romCount>1){this.loadRomBank(0,32768);this.loadRomBank(1,49152)}else{this.loadRomBank(0,32768);this.loadRomBank(0,49152)}},loadCHRROM:function(){if(this.nes.rom.vromCount>0){if(this.nes.rom.vromCount==1){this.loadVromBank(0,0);this.loadVromBank(0,4096)}else{this.loadVromBank(0,0);this.loadVromBank(1,4096)}}else{}},loadBatteryRam:function(){if(this.nes.rom.batteryRam){var ram=this.nes.rom.batteryRam;if(ram!==null&&ram.length==8192){
JSNES.Utils.copyArrayElements(ram,0,this.nes.cpu.mem,24576,8192)}}},loadRomBank:function(bank,address){bank%=this.nes.rom.romCount;JSNES.Utils.copyArrayElements(this.nes.rom.rom[bank],0,this.nes.cpu.mem,address,16384)},loadVromBank:function(bank,address){if(this.nes.rom.vromCount===0){return}this.nes.ppu.triggerRendering();JSNES.Utils.copyArrayElements(this.nes.rom.vrom[bank%this.nes.rom.vromCount],0,this.nes.ppu.vramMem,address,4096);var vromTile=this.nes.rom.vromTile[bank%this.nes.rom.vromCount];JSNES.Utils.copyArrayElements(vromTile,0,this.nes.ppu.ptTile,address>>4,256)},load32kRomBank:function(bank,address){this.loadRomBank(bank*2%this.nes.rom.romCount,address);this.loadRomBank((bank*2+1)%this.nes.rom.romCount,address+16384)},load8kVromBank:function(bank4kStart,address){if(this.nes.rom.vromCount===0){return}this.nes.ppu.triggerRendering();this.loadVromBank(bank4kStart%this.nes.rom.vromCount,address);this.loadVromBank((bank4kStart+1)%this.nes.rom.vromCount,address+4096)},load1kVromBank:function(bank1k,address){if(this.nes.rom.vromCount===0){return}this.nes.ppu.triggerRendering();var bank4k=Math.floor(bank1k/4)%this.nes.rom.vromCount;var bankoffset=bank1k%4*1024;JSNES.Utils.copyArrayElements(this.nes.rom.vrom[bank4k],0,this.nes.ppu.vramMem,bankoffset,1024);var vromTile=this.nes.rom.vromTile[bank4k];var baseIndex=address>>4;for(var i=0;i<64;i++){this.nes.ppu.ptTile[baseIndex+i]=vromTile[(bank1k%4<<6)+i]}},load2kVromBank:function(bank2k,address){if(this.nes.rom.vromCount===0){return}this.nes.ppu.triggerRendering();var bank4k=Math.floor(bank2k/2)%this.nes.rom.vromCount;var bankoffset=bank2k%2*2048;JSNES.Utils.copyArrayElements(this.nes.rom.vrom[bank4k],bankoffset,this.nes.ppu.vramMem,address,2048);var vromTile=this.nes.rom.vromTile[bank4k];var baseIndex=address>>4;for(var i=0;i<128;i++){this.nes.ppu.ptTile[baseIndex+i]=vromTile[(bank2k%2<<7)+i]}},load8kRomBank:function(bank8k,address){var bank16k=Math.floor(bank8k/2)%this.nes.rom.romCount;var offset=bank8k%2*8192;JSNES.Utils.copyArrayElements(this.nes.rom.rom[bank16k],offset,this.nes.cpu.mem,address,8192)},clockIrqCounter:function(){},latchAccess:function(address){},toJSON:function(){return{joy1StrobeState:this.joy1StrobeState,joy2StrobeState:this.joy2StrobeState,joypadLastWrite:this.joypadLastWrite}},fromJSON:function(s){this.joy1StrobeState=s.joy1StrobeState;this.joy2StrobeState=s.joy2StrobeState;this.joypadLastWrite=s.joypadLastWrite}};JSNES.Mappers[1]=function(nes){this.nes=nes};JSNES.Mappers[1].prototype=new JSNES.Mappers[0];JSNES.Mappers[1].prototype.reset=function(){JSNES.Mappers[0].prototype.reset.apply(this);this.regBuffer=0;this.regBufferCounter=0;this.mirroring=0;this.oneScreenMirroring=0;this.prgSwitchingArea=1;this.prgSwitchingSize=1;this.vromSwitchingSize=0;this.romSelectionReg0=0;this.romSelectionReg1=0;this.romBankSelect=0};JSNES.Mappers[1].prototype.write=function(address,value){if(address<32768){JSNES.Mappers[0].prototype.write.apply(this,arguments);return}if((value&128)!==0){this.regBufferCounter=0;this.regBuffer=0;if(this.getRegNumber(address)===0){this.prgSwitchingArea=1;this.prgSwitchingSize=1}}else{this.regBuffer=this.regBuffer&255-(1<<this.regBufferCounter)|(value&1)<<this.regBufferCounter;this.regBufferCounter++;if(this.regBufferCounter==5){this.setReg(this.getRegNumber(address),this.regBuffer);this.regBuffer=0;this.regBufferCounter=0}}};JSNES.Mappers[1].prototype.setReg=function(reg,value){var tmp;switch(reg){case 0:tmp=value&3;if(tmp!==this.mirroring){this.mirroring=tmp;if((this.mirroring&2)===0){this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING)}else if((this.mirroring&1)!==0){this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING)}else{this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING)}}this.prgSwitchingArea=value>>2&1;this.prgSwitchingSize=value>>3&1;this.vromSwitchingSize=value>>4&1;break;case 1:this.romSelectionReg0=value>>4&1;if(this.nes.rom.vromCount>0){if(this.vromSwitchingSize===0){if(this.romSelectionReg0===0){this.load8kVromBank(value&15,0)}else{this.load8kVromBank(Math.floor(this.nes.rom.vromCount/2)+(value&15),0)}}else{if(this.romSelectionReg0===0){this.loadVromBank(value&15,0)}else{this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(value&15),0)}}}break;case 2:this.romSelectionReg1=value>>4&1;if(this.nes.rom.vromCount>0){if(this.vromSwitchingSize===1){if(this.romSelectionReg1===0){this.loadVromBank(value&15,4096)}else{this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(value&15),4096)}}}break;default:tmp=value&15;var bank;var baseBank=0;if(this.nes.rom.romCount>=32){if(this.vromSwitchingSize===0){if(this.romSelectionReg0===1){baseBank=16}}else{baseBank=(this.romSelectionReg0|this.romSelectionReg1<<1)<<3}}else if(this.nes.rom.romCount>=16){if(this.romSelectionReg0===1){baseBank=8}}if(this.prgSwitchingSize===0){bank=baseBank+(value&15);this.load32kRomBank(bank,32768)}else{bank=baseBank*2+(value&15);if(this.prgSwitchingArea===0){this.loadRomBank(bank,49152)}else{this.loadRomBank(bank,32768)}}}};JSNES.Mappers[1].prototype.getRegNumber=function(address){if(address>=32768&&address<=40959){return 0}else if(address>=40960&&address<=49151){return 1}else if(address>=49152&&address<=57343){return 2}else{return 3}};JSNES.Mappers[1].prototype.loadROM=function(rom){if(!this.nes.rom.valid){alert("MMC1: Invalid ROM! Unable to load.");return}this.loadRomBank(0,32768);this.loadRomBank(this.nes.rom.romCount-1,49152);this.loadCHRROM();this.loadBatteryRam();this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)};JSNES.Mappers[1].prototype.switchLowHighPrgRom=function(oldSetting){};JSNES.Mappers[1].prototype.switch16to32=function(){};JSNES.Mappers[1].prototype.switch32to16=function(){};JSNES.Mappers[1].prototype.toJSON=function(){var s=JSNES.Mappers[0].prototype.toJSON.apply(this);s.mirroring=this.mirroring;s.oneScreenMirroring=this.oneScreenMirroring;s.prgSwitchingArea=this.prgSwitchingArea;s.prgSwitchingSize=this.prgSwitchingSize;s.vromSwitchingSize=this.vromSwitchingSize;s.romSelectionReg0=this.romSelectionReg0;s.romSelectionReg1=this.romSelectionReg1;s.romBankSelect=this.romBankSelect;s.regBuffer=this.regBuffer;s.regBufferCounter=this.regBufferCounter;return s};JSNES.Mappers[1].prototype.fromJSON=function(s){JSNES.Mappers[0].prototype.fromJSON.apply(this,s);this.mirroring=s.mirroring;this.oneScreenMirroring=s.oneScreenMirroring;this.prgSwitchingArea=s.prgSwitchingArea;this.prgSwitchingSize=s.prgSwitchingSize;this.vromSwitchingSize=s.vromSwitchingSize;this.romSelectionReg0=s.romSelectionReg0;this.romSelectionReg1=s.romSelectionReg1;this.romBankSelect=s.romBankSelect;this.regBuffer=s.regBuffer;this.regBufferCounter=s.regBufferCounter};JSNES.Mappers[2]=function(nes){this.nes=nes};JSNES.Mappers[2].prototype=new JSNES.Mappers[0];JSNES.Mappers[2].prototype.write=function(address,value){if(address<32768){JSNES.Mappers[0].prototype.write.apply(this,arguments);return}else{this.loadRomBank(value,32768)}};JSNES.Mappers[2].prototype.loadROM=function(rom){if(!this.nes.rom.valid){alert("UNROM: Invalid ROM! Unable to load.");return}this.loadRomBank(0,32768);this.loadRomBank(this.nes.rom.romCount-1,49152);this.loadCHRROM();this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)};JSNES.Mappers[4]=function(nes){this.nes=nes;this.CMD_SEL_2_1K_VROM_0000=0;this.CMD_SEL_2_1K_VROM_0800=1;this.CMD_SEL_1K_VROM_1000=2;this.CMD_SEL_1K_VROM_1400=3;this.CMD_SEL_1K_VROM_1800=4;this.CMD_SEL_1K_VROM_1C00=5;this.CMD_SEL_ROM_PAGE1=6;this.CMD_SEL_ROM_PAGE2=7;this.command=null;this.prgAddressSelect=null;this.chrAddressSelect=null;this.pageNumber=null;this.irqCounter=null;this.irqLatchValue=null;this.irqEnable=null;this.prgAddressChanged=false};JSNES.Mappers[4].prototype=new JSNES.Mappers[0];JSNES.Mappers[4].prototype.write=function(address,value){if(address<32768){JSNES.Mappers[0].prototype.write.apply(this,arguments);return}switch(address){case 32768:this.command=value&7;var tmp=value>>6&1;if(tmp!=this.prgAddressSelect){this.prgAddressChanged=true}this.prgAddressSelect=tmp;this.chrAddressSelect=value>>7&1;break;case 32769:this.executeCommand(this.command,value);break;case 40960:if((value&1)!==0){this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING)}else{this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING)}break;case 40961:break;case 49152:this.irqCounter=value;break;case 49153:this.irqLatchValue=value;break;case 57344:this.irqEnable=0;break;case 57345:this.irqEnable=1;break;default:}};JSNES.Mappers[4].prototype.executeCommand=function(cmd,arg){switch(cmd){case this.CMD_SEL_2_1K_VROM_0000:if(this.chrAddressSelect===0){this.load1kVromBank(arg,0);this.load1kVromBank(arg+1,1024)}else{this.load1kVromBank(arg,4096);this.load1kVromBank(arg+1,5120)}break;case this.CMD_SEL_2_1K_VROM_0800:if(this.chrAddressSelect===0){this.load1kVromBank(arg,2048);this.load1kVromBank(arg+1,3072)}else{this.load1kVromBank(arg,6144);this.load1kVromBank(arg+1,7168)}break;case this.CMD_SEL_1K_VROM_1000:if(this.chrAddressSelect===0){this.load1kVromBank(arg,4096)}else{this.load1kVromBank(arg,0)}break;case this.CMD_SEL_1K_VROM_1400:if(this.chrAddressSelect===0){this.load1kVromBank(arg,5120)}else{this.load1kVromBank(arg,1024)}break;case this.CMD_SEL_1K_VROM_1800:if(this.chrAddressSelect===0){this.load1kVromBank(arg,6144)}else{this.load1kVromBank(arg,2048)}break;case this.CMD_SEL_1K_VROM_1C00:if(this.chrAddressSelect===0){this.load1kVromBank(arg,7168)}else{this.load1kVromBank(arg,3072)}break;case this.CMD_SEL_ROM_PAGE1:if(this.prgAddressChanged){if(this.prgAddressSelect===0){this.load8kRomBank((this.nes.rom.romCount-1)*2,49152)}else{this.load8kRomBank((this.nes.rom.romCount-1)*2,32768)}this.prgAddressChanged=false}if(this.prgAddressSelect===0){this.load8kRomBank(arg,32768)}else{this.load8kRomBank(arg,49152)}break;case this.CMD_SEL_ROM_PAGE2:this.load8kRomBank(arg,40960);if(this.prgAddressChanged){if(this.prgAddressSelect===0){this.load8kRomBank((this.nes.rom.romCount-1)*2,49152)}else{this.load8kRomBank((this.nes.rom.romCount-1)*2,32768)}this.prgAddressChanged=false}}};JSNES.Mappers[4].prototype.loadROM=function(rom){if(!this.nes.rom.valid){alert("MMC3: Invalid ROM! Unable to load.");return}this.load8kRomBank((this.nes.rom.romCount-1)*2,49152);this.load8kRomBank((this.nes.rom.romCount-1)*2+1,57344);this.load8kRomBank(0,32768);this.load8kRomBank(1,40960);this.loadCHRROM();this.loadBatteryRam();this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)};JSNES.Mappers[4].prototype.clockIrqCounter=function(){if(this.irqEnable==1){this.irqCounter--;if(this.irqCounter<0){this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL);this.irqCounter=this.irqLatchValue}}};JSNES.Mappers[4].prototype.toJSON=function(){var s=JSNES.Mappers[0].prototype.toJSON.apply(this);s.command=this.command;s.prgAddressSelect=this.prgAddressSelect;s.chrAddressSelect=this.chrAddressSelect;s.pageNumber=this.pageNumber;s.irqCounter=this.irqCounter;s.irqLatchValue=this.irqLatchValue;s.irqEnable=this.irqEnable;s.prgAddressChanged=this.prgAddressChanged;return s};JSNES.Mappers[4].prototype.fromJSON=function(s){JSNES.Mappers[0].prototype.fromJSON.apply(this,s);this.command=s.command;this.prgAddressSelect=s.prgAddressSelect;this.chrAddressSelect=s.chrAddressSelect;this.pageNumber=s.pageNumber;this.irqCounter=s.irqCounter;this.irqLatchValue=s.irqLatchValue;this.irqEnable=s.irqEnable;this.prgAddressChanged=s.prgAddressChanged};JSNES.Mappers[5]=function(nes){this.nes=nes};JSNES.Mappers[5].prototype=new JSNES.Mappers[0];JSNES.Mappers[5].prototype.write=function(address,value){if(address<32768){JSNES.Mappers[0].prototype.write.apply(this,arguments)}else{this.load8kVromBank(value,0)}};JSNES.Mappers[5].prototype.write=function(address,value){if(address<20480){JSNES.Mappers[0].prototype.write.apply(this,arguments);return}switch(address){case 20736:this.prg_size=value&3;break;case 20737:this.chr_size=value&3;break;case 20738:this.sram_we_a=value&3;break;case 20739:this.sram_we_b=value&3;break;case 20740:this.graphic_mode=value&3;break;case 20741:this.nametable_mode=value;this.nametable_type[0]=value&3;this.load1kVromBank(value&3,8192);value>>=2;this.nametable_type[1]=value&3;this.load1kVromBank(value&3,9216);value>>=2;this.nametable_type[2]=value&3;this.load1kVromBank(value&3,10240);value>>=2;this.nametable_type[3]=value&3;this.load1kVromBank(value&3,11264);break;case 20742:this.fill_chr=value;break;case 20743:this.fill_pal=value&3;break;case 20755:this.SetBank_SRAM(3,value&3);break;case 20756:case 20757:case 20758:case 20759:this.SetBank_CPU(address,value);break;case 20768:case 20769:case 20770:case 20771:case 20772:case 20773:case 20774:case 20775:this.chr_mode=0;this.chr_page[0][address&7]=value;this.SetBank_PPU();break;case 20776:case 20777:case 20778:case 20779:this.chr_mode=1;this.chr_page[1][(address&3)+0]=value;this.chr_page[1][(address&3)+4]=value;this.SetBank_PPU();break;case 20992:this.split_control=value;break;case 20993:this.split_scroll=value;break;case 20994:this.split_page=value&63;break;case 20995:this.irq_line=value;this.nes.cpu.ClearIRQ();break;case 20996:this.irq_enable=value;this.nes.cpu.ClearIRQ();break;case 20997:this.mult_a=value;break;case 20998:this.mult_b=value;break;default:if(address>=20480&&address<=20501){this.nes.papu.exWrite(address,value)}else if(address>=23552&&address<=24575){if(this.graphic_mode==2){}else if(this.graphic_mode!=3){if(this.irq_status&64){}else{}}}else if(address>=24576&&address<=32767){if(this.sram_we_a==2&&this.sram_we_b==1){}}break}};JSNES.Mappers[5].prototype.loadROM=function(rom){if(!this.nes.rom.valid){alert("UNROM: Invalid ROM! Unable to load.");return}this.load8kRomBank(this.nes.rom.romCount*2-1,32768);this.load8kRomBank(this.nes.rom.romCount*2-1,40960);this.load8kRomBank(this.nes.rom.romCount*2-1,49152);this.load8kRomBank(this.nes.rom.romCount*2-1,57344);this.loadCHRROM();this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)};JSNES.Mappers[7]=function(nes){this.nes=nes};JSNES.Mappers[7].prototype=new JSNES.Mappers[0];JSNES.Mappers[7].prototype.write=function(address,value){if(address<32768){JSNES.Mappers[0].prototype.write.apply(this,arguments)}else{this.load32kRomBank(value&7,32768);if(value&16){this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING2)}else{this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING)}}};JSNES.Mappers[7].prototype.loadROM=function(rom){if(!this.nes.rom.valid){alert("AOROM: Invalid ROM! Unable to load.");return}this.loadPRGROM();this.loadCHRROM();this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)};JSNES.Mappers[11]=function(nes){this.nes=nes};JSNES.Mappers[11].prototype=new JSNES.Mappers[0];JSNES.Mappers[11].prototype.write=function(address,value){if(address<32768){JSNES.Mappers[0].prototype.write.apply(this,arguments);return}else{var prgbank1=(value&15)*2%this.nes.rom.romCount;var prgbank2=((value&15)*2+1)%this.nes.rom.romCount;this.loadRomBank(prgbank1,32768);this.loadRomBank(prgbank2,49152);if(this.nes.rom.vromCount>0){var bank=(value>>4)*2%this.nes.rom.vromCount;this.loadVromBank(bank,0);this.loadVromBank(bank+1,4096)}}};JSNES.Mappers[34]=function(nes){this.nes=nes};JSNES.Mappers[34].prototype=new JSNES.Mappers[0];JSNES.Mappers[34].prototype.write=function(address,value){if(address<32768){JSNES.Mappers[0].prototype.write.apply(this,arguments);return}else{this.load32kRomBank(value,32768)}};JSNES.Mappers[66]=function(nes){this.nes=nes;console.log("Mapper 66")};JSNES.Mappers[66].prototype=new JSNES.Mappers[0];JSNES.Mappers[66].prototype.write=function(address,value){if(address<32768){JSNES.Mappers[0].prototype.write.apply(this,arguments);return}else{this.load32kRomBank(value>>4&3,32768);this.load8kVromBank((value&3)*2,0)}};JSNES.PAPU=function(nes){this.nes=nes;this.square1=new JSNES.PAPU.ChannelSquare(this,true);this.square2=new JSNES.PAPU.ChannelSquare(this,false);this.triangle=new JSNES.PAPU.ChannelTriangle(this);this.noise=new JSNES.PAPU.ChannelNoise(this);this.dmc=new JSNES.PAPU.ChannelDM(this);this.frameIrqCounter=null;this.frameIrqCounterMax=4;this.initCounter=2048;this.channelEnableValue=null;this.bufferSize=8192;this.bufferIndex=0;this.sampleRate=44100;this.lengthLookup=null;this.dmcFreqLookup=null;this.noiseWavelengthLookup=null;this.square_table=null;this.tnd_table=null;this.sampleBuffer=new Array(this.bufferSize*2);this.frameIrqEnabled=false;this.frameIrqActive=null;this.frameClockNow=null;this.startedPlaying=false;this.recordOutput=false;this.initingHardware=false;this.masterFrameCounter=null;this.derivedFrameCounter=null;this.countSequence=null;this.sampleTimer=null;this.frameTime=null;this.sampleTimerMax=null;this.sampleCount=null;this.triValue=0;this.smpSquare1=null;this.smpSquare2=null;this.smpTriangle=null;this.smpDmc=null;this.accCount=null;this.prevSampleL=0;this.prevSampleR=0;this.smpAccumL=0;this.smpAccumR=0;this.dacRange=0;this.dcValue=0;this.masterVolume=256;this.stereoPosLSquare1=null;this.stereoPosLSquare2=null;this.stereoPosLTriangle=null;this.stereoPosLNoise=null;this.stereoPosLDMC=null;this.stereoPosRSquare1=null;this.stereoPosRSquare2=null;this.stereoPosRTriangle=null;this.stereoPosRNoise=null;this.stereoPosRDMC=null;this.extraCycles=null;this.maxSample=null;this.minSample=null;this.panning=[80,170,100,150,128];this.setPanning(this.panning);this.initLengthLookup();this.initDmcFrequencyLookup();this.initNoiseWavelengthLookup();this.initDACtables();for(var i=0;i<20;i++){if(i===16){this.writeReg(16400,16)}else{this.writeReg(16384+i,0)}}this.reset()};JSNES.PAPU.prototype={reset:function(){this.sampleRate=this.nes.opts.sampleRate;this.sampleTimerMax=Math.floor(1024*this.nes.opts.CPU_FREQ_NTSC*this.nes.opts.preferredFrameRate/(this.sampleRate*60));this.frameTime=Math.floor(14915*this.nes.opts.preferredFrameRate/60);this.sampleTimer=0;this.bufferIndex=0;this.updateChannelEnable(0);this.masterFrameCounter=0;this.derivedFrameCounter=0;this.countSequence=0;this.sampleCount=0;this.initCounter=2048;this.frameIrqEnabled=false;this.initingHardware=false;this.resetCounter();this.square1.reset();this.square2.reset();this.triangle.reset();this.noise.reset();this.dmc.reset();this.bufferIndex=0;this.accCount=0;this.smpSquare1=0;this.smpSquare2=0;this.smpTriangle=0;this.smpDmc=0;this.frameIrqEnabled=false;this.frameIrqCounterMax=4;this.channelEnableValue=255;this.startedPlaying=false;this.prevSampleL=0;this.prevSampleR=0;this.smpAccumL=0;this.smpAccumR=0;this.maxSample=-5e5;this.minSample=5e5},readReg:function(address){var tmp=0;tmp|=this.square1.getLengthStatus();tmp|=this.square2.getLengthStatus()<<1;tmp|=this.triangle.getLengthStatus()<<2;tmp|=this.noise.getLengthStatus()<<3;tmp|=this.dmc.getLengthStatus()<<4;tmp|=(this.frameIrqActive&&this.frameIrqEnabled?1:0)<<6;tmp|=this.dmc.getIrqStatus()<<7;this.frameIrqActive=false;this.dmc.irqGenerated=false;return tmp&65535},writeReg:function(address,value){if(address>=16384&&address<16388){this.square1.writeReg(address,value)}else if(address>=16388&&address<16392){this.square2.writeReg(address,value)}else if(address>=16392&&address<16396){this.triangle.writeReg(address,value)}else if(address>=16396&&address<=16399){this.noise.writeReg(address,value)}else if(address===16400){this.dmc.writeReg(address,value)}else if(address===16401){this.dmc.writeReg(address,value)}else if(address===16402){this.dmc.writeReg(address,value)}else if(address===16403){this.dmc.writeReg(address,value)}else if(address===16405){this.updateChannelEnable(value);if(value!==0&&this.initCounter>0){this.initingHardware=true}this.dmc.writeReg(address,value)}else if(address===16407){this.countSequence=value>>7&1;this.masterFrameCounter=0;this.frameIrqActive=false;if((value>>6&1)===0){this.frameIrqEnabled=true}else{this.frameIrqEnabled=false}if(this.countSequence===0){this.frameIrqCounterMax=4;this.derivedFrameCounter=4}else{this.frameIrqCounterMax=5;this.derivedFrameCounter=0;this.frameCounterTick()}}},resetCounter:function(){if(this.countSequence===0){this.derivedFrameCounter=4}else{this.derivedFrameCounter=0}},updateChannelEnable:function(value){this.channelEnableValue=value&65535;this.square1.setEnabled((value&1)!==0);this.square2.setEnabled((value&2)!==0);this.triangle.setEnabled((value&4)!==0);this.noise.setEnabled((value&8)!==0);this.dmc.setEnabled((value&16)!==0)},clockFrameCounter:function(nCycles){if(this.initCounter>0){if(this.initingHardware){this.initCounter-=nCycles;if(this.initCounter<=0){this.initingHardware=false}return}}nCycles+=this.extraCycles;var maxCycles=this.sampleTimerMax-this.sampleTimer;if(nCycles<<10>maxCycles){this.extraCycles=(nCycles<<10)-maxCycles>>10;nCycles-=this.extraCycles}else{this.extraCycles=0}var dmc=this.dmc;var triangle=this.triangle;var square1=this.square1;var square2=this.square2;var noise=this.noise;if(dmc.isEnabled){dmc.shiftCounter-=nCycles<<3;while(dmc.shiftCounter<=0&&dmc.dmaFrequency>0){dmc.shiftCounter+=dmc.dmaFrequency;dmc.clockDmc()}}if(triangle.progTimerMax>0){triangle.progTimerCount-=nCycles;while(triangle.progTimerCount<=0){triangle.progTimerCount+=triangle.progTimerMax+1;if(triangle.linearCounter>0&&triangle.lengthCounter>0){triangle.triangleCounter++;triangle.triangleCounter&=31;if(triangle.isEnabled){if(triangle.triangleCounter>=16){triangle.sampleValue=triangle.triangleCounter&15}else{triangle.sampleValue=15-(triangle.triangleCounter&15)}triangle.sampleValue<<=4}}}}square1.progTimerCount-=nCycles;if(square1.progTimerCount<=0){square1.progTimerCount+=square1.progTimerMax+1<<1;square1.squareCounter++;square1.squareCounter&=7;square1.updateSampleValue()}square2.progTimerCount-=nCycles;if(square2.progTimerCount<=0){square2.progTimerCount+=square2.progTimerMax+1<<1;square2.squareCounter++;square2.squareCounter&=7;square2.updateSampleValue()}var acc_c=nCycles;if(noise.progTimerCount-acc_c>0){noise.progTimerCount-=acc_c;noise.accCount+=acc_c;noise.accValue+=acc_c*noise.sampleValue}else{while(acc_c-- >0){if(--noise.progTimerCount<=0&&noise.progTimerMax>0){noise.shiftReg<<=1;noise.tmp=(noise.shiftReg<<(noise.randomMode===0?1:6)^noise.shiftReg)&32768;if(noise.tmp!==0){noise.shiftReg|=1;noise.randomBit=0;noise.sampleValue=0}else{noise.randomBit=1;if(noise.isEnabled&&noise.lengthCounter>0){noise.sampleValue=noise.masterVolume}else{noise.sampleValue=0}}noise.progTimerCount+=noise.progTimerMax}noise.accValue+=noise.sampleValue;noise.accCount++}}if(this.frameIrqEnabled&&this.frameIrqActive){this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL)}this.masterFrameCounter+=nCycles<<1;if(this.masterFrameCounter>=this.frameTime){this.masterFrameCounter-=this.frameTime;this.frameCounterTick()}this.accSample(nCycles);this.sampleTimer+=nCycles<<10;if(this.sampleTimer>=this.sampleTimerMax){this.sample();this.sampleTimer-=this.sampleTimerMax}},accSample:function(cycles){if(this.triangle.sampleCondition){this.triValue=Math.floor((this.triangle.progTimerCount<<4)/(this.triangle.progTimerMax+1));if(this.triValue>16){this.triValue=16}if(this.triangle.triangleCounter>=16){this.triValue=16-this.triValue}this.triValue+=this.triangle.sampleValue}if(cycles===2){this.smpTriangle+=this.triValue<<1;this.smpDmc+=this.dmc.sample<<1;this.smpSquare1+=this.square1.sampleValue<<1;this.smpSquare2+=this.square2.sampleValue<<1;this.accCount+=2}else if(cycles===4){this.smpTriangle+=this.triValue<<2;this.smpDmc+=this.dmc.sample<<2;this.smpSquare1+=this.square1.sampleValue<<2;this.smpSquare2+=this.square2.sampleValue<<2;this.accCount+=4}else{this.smpTriangle+=cycles*this.triValue;this.smpDmc+=cycles*this.dmc.sample;this.smpSquare1+=cycles*this.square1.sampleValue;this.smpSquare2+=cycles*this.square2.sampleValue;this.accCount+=cycles}},frameCounterTick:function(){this.derivedFrameCounter++;if(this.derivedFrameCounter>=this.frameIrqCounterMax){this.derivedFrameCounter=0}if(this.derivedFrameCounter===1||this.derivedFrameCounter===3){this.triangle.clockLengthCounter();this.square1.clockLengthCounter();this.square2.clockLengthCounter();this.noise.clockLengthCounter();this.square1.clockSweep();this.square2.clockSweep()}if(this.derivedFrameCounter>=0&&this.derivedFrameCounter<4){this.square1.clockEnvDecay();this.square2.clockEnvDecay();this.noise.clockEnvDecay();this.triangle.clockLinearCounter()}if(this.derivedFrameCounter===3&&this.countSequence===0){this.frameIrqActive=true}},sample:function(){var sq_index,tnd_index;if(this.accCount>0){this.smpSquare1<<=4;this.smpSquare1=Math.floor(this.smpSquare1/this.accCount);this.smpSquare2<<=4;this.smpSquare2=Math.floor(this.smpSquare2/this.accCount);this.smpTriangle=Math.floor(this.smpTriangle/this.accCount);this.smpDmc<<=4;this.smpDmc=Math.floor(this.smpDmc/this.accCount);this.accCount=0}else{this.smpSquare1=this.square1.sampleValue<<4;this.smpSquare2=this.square2.sampleValue<<4;this.smpTriangle=this.triangle.sampleValue;this.smpDmc=this.dmc.sample<<4}var smpNoise=Math.floor((this.noise.accValue<<4)/this.noise.accCount);this.noise.accValue=smpNoise>>4;this.noise.accCount=1;sq_index=this.smpSquare1*this.stereoPosLSquare1+this.smpSquare2*this.stereoPosLSquare2>>8;tnd_index=3*this.smpTriangle*this.stereoPosLTriangle+(smpNoise<<1)*this.stereoPosLNoise+this.smpDmc*this.stereoPosLDMC>>8;if(sq_index>=this.square_table.length){sq_index=this.square_table.length-1}if(tnd_index>=this.tnd_table.length){tnd_index=this.tnd_table.length-1}var sampleValueL=this.square_table[sq_index]+this.tnd_table[tnd_index]-this.dcValue;sq_index=this.smpSquare1*this.stereoPosRSquare1+this.smpSquare2*this.stereoPosRSquare2>>8;tnd_index=3*this.smpTriangle*this.stereoPosRTriangle+(smpNoise<<1)*this.stereoPosRNoise+this.smpDmc*this.stereoPosRDMC>>8;if(sq_index>=this.square_table.length){sq_index=this.square_table.length-1}if(tnd_index>=this.tnd_table.length){tnd_index=this.tnd_table.length-1}var sampleValueR=this.square_table[sq_index]+this.tnd_table[tnd_index]-this.dcValue;var smpDiffL=sampleValueL-this.prevSampleL;this.prevSampleL+=smpDiffL;this.smpAccumL+=smpDiffL-(this.smpAccumL>>10);sampleValueL=this.smpAccumL;var smpDiffR=sampleValueR-this.prevSampleR;this.prevSampleR+=smpDiffR;this.smpAccumR+=smpDiffR-(this.smpAccumR>>10);sampleValueR=this.smpAccumR;if(sampleValueL>this.maxSample){this.maxSample=sampleValueL}if(sampleValueL<this.minSample){this.minSample=sampleValueL}this.sampleBuffer[this.bufferIndex++]=sampleValueL;this.sampleBuffer[this.bufferIndex++]=sampleValueR;if(this.bufferIndex===this.sampleBuffer.length){this.nes.ui.writeAudio(this.sampleBuffer);this.sampleBuffer=new Array(this.bufferSize*2);this.bufferIndex=0}this.smpSquare1=0;this.smpSquare2=0;this.smpTriangle=0;this.smpDmc=0},getLengthMax:function(value){return this.lengthLookup[value>>3]},getDmcFrequency:function(value){if(value>=0&&value<16){return this.dmcFreqLookup[value]}return 0},getNoiseWaveLength:function(value){if(value>=0&&value<16){return this.noiseWavelengthLookup[value]}return 0},setPanning:function(pos){for(var i=0;i<5;i++){this.panning[i]=pos[i]}this.updateStereoPos()},setMasterVolume:function(value){if(value<0){value=0}if(value>256){value=256}this.masterVolume=value;this.updateStereoPos()},updateStereoPos:function(){this.stereoPosLSquare1=this.panning[0]*this.masterVolume>>8;this.stereoPosLSquare2=this.panning[1]*this.masterVolume>>8;this.stereoPosLTriangle=this.panning[2]*this.masterVolume>>8;this.stereoPosLNoise=this.panning[3]*this.masterVolume>>8;this.stereoPosLDMC=this.panning[4]*this.masterVolume>>8;this.stereoPosRSquare1=this.masterVolume-this.stereoPosLSquare1;this.stereoPosRSquare2=this.masterVolume-this.stereoPosLSquare2;this.stereoPosRTriangle=this.masterVolume-this.stereoPosLTriangle;this.stereoPosRNoise=this.masterVolume-this.stereoPosLNoise;this.stereoPosRDMC=this.masterVolume-this.stereoPosLDMC},initLengthLookup:function(){this.lengthLookup=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30]},initDmcFrequencyLookup:function(){this.dmcFreqLookup=new Array(16);this.dmcFreqLookup[0]=3424;this.dmcFreqLookup[1]=3040;this.dmcFreqLookup[2]=2720;this.dmcFreqLookup[3]=2560;this.dmcFreqLookup[4]=2288;this.dmcFreqLookup[5]=2032;this.dmcFreqLookup[6]=1808;this.dmcFreqLookup[7]=1712;this.dmcFreqLookup[8]=1520;this.dmcFreqLookup[9]=1280;this.dmcFreqLookup[10]=1136;this.dmcFreqLookup[11]=1024;this.dmcFreqLookup[12]=848;this.dmcFreqLookup[13]=672;this.dmcFreqLookup[14]=576;this.dmcFreqLookup[15]=432},initNoiseWavelengthLookup:function(){this.noiseWavelengthLookup=new Array(16);this.noiseWavelengthLookup[0]=4;this.noiseWavelengthLookup[1]=8;this.noiseWavelengthLookup[2]=16;this.noiseWavelengthLookup[3]=32;this.noiseWavelengthLookup[4]=64;this.noiseWavelengthLookup[5]=96;this.noiseWavelengthLookup[6]=128;this.noiseWavelengthLookup[7]=160;this.noiseWavelengthLookup[8]=202;this.noiseWavelengthLookup[9]=254;this.noiseWavelengthLookup[10]=380;this.noiseWavelengthLookup[11]=508;this.noiseWavelengthLookup[12]=762;this.noiseWavelengthLookup[13]=1016;this.noiseWavelengthLookup[14]=2034;this.noiseWavelengthLookup[15]=4068},initDACtables:function(){var value,ival,i;var max_sqr=0;var max_tnd=0;this.square_table=new Array(32*16);this.tnd_table=new Array(204*16);for(i=0;i<32*16;i++){value=95.52/(8128/(i/16)+100);value*=.98411;value*=5e4;ival=Math.floor(value);this.square_table[i]=ival;if(ival>max_sqr){max_sqr=ival}}for(i=0;i<204*16;i++){value=163.67/(24329/(i/16)+100);value*=.98411;value*=5e4;ival=Math.floor(value);this.tnd_table[i]=ival;if(ival>max_tnd){max_tnd=ival}}this.dacRange=max_sqr+max_tnd;this.dcValue=this.dacRange/2}};JSNES.PAPU.ChannelDM=function(papu){this.papu=papu;this.MODE_NORMAL=0;this.MODE_LOOP=1;this.MODE_IRQ=2;this.isEnabled=null;this.hasSample=null;this.irqGenerated=false;this.playMode=null;this.dmaFrequency=null;this.dmaCounter=null;this.deltaCounter=null;this.playStartAddress=null;this.playAddress=null;this.playLength=null;this.playLengthCounter=null;this.shiftCounter=null;this.reg4012=null;this.reg4013=null;this.sample=null;this.dacLsb=null;this.data=null;this.reset()};JSNES.PAPU.ChannelDM.prototype={clockDmc:function(){if(this.hasSample){if((this.data&1)===0){if(this.deltaCounter>0){this.deltaCounter--}}else{if(this.deltaCounter<63){this.deltaCounter++}}this.sample=this.isEnabled?(this.deltaCounter<<1)+this.dacLsb:0;this.data>>=1}this.dmaCounter--;if(this.dmaCounter<=0){this.hasSample=false;this.endOfSample();this.dmaCounter=8}if(this.irqGenerated){this.papu.nes.cpu.requestIrq(this.papu.nes.cpu.IRQ_NORMAL)}},endOfSample:function(){if(this.playLengthCounter===0&&this.playMode===this.MODE_LOOP){this.playAddress=this.playStartAddress;this.playLengthCounter=this.playLength}if(this.playLengthCounter>0){this.nextSample();if(this.playLengthCounter===0){if(this.playMode===this.MODE_IRQ){this.irqGenerated=true}}}},nextSample:function(){this.data=this.papu.nes.mmap.load(this.playAddress);this.papu.nes.cpu.haltCycles(4);this.playLengthCounter--;this.playAddress++;if(this.playAddress>65535){this.playAddress=32768}this.hasSample=true},writeReg:function(address,value){if(address===16400){if(value>>6===0){this.playMode=this.MODE_NORMAL}else if((value>>6&1)===1){this.playMode=this.MODE_LOOP}else if(value>>6===2){this.playMode=this.MODE_IRQ}if((value&128)===0){this.irqGenerated=false}this.dmaFrequency=this.papu.getDmcFrequency(value&15)}else if(address===16401){this.deltaCounter=value>>1&63;this.dacLsb=value&1;this.sample=(this.deltaCounter<<1)+this.dacLsb}else if(address===16402){this.playStartAddress=value<<6|49152;this.playAddress=this.playStartAddress;this.reg4012=value}else if(address===16403){this.playLength=(value<<4)+1;this.playLengthCounter=this.playLength;this.reg4013=value}else if(address===16405){if((value>>4&1)===0){this.playLengthCounter=0}else{this.playAddress=this.playStartAddress;this.playLengthCounter=this.playLength}this.irqGenerated=false}},setEnabled:function(value){if(!this.isEnabled&&value){this.playLengthCounter=this.playLength}this.isEnabled=value},getLengthStatus:function(){return this.playLengthCounter===0||!this.isEnabled?0:1},getIrqStatus:function(){return this.irqGenerated?1:0},reset:function(){this.isEnabled=false;this.irqGenerated=false;this.playMode=this.MODE_NORMAL;this.dmaFrequency=0;this.dmaCounter=0;this.deltaCounter=0
;this.playStartAddress=0;this.playAddress=0;this.playLength=0;this.playLengthCounter=0;this.sample=0;this.dacLsb=0;this.shiftCounter=0;this.reg4012=0;this.reg4013=0;this.data=0}};JSNES.PAPU.ChannelNoise=function(papu){this.papu=papu;this.isEnabled=null;this.envDecayDisable=null;this.envDecayLoopEnable=null;this.lengthCounterEnable=null;this.envReset=null;this.shiftNow=null;this.lengthCounter=null;this.progTimerCount=null;this.progTimerMax=null;this.envDecayRate=null;this.envDecayCounter=null;this.envVolume=null;this.masterVolume=null;this.shiftReg=1<<14;this.randomBit=null;this.randomMode=null;this.sampleValue=null;this.accValue=0;this.accCount=1;this.tmp=null;this.reset()};JSNES.PAPU.ChannelNoise.prototype={reset:function(){this.progTimerCount=0;this.progTimerMax=0;this.isEnabled=false;this.lengthCounter=0;this.lengthCounterEnable=false;this.envDecayDisable=false;this.envDecayLoopEnable=false;this.shiftNow=false;this.envDecayRate=0;this.envDecayCounter=0;this.envVolume=0;this.masterVolume=0;this.shiftReg=1;this.randomBit=0;this.randomMode=0;this.sampleValue=0;this.tmp=0},clockLengthCounter:function(){if(this.lengthCounterEnable&&this.lengthCounter>0){this.lengthCounter--;if(this.lengthCounter===0){this.updateSampleValue()}}},clockEnvDecay:function(){if(this.envReset){this.envReset=false;this.envDecayCounter=this.envDecayRate+1;this.envVolume=15}else if(--this.envDecayCounter<=0){this.envDecayCounter=this.envDecayRate+1;if(this.envVolume>0){this.envVolume--}else{this.envVolume=this.envDecayLoopEnable?15:0}}this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume;this.updateSampleValue()},updateSampleValue:function(){if(this.isEnabled&&this.lengthCounter>0){this.sampleValue=this.randomBit*this.masterVolume}},writeReg:function(address,value){if(address===16396){this.envDecayDisable=(value&16)!==0;this.envDecayRate=value&15;this.envDecayLoopEnable=(value&32)!==0;this.lengthCounterEnable=(value&32)===0;this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume}else if(address===16398){this.progTimerMax=this.papu.getNoiseWaveLength(value&15);this.randomMode=value>>7}else if(address===16399){this.lengthCounter=this.papu.getLengthMax(value&248);this.envReset=true}},setEnabled:function(value){this.isEnabled=value;if(!value){this.lengthCounter=0}this.updateSampleValue()},getLengthStatus:function(){return this.lengthCounter===0||!this.isEnabled?0:1}};JSNES.PAPU.ChannelSquare=function(papu,square1){this.papu=papu;this.dutyLookup=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1];this.impLookup=[1,-1,0,0,0,0,0,0,1,0,-1,0,0,0,0,0,1,0,0,0,-1,0,0,0,-1,0,1,0,0,0,0,0];this.sqr1=square1;this.isEnabled=null;this.lengthCounterEnable=null;this.sweepActive=null;this.envDecayDisable=null;this.envDecayLoopEnable=null;this.envReset=null;this.sweepCarry=null;this.updateSweepPeriod=null;this.progTimerCount=null;this.progTimerMax=null;this.lengthCounter=null;this.squareCounter=null;this.sweepCounter=null;this.sweepCounterMax=null;this.sweepMode=null;this.sweepShiftAmount=null;this.envDecayRate=null;this.envDecayCounter=null;this.envVolume=null;this.masterVolume=null;this.dutyMode=null;this.sweepResult=null;this.sampleValue=null;this.vol=null;this.reset()};JSNES.PAPU.ChannelSquare.prototype={reset:function(){this.progTimerCount=0;this.progTimerMax=0;this.lengthCounter=0;this.squareCounter=0;this.sweepCounter=0;this.sweepCounterMax=0;this.sweepMode=0;this.sweepShiftAmount=0;this.envDecayRate=0;this.envDecayCounter=0;this.envVolume=0;this.masterVolume=0;this.dutyMode=0;this.vol=0;this.isEnabled=false;this.lengthCounterEnable=false;this.sweepActive=false;this.sweepCarry=false;this.envDecayDisable=false;this.envDecayLoopEnable=false},clockLengthCounter:function(){if(this.lengthCounterEnable&&this.lengthCounter>0){this.lengthCounter--;if(this.lengthCounter===0){this.updateSampleValue()}}},clockEnvDecay:function(){if(this.envReset){this.envReset=false;this.envDecayCounter=this.envDecayRate+1;this.envVolume=15}else if(--this.envDecayCounter<=0){this.envDecayCounter=this.envDecayRate+1;if(this.envVolume>0){this.envVolume--}else{this.envVolume=this.envDecayLoopEnable?15:0}}this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume;this.updateSampleValue()},clockSweep:function(){if(--this.sweepCounter<=0){this.sweepCounter=this.sweepCounterMax+1;if(this.sweepActive&&this.sweepShiftAmount>0&&this.progTimerMax>7){this.sweepCarry=false;if(this.sweepMode===0){this.progTimerMax+=this.progTimerMax>>this.sweepShiftAmount;if(this.progTimerMax>4095){this.progTimerMax=4095;this.sweepCarry=true}}else{this.progTimerMax=this.progTimerMax-((this.progTimerMax>>this.sweepShiftAmount)-(this.sqr1?1:0))}}}if(this.updateSweepPeriod){this.updateSweepPeriod=false;this.sweepCounter=this.sweepCounterMax+1}},updateSampleValue:function(){if(this.isEnabled&&this.lengthCounter>0&&this.progTimerMax>7){if(this.sweepMode===0&&this.progTimerMax+(this.progTimerMax>>this.sweepShiftAmount)>4095){this.sampleValue=0}else{this.sampleValue=this.masterVolume*this.dutyLookup[(this.dutyMode<<3)+this.squareCounter]}}else{this.sampleValue=0}},writeReg:function(address,value){var addrAdd=this.sqr1?0:4;if(address===16384+addrAdd){this.envDecayDisable=(value&16)!==0;this.envDecayRate=value&15;this.envDecayLoopEnable=(value&32)!==0;this.dutyMode=value>>6&3;this.lengthCounterEnable=(value&32)===0;this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume;this.updateSampleValue()}else if(address===16385+addrAdd){this.sweepActive=(value&128)!==0;this.sweepCounterMax=value>>4&7;this.sweepMode=value>>3&1;this.sweepShiftAmount=value&7;this.updateSweepPeriod=true}else if(address===16386+addrAdd){this.progTimerMax&=1792;this.progTimerMax|=value}else if(address===16387+addrAdd){this.progTimerMax&=255;this.progTimerMax|=(value&7)<<8;if(this.isEnabled){this.lengthCounter=this.papu.getLengthMax(value&248)}this.envReset=true}},setEnabled:function(value){this.isEnabled=value;if(!value){this.lengthCounter=0}this.updateSampleValue()},getLengthStatus:function(){return this.lengthCounter===0||!this.isEnabled?0:1}};JSNES.PAPU.ChannelTriangle=function(papu){this.papu=papu;this.isEnabled=null;this.sampleCondition=null;this.lengthCounterEnable=null;this.lcHalt=null;this.lcControl=null;this.progTimerCount=null;this.progTimerMax=null;this.triangleCounter=null;this.lengthCounter=null;this.linearCounter=null;this.lcLoadValue=null;this.sampleValue=null;this.tmp=null;this.reset()};JSNES.PAPU.ChannelTriangle.prototype={reset:function(){this.progTimerCount=0;this.progTimerMax=0;this.triangleCounter=0;this.isEnabled=false;this.sampleCondition=false;this.lengthCounter=0;this.lengthCounterEnable=false;this.linearCounter=0;this.lcLoadValue=0;this.lcHalt=true;this.lcControl=false;this.tmp=0;this.sampleValue=15},clockLengthCounter:function(){if(this.lengthCounterEnable&&this.lengthCounter>0){this.lengthCounter--;if(this.lengthCounter===0){this.updateSampleCondition()}}},clockLinearCounter:function(){if(this.lcHalt){this.linearCounter=this.lcLoadValue;this.updateSampleCondition()}else if(this.linearCounter>0){this.linearCounter--;this.updateSampleCondition()}if(!this.lcControl){this.lcHalt=false}},getLengthStatus:function(){return this.lengthCounter===0||!this.isEnabled?0:1},readReg:function(address){return 0},writeReg:function(address,value){if(address===16392){this.lcControl=(value&128)!==0;this.lcLoadValue=value&127;this.lengthCounterEnable=!this.lcControl}else if(address===16394){this.progTimerMax&=1792;this.progTimerMax|=value}else if(address===16395){this.progTimerMax&=255;this.progTimerMax|=(value&7)<<8;this.lengthCounter=this.papu.getLengthMax(value&248);this.lcHalt=true}this.updateSampleCondition()},clockProgrammableTimer:function(nCycles){if(this.progTimerMax>0){this.progTimerCount+=nCycles;while(this.progTimerMax>0&&this.progTimerCount>=this.progTimerMax){this.progTimerCount-=this.progTimerMax;if(this.isEnabled&&this.lengthCounter>0&&this.linearCounter>0){this.clockTriangleGenerator()}}}},clockTriangleGenerator:function(){this.triangleCounter++;this.triangleCounter&=31},setEnabled:function(value){this.isEnabled=value;if(!value){this.lengthCounter=0}this.updateSampleCondition()},updateSampleCondition:function(){this.sampleCondition=this.isEnabled&&this.progTimerMax>7&&this.linearCounter>0&&this.lengthCounter>0}};JSNES.PPU=function(nes){this.nes=nes;this.vramMem=null;this.spriteMem=null;this.vramAddress=null;this.vramTmpAddress=null;this.vramBufferedReadValue=null;this.firstWrite=null;this.sramAddress=null;this.currentMirroring=null;this.requestEndFrame=null;this.nmiOk=null;this.dummyCycleToggle=null;this.validTileData=null;this.nmiCounter=null;this.scanlineAlreadyRendered=null;this.f_nmiOnVblank=null;this.f_spriteSize=null;this.f_bgPatternTable=null;this.f_spPatternTable=null;this.f_addrInc=null;this.f_nTblAddress=null;this.f_color=null;this.f_spVisibility=null;this.f_bgVisibility=null;this.f_spClipping=null;this.f_bgClipping=null;this.f_dispType=null;this.cntFV=null;this.cntV=null;this.cntH=null;this.cntVT=null;this.cntHT=null;this.regFV=null;this.regV=null;this.regH=null;this.regVT=null;this.regHT=null;this.regFH=null;this.regS=null;this.curNt=null;this.attrib=null;this.buffer=null;this.prevBuffer=null;this.bgbuffer=null;this.pixrendered=null;this.validTileData=null;this.scantile=null;this.scanline=null;this.lastRenderedScanline=null;this.curX=null;this.sprX=null;this.sprY=null;this.sprTile=null;this.sprCol=null;this.vertFlip=null;this.horiFlip=null;this.bgPriority=null;this.spr0HitX=null;this.spr0HitY=null;this.hitSpr0=null;this.sprPalette=null;this.imgPalette=null;this.ptTile=null;this.ntable1=null;this.currentMirroring=null;this.nameTable=null;this.vramMirrorTable=null;this.palTable=null;this.showSpr0Hit=false;this.clipToTvSize=true;this.reset()};JSNES.PPU.prototype={STATUS_VRAMWRITE:4,STATUS_SLSPRITECOUNT:5,STATUS_SPRITE0HIT:6,STATUS_VBLANK:7,reset:function(){var i;this.vramMem=new Array(32768);this.spriteMem=new Array(256);for(i=0;i<this.vramMem.length;i++){this.vramMem[i]=0}for(i=0;i<this.spriteMem.length;i++){this.spriteMem[i]=0}this.vramAddress=null;this.vramTmpAddress=null;this.vramBufferedReadValue=0;this.firstWrite=true;this.sramAddress=0;this.currentMirroring=-1;this.requestEndFrame=false;this.nmiOk=false;this.dummyCycleToggle=false;this.validTileData=false;this.nmiCounter=0;this.scanlineAlreadyRendered=null;this.f_nmiOnVblank=0;this.f_spriteSize=0;this.f_bgPatternTable=0;this.f_spPatternTable=0;this.f_addrInc=0;this.f_nTblAddress=0;this.f_color=0;this.f_spVisibility=0;this.f_bgVisibility=0;this.f_spClipping=0;this.f_bgClipping=0;this.f_dispType=0;this.cntFV=0;this.cntV=0;this.cntH=0;this.cntVT=0;this.cntHT=0;this.regFV=0;this.regV=0;this.regH=0;this.regVT=0;this.regHT=0;this.regFH=0;this.regS=0;this.curNt=null;this.attrib=new Array(32);this.buffer=new Array(256*240);this.prevBuffer=new Array(256*240);this.bgbuffer=new Array(256*240);this.pixrendered=new Array(256*240);this.validTileData=null;this.scantile=new Array(32);this.scanline=0;this.lastRenderedScanline=-1;this.curX=0;this.sprX=new Array(64);this.sprY=new Array(64);this.sprTile=new Array(64);this.sprCol=new Array(64);this.vertFlip=new Array(64);this.horiFlip=new Array(64);this.bgPriority=new Array(64);this.spr0HitX=0;this.spr0HitY=0;this.hitSpr0=false;this.sprPalette=new Array(16);this.imgPalette=new Array(16);this.ptTile=new Array(512);for(i=0;i<512;i++){this.ptTile[i]=new JSNES.PPU.Tile}this.ntable1=new Array(4);this.currentMirroring=-1;this.nameTable=new Array(4);for(i=0;i<4;i++){this.nameTable[i]=new JSNES.PPU.NameTable(32,32,"Nt"+i)}this.vramMirrorTable=new Array(32768);for(i=0;i<32768;i++){this.vramMirrorTable[i]=i}this.palTable=new JSNES.PPU.PaletteTable;this.palTable.loadNTSCPalette();this.updateControlReg1(0);this.updateControlReg2(0)},setMirroring:function(mirroring){if(mirroring==this.currentMirroring){return}this.currentMirroring=mirroring;this.triggerRendering();if(this.vramMirrorTable===null){this.vramMirrorTable=new Array(32768)}for(var i=0;i<32768;i++){this.vramMirrorTable[i]=i}this.defineMirrorRegion(16160,16128,32);this.defineMirrorRegion(16192,16128,32);this.defineMirrorRegion(16256,16128,32);this.defineMirrorRegion(16320,16128,32);this.defineMirrorRegion(12288,8192,3840);this.defineMirrorRegion(16384,0,16384);if(mirroring==this.nes.rom.HORIZONTAL_MIRRORING){this.ntable1[0]=0;this.ntable1[1]=0;this.ntable1[2]=1;this.ntable1[3]=1;this.defineMirrorRegion(9216,8192,1024);this.defineMirrorRegion(11264,10240,1024)}else if(mirroring==this.nes.rom.VERTICAL_MIRRORING){this.ntable1[0]=0;this.ntable1[1]=1;this.ntable1[2]=0;this.ntable1[3]=1;this.defineMirrorRegion(10240,8192,1024);this.defineMirrorRegion(11264,9216,1024)}else if(mirroring==this.nes.rom.SINGLESCREEN_MIRRORING){this.ntable1[0]=0;this.ntable1[1]=0;this.ntable1[2]=0;this.ntable1[3]=0;this.defineMirrorRegion(9216,8192,1024);this.defineMirrorRegion(10240,8192,1024);this.defineMirrorRegion(11264,8192,1024)}else if(mirroring==this.nes.rom.SINGLESCREEN_MIRRORING2){this.ntable1[0]=1;this.ntable1[1]=1;this.ntable1[2]=1;this.ntable1[3]=1;this.defineMirrorRegion(9216,9216,1024);this.defineMirrorRegion(10240,9216,1024);this.defineMirrorRegion(11264,9216,1024)}else{this.ntable1[0]=0;this.ntable1[1]=1;this.ntable1[2]=2;this.ntable1[3]=3}},defineMirrorRegion:function(fromStart,toStart,size){for(var i=0;i<size;i++){this.vramMirrorTable[fromStart+i]=toStart+i}},startVBlank:function(){this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI);if(this.lastRenderedScanline<239){this.renderFramePartially(this.lastRenderedScanline+1,240-this.lastRenderedScanline)}this.endFrame();this.lastRenderedScanline=-1},endScanline:function(){switch(this.scanline){case 19:if(this.dummyCycleToggle){this.curX=1;this.dummyCycleToggle=!this.dummyCycleToggle}break;case 20:this.setStatusFlag(this.STATUS_VBLANK,false);this.setStatusFlag(this.STATUS_SPRITE0HIT,false);this.hitSpr0=false;this.spr0HitX=-1;this.spr0HitY=-1;if(this.f_bgVisibility==1||this.f_spVisibility==1){this.cntFV=this.regFV;this.cntV=this.regV;this.cntH=this.regH;this.cntVT=this.regVT;this.cntHT=this.regHT;if(this.f_bgVisibility==1){this.renderBgScanline(false,0)}}if(this.f_bgVisibility==1&&this.f_spVisibility==1){this.checkSprite0(0)}if(this.f_bgVisibility==1||this.f_spVisibility==1){this.nes.mmap.clockIrqCounter()}break;case 261:this.setStatusFlag(this.STATUS_VBLANK,true);this.requestEndFrame=true;this.nmiCounter=9;this.scanline=-1;break;default:if(this.scanline>=21&&this.scanline<=260){if(this.f_bgVisibility==1){if(!this.scanlineAlreadyRendered){this.cntHT=this.regHT;this.cntH=this.regH;this.renderBgScanline(true,this.scanline+1-21)}this.scanlineAlreadyRendered=false;if(!this.hitSpr0&&this.f_spVisibility==1){if(this.sprX[0]>=-7&&this.sprX[0]<256&&this.sprY[0]+1<=this.scanline-20&&this.sprY[0]+1+(this.f_spriteSize===0?8:16)>=this.scanline-20){if(this.checkSprite0(this.scanline-20)){this.hitSpr0=true}}}}if(this.f_bgVisibility==1||this.f_spVisibility==1){this.nes.mmap.clockIrqCounter()}}}this.scanline++;this.regsToAddress();this.cntsToAddress()},startFrame:function(){var bgColor=0;if(this.f_dispType===0){bgColor=this.imgPalette[0]}else{switch(this.f_color){case 0:bgColor=0;break;case 1:bgColor=65280;break;case 2:bgColor=16711680;break;case 3:bgColor=0;break;case 4:bgColor=255;break;default:bgColor=0}}var buffer=this.buffer;var i;for(i=0;i<256*240;i++){buffer[i]=bgColor}var pixrendered=this.pixrendered;for(i=0;i<pixrendered.length;i++){pixrendered[i]=65}},endFrame:function(){var i,x,y;var buffer=this.buffer;if(this.showSpr0Hit){if(this.sprX[0]>=0&&this.sprX[0]<256&&this.sprY[0]>=0&&this.sprY[0]<240){for(i=0;i<256;i++){buffer[(this.sprY[0]<<8)+i]=16733525}for(i=0;i<240;i++){buffer[(i<<8)+this.sprX[0]]=16733525}}if(this.spr0HitX>=0&&this.spr0HitX<256&&this.spr0HitY>=0&&this.spr0HitY<240){for(i=0;i<256;i++){buffer[(this.spr0HitY<<8)+i]=5635925}for(i=0;i<240;i++){buffer[(i<<8)+this.spr0HitX]=5635925}}}if(this.clipToTvSize||this.f_bgClipping===0||this.f_spClipping===0){for(y=0;y<240;y++){for(x=0;x<8;x++){buffer[(y<<8)+x]=0}}}if(this.clipToTvSize){for(y=0;y<240;y++){for(x=0;x<8;x++){buffer[(y<<8)+255-x]=0}}}if(this.clipToTvSize){for(y=0;y<8;y++){for(x=0;x<256;x++){buffer[(y<<8)+x]=0;buffer[(239-y<<8)+x]=0}}}if(this.nes.opts.showDisplay){this.nes.ui.writeFrame(buffer,this.prevBuffer)}},updateControlReg1:function(value){this.triggerRendering();this.f_nmiOnVblank=value>>7&1;this.f_spriteSize=value>>5&1;this.f_bgPatternTable=value>>4&1;this.f_spPatternTable=value>>3&1;this.f_addrInc=value>>2&1;this.f_nTblAddress=value&3;this.regV=value>>1&1;this.regH=value&1;this.regS=value>>4&1},updateControlReg2:function(value){this.triggerRendering();this.f_color=value>>5&7;this.f_spVisibility=value>>4&1;this.f_bgVisibility=value>>3&1;this.f_spClipping=value>>2&1;this.f_bgClipping=value>>1&1;this.f_dispType=value&1;if(this.f_dispType===0){this.palTable.setEmphasis(this.f_color)}this.updatePalettes()},setStatusFlag:function(flag,value){var n=1<<flag;this.nes.cpu.mem[8194]=this.nes.cpu.mem[8194]&255-n|(value?n:0)},readStatusRegister:function(){var tmp=this.nes.cpu.mem[8194];this.firstWrite=true;this.setStatusFlag(this.STATUS_VBLANK,false);return tmp},writeSRAMAddress:function(address){this.sramAddress=address},sramLoad:function(){return this.spriteMem[this.sramAddress]},sramWrite:function(value){this.spriteMem[this.sramAddress]=value;this.spriteRamWriteUpdate(this.sramAddress,value);this.sramAddress++;this.sramAddress%=256},scrollWrite:function(value){this.triggerRendering();if(this.firstWrite){this.regHT=value>>3&31;this.regFH=value&7}else{this.regFV=value&7;this.regVT=value>>3&31}this.firstWrite=!this.firstWrite},writeVRAMAddress:function(address){if(this.firstWrite){this.regFV=address>>4&3;this.regV=address>>3&1;this.regH=address>>2&1;this.regVT=this.regVT&7|(address&3)<<3}else{this.triggerRendering();this.regVT=this.regVT&24|address>>5&7;this.regHT=address&31;this.cntFV=this.regFV;this.cntV=this.regV;this.cntH=this.regH;this.cntVT=this.regVT;this.cntHT=this.regHT;this.checkSprite0(this.scanline-20)}this.firstWrite=!this.firstWrite;this.cntsToAddress();if(this.vramAddress<8192){this.nes.mmap.latchAccess(this.vramAddress)}},vramLoad:function(){var tmp;this.cntsToAddress();this.regsToAddress();if(this.vramAddress<=16127){tmp=this.vramBufferedReadValue;if(this.vramAddress<8192){this.vramBufferedReadValue=this.vramMem[this.vramAddress]}else{this.vramBufferedReadValue=this.mirroredLoad(this.vramAddress)}if(this.vramAddress<8192){this.nes.mmap.latchAccess(this.vramAddress)}this.vramAddress+=this.f_addrInc==1?32:1;this.cntsFromAddress();this.regsFromAddress();return tmp}tmp=this.mirroredLoad(this.vramAddress);this.vramAddress+=this.f_addrInc==1?32:1;this.cntsFromAddress();this.regsFromAddress();return tmp},vramWrite:function(value){this.triggerRendering();this.cntsToAddress();this.regsToAddress();if(this.vramAddress>=8192){this.mirroredWrite(this.vramAddress,value)}else{this.writeMem(this.vramAddress,value);this.nes.mmap.latchAccess(this.vramAddress)}this.vramAddress+=this.f_addrInc==1?32:1;this.regsFromAddress();this.cntsFromAddress()},sramDMA:function(value){var baseAddress=value*256;var data;for(var i=this.sramAddress;i<256;i++){data=this.nes.cpu.mem[baseAddress+i];this.spriteMem[i]=data;this.spriteRamWriteUpdate(i,data)}this.nes.cpu.haltCycles(513)},regsFromAddress:function(){var address=this.vramTmpAddress>>8&255;this.regFV=address>>4&7;this.regV=address>>3&1;this.regH=address>>2&1;this.regVT=this.regVT&7|(address&3)<<3;address=this.vramTmpAddress&255;this.regVT=this.regVT&24|address>>5&7;this.regHT=address&31},cntsFromAddress:function(){var address=this.vramAddress>>8&255;this.cntFV=address>>4&3;this.cntV=address>>3&1;this.cntH=address>>2&1;this.cntVT=this.cntVT&7|(address&3)<<3;address=this.vramAddress&255;this.cntVT=this.cntVT&24|address>>5&7;this.cntHT=address&31},regsToAddress:function(){var b1=(this.regFV&7)<<4;b1|=(this.regV&1)<<3;b1|=(this.regH&1)<<2;b1|=this.regVT>>3&3;var b2=(this.regVT&7)<<5;b2|=this.regHT&31;this.vramTmpAddress=(b1<<8|b2)&32767},cntsToAddress:function(){var b1=(this.cntFV&7)<<4;b1|=(this.cntV&1)<<3;b1|=(this.cntH&1)<<2;b1|=this.cntVT>>3&3;var b2=(this.cntVT&7)<<5;b2|=this.cntHT&31;this.vramAddress=(b1<<8|b2)&32767},incTileCounter:function(count){for(var i=count;i!==0;i--){this.cntHT++;if(this.cntHT==32){this.cntHT=0;this.cntVT++;if(this.cntVT>=30){this.cntH++;if(this.cntH==2){this.cntH=0;this.cntV++;if(this.cntV==2){this.cntV=0;this.cntFV++;this.cntFV&=7}}}}}},mirroredLoad:function(address){return this.vramMem[this.vramMirrorTable[address]]},mirroredWrite:function(address,value){if(address>=16128&&address<16160){if(address==16128||address==16144){this.writeMem(16128,value);this.writeMem(16144,value)}else if(address==16132||address==16148){this.writeMem(16132,value);this.writeMem(16148,value)}else if(address==16136||address==16152){this.writeMem(16136,value);this.writeMem(16152,value)}else if(address==16140||address==16156){this.writeMem(16140,value);this.writeMem(16156,value)}else{this.writeMem(address,value)}}else{if(address<this.vramMirrorTable.length){this.writeMem(this.vramMirrorTable[address],value)}else{alert("Invalid VRAM address: "+address.toString(16))}}},triggerRendering:function(){if(this.scanline>=21&&this.scanline<=260){this.renderFramePartially(this.lastRenderedScanline+1,this.scanline-21-this.lastRenderedScanline);this.lastRenderedScanline=this.scanline-21}},renderFramePartially:function(startScan,scanCount){if(this.f_spVisibility==1){this.renderSpritesPartially(startScan,scanCount,true)}if(this.f_bgVisibility==1){var si=startScan<<8;var ei=startScan+scanCount<<8;if(ei>61440){ei=61440}var buffer=this.buffer;var bgbuffer=this.bgbuffer;var pixrendered=this.pixrendered;for(var destIndex=si;destIndex<ei;destIndex++){if(pixrendered[destIndex]>255){buffer[destIndex]=bgbuffer[destIndex]}}}if(this.f_spVisibility==1){this.renderSpritesPartially(startScan,scanCount,false)}this.validTileData=false},renderBgScanline:function(bgbuffer,scan){var baseTile=this.regS===0?0:256;var destIndex=(scan<<8)-this.regFH;this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH];this.cntHT=this.regHT;this.cntH=this.regH;this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH];if(scan<240&&scan-this.cntFV>=0){var tscanoffset=this.cntFV<<3;var scantile=this.scantile;var attrib=this.attrib;var ptTile=this.ptTile;var nameTable=this.nameTable;var imgPalette=this.imgPalette;var pixrendered=this.pixrendered;var targetBuffer=bgbuffer?this.bgbuffer:this.buffer;var t,tpix,att,col;for(var tile=0;tile<32;tile++){if(scan>=0){if(this.validTileData){t=scantile[tile];if(typeof t==="undefined"){continue}tpix=t.pix;att=attrib[tile]}else{t=ptTile[baseTile+nameTable[this.curNt].getTileIndex(this.cntHT,this.cntVT)];if(typeof t==="undefined"){continue}tpix=t.pix;att=nameTable[this.curNt].getAttrib(this.cntHT,this.cntVT);scantile[tile]=t;attrib[tile]=att}var sx=0;var x=(tile<<3)-this.regFH;if(x>-8){if(x<0){destIndex-=x;sx=-x}if(t.opaque[this.cntFV]){for(;sx<8;sx++){targetBuffer[destIndex]=imgPalette[tpix[tscanoffset+sx]+att];pixrendered[destIndex]|=256;destIndex++}}else{for(;sx<8;sx++){col=tpix[tscanoffset+sx];if(col!==0){targetBuffer[destIndex]=imgPalette[col+att];pixrendered[destIndex]|=256}destIndex++}}}}if(++this.cntHT==32){this.cntHT=0;this.cntH++;this.cntH%=2;this.curNt=this.ntable1[(this.cntV<<1)+this.cntH]}}this.validTileData=true}this.cntFV++;if(this.cntFV==8){this.cntFV=0;this.cntVT++;if(this.cntVT==30){this.cntVT=0;this.cntV++;this.cntV%=2;this.curNt=this.ntable1[(this.cntV<<1)+this.cntH]}else if(this.cntVT==32){this.cntVT=0}this.validTileData=false}},renderSpritesPartially:function(startscan,scancount,bgPri){if(this.f_spVisibility===1){for(var i=0;i<64;i++){if(this.bgPriority[i]==bgPri&&this.sprX[i]>=0&&this.sprX[i]<256&&this.sprY[i]+8>=startscan&&this.sprY[i]<startscan+scancount){if(this.f_spriteSize===0){this.srcy1=0;this.srcy2=8;if(this.sprY[i]<startscan){this.srcy1=startscan-this.sprY[i]-1}if(this.sprY[i]+8>startscan+scancount){this.srcy2=startscan+scancount-this.sprY[i]+1}if(this.f_spPatternTable===0){this.ptTile[this.sprTile[i]].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[i],this.sprY[i]+1,this.sprCol[i],this.sprPalette,this.horiFlip[i],this.vertFlip[i],i,this.pixrendered)}else{this.ptTile[this.sprTile[i]+256].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[i],this.sprY[i]+1,this.sprCol[i],this.sprPalette,this.horiFlip[i],this.vertFlip[i],i,this.pixrendered)}}else{var top=this.sprTile[i];if((top&1)!==0){top=this.sprTile[i]-1+256}var srcy1=0;var srcy2=8;if(this.sprY[i]<startscan){srcy1=startscan-this.sprY[i]-1}if(this.sprY[i]+8>startscan+scancount){srcy2=startscan+scancount-this.sprY[i]}this.ptTile[top+(this.vertFlip[i]?1:0)].render(this.buffer,0,srcy1,8,srcy2,this.sprX[i],this.sprY[i]+1,this.sprCol[i],this.sprPalette,this.horiFlip[i],this.vertFlip[i],i,this.pixrendered);srcy1=0;srcy2=8;if(this.sprY[i]+8<startscan){srcy1=startscan-(this.sprY[i]+8+1)}if(this.sprY[i]+16>startscan+scancount){srcy2=startscan+scancount-(this.sprY[i]+8)}this.ptTile[top+(this.vertFlip[i]?0:1)].render(this.buffer,0,srcy1,8,srcy2,this.sprX[i],this.sprY[i]+1+8,this.sprCol[i],this.sprPalette,this.horiFlip[i],this.vertFlip[i],i,this.pixrendered)}}}}},checkSprite0:function(scan){this.spr0HitX=-1;this.spr0HitY=-1;var toffset;var tIndexAdd=this.f_spPatternTable===0?0:256;var x,y,t,i;var bufferIndex;var col;var bgPri;x=this.sprX[0];y=this.sprY[0]+1;if(this.f_spriteSize===0){if(y<=scan&&y+8>scan&&x>=-7&&x<256){t=this.ptTile[this.sprTile[0]+tIndexAdd];col=this.sprCol[0];bgPri=this.bgPriority[0];if(this.vertFlip[0]){toffset=7-(scan-y)}else{toffset=scan-y}toffset*=8;bufferIndex=scan*256+x;if(this.horiFlip[0]){for(i=7;i>=0;i--){if(x>=0&&x<256){if(bufferIndex>=0&&bufferIndex<61440&&this.pixrendered[bufferIndex]!==0){if(t.pix[toffset+i]!==0){this.spr0HitX=bufferIndex%256;this.spr0HitY=scan;return true}}}x++;bufferIndex++}}else{for(i=0;i<8;i++){if(x>=0&&x<256){if(bufferIndex>=0&&bufferIndex<61440&&this.pixrendered[bufferIndex]!==0){if(t.pix[toffset+i]!==0){this.spr0HitX=bufferIndex%256;this.spr0HitY=scan;return true}}}x++;bufferIndex++}}}}else{if(y<=scan&&y+16>scan&&x>=-7&&x<256){if(this.vertFlip[0]){toffset=15-(scan-y)}else{toffset=scan-y}if(toffset<8){t=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?1:0)+((this.sprTile[0]&1)!==0?255:0)]}else{t=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?0:1)+((this.sprTile[0]&1)!==0?255:0)];if(this.vertFlip[0]){toffset=15-toffset}else{toffset-=8}}toffset*=8;col=this.sprCol[0];bgPri=this.bgPriority[0];bufferIndex=scan*256+x;if(this.horiFlip[0]){for(i=7;i>=0;i--){if(x>=0&&x<256){if(bufferIndex>=0&&bufferIndex<61440&&this.pixrendered[bufferIndex]!==0){if(t.pix[toffset+i]!==0){this.spr0HitX=bufferIndex%256;this.spr0HitY=scan;return true}}}x++;bufferIndex++}}else{for(i=0;i<8;i++){if(x>=0&&x<256){if(bufferIndex>=0&&bufferIndex<61440&&this.pixrendered[bufferIndex]!==0){if(t.pix[toffset+i]!==0){this.spr0HitX=bufferIndex%256;this.spr0HitY=scan;return true}}}x++;bufferIndex++}}}}return false},writeMem:function(address,value){this.vramMem[address]=value;if(address<8192){this.vramMem[address]=value;this.patternWrite(address,value)}else if(address>=8192&&address<9152){this.nameTableWrite(this.ntable1[0],address-8192,value)}else if(address>=9152&&address<9216){this.attribTableWrite(this.ntable1[0],address-9152,value)}else if(address>=9216&&address<10176){this.nameTableWrite(this.ntable1[1],address-9216,value)}else if(address>=10176&&address<10240){this.attribTableWrite(this.ntable1[1],address-10176,value)}else if(address>=10240&&address<11200){this.nameTableWrite(this.ntable1[2],address-10240,value)}else if(address>=11200&&address<11264){this.attribTableWrite(this.ntable1[2],address-11200,value)}else if(address>=11264&&address<12224){this.nameTableWrite(this.ntable1[3],address-11264,value)}else if(address>=12224&&address<12288){this.attribTableWrite(this.ntable1[3],address-12224,value)}else if(address>=16128&&address<16160){this.updatePalettes()}},updatePalettes:function(){var i;for(i=0;i<16;i++){if(this.f_dispType===0){this.imgPalette[i]=this.palTable.getEntry(this.vramMem[16128+i]&63)}else{this.imgPalette[i]=this.palTable.getEntry(this.vramMem[16128+i]&32)}}for(i=0;i<16;i++){if(this.f_dispType===0){this.sprPalette[i]=this.palTable.getEntry(this.vramMem[16144+i]&63)}else{this.sprPalette[i]=this.palTable.getEntry(this.vramMem[16144+i]&32)}}},patternWrite:function(address,value){var tileIndex=Math.floor(address/16);var leftOver=address%16;if(leftOver<8){this.ptTile[tileIndex].setScanline(leftOver,value,this.vramMem[address+8])}else{this.ptTile[tileIndex].setScanline(leftOver-8,this.vramMem[address-8],value)}},nameTableWrite:function(index,address,value){this.nameTable[index].tile[address]=value;this.checkSprite0(this.scanline-20)},attribTableWrite:function(index,address,value){this.nameTable[index].writeAttrib(address,value)},spriteRamWriteUpdate:function(address,value){var tIndex=Math.floor(address/4);if(tIndex===0){this.checkSprite0(this.scanline-20)}if(address%4===0){this.sprY[tIndex]=value}else if(address%4==1){this.sprTile[tIndex]=value}else if(address%4==2){this.vertFlip[tIndex]=(value&128)!==0;this.horiFlip[tIndex]=(value&64)!==0;this.bgPriority[tIndex]=(value&32)!==0;this.sprCol[tIndex]=(value&3)<<2}else if(address%4==3){this.sprX[tIndex]=value}},doNMI:function(){this.setStatusFlag(this.STATUS_VBLANK,true);this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI)},JSON_PROPERTIES:["vramMem","spriteMem","cntFV","cntV","cntH","cntVT","cntHT","regFV","regV","regH","regVT","regHT","regFH","regS","vramAddress","vramTmpAddress","f_nmiOnVblank","f_spriteSize","f_bgPatternTable","f_spPatternTable","f_addrInc","f_nTblAddress","f_color","f_spVisibility","f_bgVisibility","f_spClipping","f_bgClipping","f_dispType","vramBufferedReadValue","firstWrite","currentMirroring","vramMirrorTable","ntable1","sramAddress","hitSpr0","sprPalette","imgPalette","curX","scanline","lastRenderedScanline","curNt","scantile","attrib","buffer","bgbuffer","pixrendered","requestEndFrame","nmiOk","dummyCycleToggle","nmiCounter","validTileData","scanlineAlreadyRendered"],toJSON:function(){var i;var state=JSNES.Utils.toJSON(this);state.nameTable=[];for(i=0;i<this.nameTable.length;i++){state.nameTable[i]=this.nameTable[i].toJSON()}state.ptTile=[];for(i=0;i<this.ptTile.length;i++){state.ptTile[i]=this.ptTile[i].toJSON()}return state},fromJSON:function(state){var i;JSNES.Utils.fromJSON(this,state);for(i=0;i<this.nameTable.length;i++){this.nameTable[i].fromJSON(state.nameTable[i])}for(i=0;i<this.ptTile.length;i++){this.ptTile[i].fromJSON(state.ptTile[i])}for(i=0;i<this.spriteMem.length;i++){this.spriteRamWriteUpdate(i,this.spriteMem[i])}}};JSNES.PPU.NameTable=function(width,height,name){this.width=width;this.height=height;this.name=name;this.tile=new Array(width*height);this.attrib=new Array(width*height);for(i=0;i<width*height;i++){this.tile[i]=0;this.attrib[i]=0}};JSNES.PPU.NameTable.prototype={getTileIndex:function(x,y){return this.tile[y*this.width+x]},getAttrib:function(x,y){return this.attrib[y*this.width+x]},writeAttrib:function(index,value){var basex=index%8*4;var basey=Math.floor(index/8)*4;var add;var tx,ty;var attindex;for(var sqy=0;sqy<2;sqy++){for(var sqx=0;sqx<2;sqx++){add=value>>2*(sqy*2+sqx)&3;for(var y=0;y<2;y++){for(var x=0;x<2;x++){tx=basex+sqx*2+x;ty=basey+sqy*2+y;attindex=ty*this.width+tx;this.attrib[ty*this.width+tx]=add<<2&12}}}}},toJSON:function(){return{tile:this.tile,attrib:this.attrib}},fromJSON:function(s){this.tile=s.tile;this.attrib=s.attrib}};JSNES.PPU.PaletteTable=function(){this.curTable=new Array(64);this.emphTable=new Array(8);this.currentEmph=-1};JSNES.PPU.PaletteTable.prototype={reset:function(){this.setEmphasis(0)},loadNTSCPalette:function(){
this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0];this.makeTables();this.setEmphasis(0)},loadPALPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0];this.makeTables();this.setEmphasis(0)},makeTables:function(){var r,g,b,col,i,rFactor,gFactor,bFactor;for(var emph=0;emph<8;emph++){rFactor=1;gFactor=1;bFactor=1;if((emph&1)!==0){rFactor=.75;bFactor=.75}if((emph&2)!==0){rFactor=.75;gFactor=.75}if((emph&4)!==0){gFactor=.75;bFactor=.75}this.emphTable[emph]=new Array(64);for(i=0;i<64;i++){col=this.curTable[i];r=Math.floor(this.getRed(col)*rFactor);g=Math.floor(this.getGreen(col)*gFactor);b=Math.floor(this.getBlue(col)*bFactor);this.emphTable[emph][i]=this.getRgb(r,g,b)}}},setEmphasis:function(emph){if(emph!=this.currentEmph){this.currentEmph=emph;for(var i=0;i<64;i++){this.curTable[i]=this.emphTable[emph][i]}}},getEntry:function(yiq){return this.curTable[yiq]},getRed:function(rgb){return rgb>>16&255},getGreen:function(rgb){return rgb>>8&255},getBlue:function(rgb){return rgb&255},getRgb:function(r,g,b){return r<<16|g<<8|b},loadDefaultPalette:function(){this.curTable[0]=this.getRgb(117,117,117);this.curTable[1]=this.getRgb(39,27,143);this.curTable[2]=this.getRgb(0,0,171);this.curTable[3]=this.getRgb(71,0,159);this.curTable[4]=this.getRgb(143,0,119);this.curTable[5]=this.getRgb(171,0,19);this.curTable[6]=this.getRgb(167,0,0);this.curTable[7]=this.getRgb(127,11,0);this.curTable[8]=this.getRgb(67,47,0);this.curTable[9]=this.getRgb(0,71,0);this.curTable[10]=this.getRgb(0,81,0);this.curTable[11]=this.getRgb(0,63,23);this.curTable[12]=this.getRgb(27,63,95);this.curTable[13]=this.getRgb(0,0,0);this.curTable[14]=this.getRgb(0,0,0);this.curTable[15]=this.getRgb(0,0,0);this.curTable[16]=this.getRgb(188,188,188);this.curTable[17]=this.getRgb(0,115,239);this.curTable[18]=this.getRgb(35,59,239);this.curTable[19]=this.getRgb(131,0,243);this.curTable[20]=this.getRgb(191,0,191);this.curTable[21]=this.getRgb(231,0,91);this.curTable[22]=this.getRgb(219,43,0);this.curTable[23]=this.getRgb(203,79,15);this.curTable[24]=this.getRgb(139,115,0);this.curTable[25]=this.getRgb(0,151,0);this.curTable[26]=this.getRgb(0,171,0);this.curTable[27]=this.getRgb(0,147,59);this.curTable[28]=this.getRgb(0,131,139);this.curTable[29]=this.getRgb(0,0,0);this.curTable[30]=this.getRgb(0,0,0);this.curTable[31]=this.getRgb(0,0,0);this.curTable[32]=this.getRgb(255,255,255);this.curTable[33]=this.getRgb(63,191,255);this.curTable[34]=this.getRgb(95,151,255);this.curTable[35]=this.getRgb(167,139,253);this.curTable[36]=this.getRgb(247,123,255);this.curTable[37]=this.getRgb(255,119,183);this.curTable[38]=this.getRgb(255,119,99);this.curTable[39]=this.getRgb(255,155,59);this.curTable[40]=this.getRgb(243,191,63);this.curTable[41]=this.getRgb(131,211,19);this.curTable[42]=this.getRgb(79,223,75);this.curTable[43]=this.getRgb(88,248,152);this.curTable[44]=this.getRgb(0,235,219);this.curTable[45]=this.getRgb(0,0,0);this.curTable[46]=this.getRgb(0,0,0);this.curTable[47]=this.getRgb(0,0,0);this.curTable[48]=this.getRgb(255,255,255);this.curTable[49]=this.getRgb(171,231,255);this.curTable[50]=this.getRgb(199,215,255);this.curTable[51]=this.getRgb(215,203,255);this.curTable[52]=this.getRgb(255,199,255);this.curTable[53]=this.getRgb(255,199,219);this.curTable[54]=this.getRgb(255,191,179);this.curTable[55]=this.getRgb(255,219,171);this.curTable[56]=this.getRgb(255,231,163);this.curTable[57]=this.getRgb(227,255,163);this.curTable[58]=this.getRgb(171,243,191);this.curTable[59]=this.getRgb(179,255,207);this.curTable[60]=this.getRgb(159,255,243);this.curTable[61]=this.getRgb(0,0,0);this.curTable[62]=this.getRgb(0,0,0);this.curTable[63]=this.getRgb(0,0,0);this.makeTables();this.setEmphasis(0)}};JSNES.PPU.Tile=function(){this.pix=new Array(64);this.fbIndex=null;this.tIndex=null;this.x=null;this.y=null;this.w=null;this.h=null;this.incX=null;this.incY=null;this.palIndex=null;this.tpri=null;this.c=null;this.initialized=false;this.opaque=new Array(8)};JSNES.PPU.Tile.prototype={setBuffer:function(scanline){for(this.y=0;this.y<8;this.y++){this.setScanline(this.y,scanline[this.y],scanline[this.y+8])}},setScanline:function(sline,b1,b2){this.initialized=true;this.tIndex=sline<<3;for(this.x=0;this.x<8;this.x++){this.pix[this.tIndex+this.x]=(b1>>7-this.x&1)+((b2>>7-this.x&1)<<1);if(this.pix[this.tIndex+this.x]===0){this.opaque[sline]=false}}},render:function(buffer,srcx1,srcy1,srcx2,srcy2,dx,dy,palAdd,palette,flipHorizontal,flipVertical,pri,priTable){if(dx<-7||dx>=256||dy<-7||dy>=240){return}this.w=srcx2-srcx1;this.h=srcy2-srcy1;if(dx<0){srcx1-=dx}if(dx+srcx2>=256){srcx2=256-dx}if(dy<0){srcy1-=dy}if(dy+srcy2>=240){srcy2=240-dy}if(!flipHorizontal&&!flipVertical){this.fbIndex=(dy<<8)+dx;this.tIndex=0;for(this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++){if(this.x>=srcx1&&this.x<srcx2&&this.y>=srcy1&&this.y<srcy2){this.palIndex=this.pix[this.tIndex];this.tpri=priTable[this.fbIndex];if(this.palIndex!==0&&pri<=(this.tpri&255)){buffer[this.fbIndex]=palette[this.palIndex+palAdd];this.tpri=this.tpri&3840|pri;priTable[this.fbIndex]=this.tpri}}this.fbIndex++;this.tIndex++}this.fbIndex-=8;this.fbIndex+=256}}else if(flipHorizontal&&!flipVertical){this.fbIndex=(dy<<8)+dx;this.tIndex=7;for(this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++){if(this.x>=srcx1&&this.x<srcx2&&this.y>=srcy1&&this.y<srcy2){this.palIndex=this.pix[this.tIndex];this.tpri=priTable[this.fbIndex];if(this.palIndex!==0&&pri<=(this.tpri&255)){buffer[this.fbIndex]=palette[this.palIndex+palAdd];this.tpri=this.tpri&3840|pri;priTable[this.fbIndex]=this.tpri}}this.fbIndex++;this.tIndex--}this.fbIndex-=8;this.fbIndex+=256;this.tIndex+=16}}else if(flipVertical&&!flipHorizontal){this.fbIndex=(dy<<8)+dx;this.tIndex=56;for(this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++){if(this.x>=srcx1&&this.x<srcx2&&this.y>=srcy1&&this.y<srcy2){this.palIndex=this.pix[this.tIndex];this.tpri=priTable[this.fbIndex];if(this.palIndex!==0&&pri<=(this.tpri&255)){buffer[this.fbIndex]=palette[this.palIndex+palAdd];this.tpri=this.tpri&3840|pri;priTable[this.fbIndex]=this.tpri}}this.fbIndex++;this.tIndex++}this.fbIndex-=8;this.fbIndex+=256;this.tIndex-=16}}else{this.fbIndex=(dy<<8)+dx;this.tIndex=63;for(this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++){if(this.x>=srcx1&&this.x<srcx2&&this.y>=srcy1&&this.y<srcy2){this.palIndex=this.pix[this.tIndex];this.tpri=priTable[this.fbIndex];if(this.palIndex!==0&&pri<=(this.tpri&255)){buffer[this.fbIndex]=palette[this.palIndex+palAdd];this.tpri=this.tpri&3840|pri;priTable[this.fbIndex]=this.tpri}}this.fbIndex++;this.tIndex--}this.fbIndex-=8;this.fbIndex+=256}}},isTransparent:function(x,y){return this.pix[(y<<3)+x]===0},toJSON:function(){return{opaque:this.opaque,pix:this.pix}},fromJSON:function(s){this.opaque=s.opaque;this.pix=s.pix}};JSNES.ROM=function(nes){this.nes=nes;this.mapperName=new Array(92);for(var i=0;i<92;i++){this.mapperName[i]="Unknown Mapper"}this.mapperName[0]="Direct Access";this.mapperName[1]="Nintendo MMC1";this.mapperName[2]="UNROM";this.mapperName[3]="CNROM";this.mapperName[4]="Nintendo MMC3";this.mapperName[5]="Nintendo MMC5";this.mapperName[6]="FFE F4xxx";this.mapperName[7]="AOROM";this.mapperName[8]="FFE F3xxx";this.mapperName[9]="Nintendo MMC2";this.mapperName[10]="Nintendo MMC4";this.mapperName[11]="Color Dreams Chip";this.mapperName[12]="FFE F6xxx";this.mapperName[15]="100-in-1 switch";this.mapperName[16]="Bandai chip";this.mapperName[17]="FFE F8xxx";this.mapperName[18]="Jaleco SS8806 chip";this.mapperName[19]="Namcot 106 chip";this.mapperName[20]="Famicom Disk System";this.mapperName[21]="Konami VRC4a";this.mapperName[22]="Konami VRC2a";this.mapperName[23]="Konami VRC2a";this.mapperName[24]="Konami VRC6";this.mapperName[25]="Konami VRC4b";this.mapperName[32]="Irem G-101 chip";this.mapperName[33]="Taito TC0190/TC0350";this.mapperName[34]="32kB ROM switch";this.mapperName[64]="Tengen RAMBO-1 chip";this.mapperName[65]="Irem H-3001 chip";this.mapperName[66]="GNROM switch";this.mapperName[67]="SunSoft3 chip";this.mapperName[68]="SunSoft4 chip";this.mapperName[69]="SunSoft5 FME-7 chip";this.mapperName[71]="Camerica chip";this.mapperName[78]="Irem 74HC161/32-based";this.mapperName[91]="Pirate HK-SF3 chip"};JSNES.ROM.prototype={VERTICAL_MIRRORING:0,HORIZONTAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,SINGLESCREEN_MIRRORING:3,SINGLESCREEN_MIRRORING2:4,SINGLESCREEN_MIRRORING3:5,SINGLESCREEN_MIRRORING4:6,CHRROM_MIRRORING:7,header:null,rom:null,vrom:null,vromTile:null,romCount:null,vromCount:null,mirroring:null,batteryRam:null,trainer:null,fourScreen:null,mapperType:null,valid:false,load:function(data){var i,j,v;if(data.indexOf("NES")===-1){this.nes.ui.updateStatus("Not a valid NES ROM.");return}this.header=new Array(16);for(i=0;i<16;i++){this.header[i]=data.charCodeAt(i)&255}this.romCount=this.header[4];this.vromCount=this.header[5]*2;this.mirroring=(this.header[6]&1)!==0?1:0;this.batteryRam=(this.header[6]&2)!==0;this.trainer=(this.header[6]&4)!==0;this.fourScreen=(this.header[6]&8)!==0;this.mapperType=this.header[6]>>4|this.header[7]&240;var foundError=false;for(i=8;i<16;i++){if(this.header[i]!==0){foundError=true;break}}if(foundError){this.mapperType&=15}this.rom=new Array(this.romCount);var offset=16;for(i=0;i<this.romCount;i++){this.rom[i]=new Array(16384);for(j=0;j<16384;j++){if(offset+j>=data.length){break}this.rom[i][j]=data.charCodeAt(offset+j)&255}offset+=16384}this.vrom=new Array(this.vromCount);for(i=0;i<this.vromCount;i++){this.vrom[i]=new Array(4096);for(j=0;j<4096;j++){if(offset+j>=data.length){break}this.vrom[i][j]=data.charCodeAt(offset+j)&255}offset+=4096}this.vromTile=new Array(this.vromCount);for(i=0;i<this.vromCount;i++){this.vromTile[i]=new Array(256);for(j=0;j<256;j++){this.vromTile[i][j]=new JSNES.PPU.Tile}}var tileIndex;var leftOver;for(v=0;v<this.vromCount;v++){for(i=0;i<4096;i++){tileIndex=i>>4;leftOver=i%16;if(leftOver<8){this.vromTile[v][tileIndex].setScanline(leftOver,this.vrom[v][i],this.vrom[v][i+8])}else{this.vromTile[v][tileIndex].setScanline(leftOver-8,this.vrom[v][i-8],this.vrom[v][i])}}}this.valid=true},getMirroringType:function(){if(this.fourScreen){return this.FOURSCREEN_MIRRORING}if(this.mirroring===0){return this.HORIZONTAL_MIRRORING}return this.VERTICAL_MIRRORING},getMapperName:function(){if(this.mapperType>=0&&this.mapperType<this.mapperName.length){return this.mapperName[this.mapperType]}return"Unknown Mapper, "+this.mapperType},mapperSupported:function(){return typeof JSNES.Mappers[this.mapperType]!=="undefined"},createMapper:function(){if(this.mapperSupported()){return new JSNES.Mappers[this.mapperType](this.nes)}else{this.nes.ui.updateStatus("This ROM uses a mapper not supported by JSNES: "+this.getMapperName()+"("+this.mapperType+")");return null}}};JSNES.DummyUI=function(nes){this.nes=nes;this.enable=function(){};this.updateStatus=function(){};this.writeAudio=function(){};this.writeFrame=function(){}};if(typeof jQuery!=="undefined"){(function($){$.fn.JSNESUI=function(opts){var parent=this;var UI=function(nes){var self=this;self.nes=nes;self.root=$("<div></div>");self.screen=$('<canvas class="nes-screen" width="256" height="240"></canvas>').appendTo(self.root);if(!self.screen[0].getContext){parent.html("Your browser doesn't support the <code>&lt;canvas&gt;</code> tag. Try Google Chrome, Safari, Opera or Firefox!");return}self.romContainer=$('<div class="nes-roms"></div>').appendTo(self.root);self.controls=$('<div class="nes-controls"></div>').appendTo(self.root);self.buttons={pause:$('<input type="button" value="pause" class="nes-pause" disabled="disabled">').appendTo(self.controls),restart:$('<input type="button" value="restart" class="nes-restart" disabled="disabled">').appendTo(self.controls),sound:$('<input type="button" value="disable sound" class="nes-enablesound">').appendTo(self.controls)};self.status=$('<p class="nes-status">Booting up...</p>').appendTo(self.root);self.root.appendTo(parent);self.buttons.pause.click(function(){if(self.nes.isRunning){self.nes.stop();self.updateStatus("Paused");self.buttons.pause.attr("value","resume")}else{self.nes.start();self.buttons.pause.attr("value","pause")}});self.buttons.restart.click(function(){self.nes.reloadRom();self.nes.start()});self.buttons.sound.click(function(){if(self.nes.opts.emulateSound){self.nes.opts.emulateSound=false;self.buttons.sound.attr("value","enable sound")}else{self.nes.opts.emulateSound=true;self.buttons.sound.attr("value","disable sound")}});self.canvasContext=self.screen[0].getContext("2d");if(!self.canvasContext.getImageData){parent.html("Your browser doesn't support writing pixels directly to the <code>&lt;canvas&gt;</code> tag. Try the latest versions of Google Chrome, Safari, Opera or Firefox!");return}self.canvasImageData=self.canvasContext.getImageData(0,0,256,240);self.resetCanvas();$(document).bind("keydown",function(evt){self.nes.keyboard.keyDown(evt)}).bind("keyup",function(evt){self.nes.keyboard.keyUp(evt)}).bind("keypress",function(evt){self.nes.keyboard.keyPress(evt)});self.dynamicaudio=new DynamicAudio;self.loadROM(opts.rom)};UI.prototype={loadROM:function(romPath){var self=this;self.updateStatus("Downloading...");$.ajax({url:escape(romPath),xhr:function(){var xhr=$.ajaxSettings.xhr();if(typeof xhr.overrideMimeType!=="undefined"){xhr.overrideMimeType("text/plain; charset=x-user-defined")}self.xhr=xhr;return xhr},complete:function(xhr,status){var i,data;if(JSNES.Utils.isIE()){var charCodes=JSNESBinaryToArray(xhr.responseBody).toArray();data=String.fromCharCode.apply(undefined,charCodes)}else{data=xhr.responseText}self.nes.loadRom(data);self.nes.start();self.enable()}})},resetCanvas:function(){this.canvasContext.fillStyle="black";this.canvasContext.fillRect(0,0,256,240);for(var i=3;i<this.canvasImageData.data.length-3;i+=4){this.canvasImageData.data[i]=255}},screenshot:function(){var data=this.screen[0].toDataURL("image/png"),img=new Image;img.src=data;return img},enable:function(){this.buttons.pause.attr("disabled",null);if(this.nes.isRunning){this.buttons.pause.attr("value","pause")}else{this.buttons.pause.attr("value","resume")}this.buttons.restart.attr("disabled",null);if(this.nes.opts.emulateSound){this.buttons.sound.attr("value","disable sound")}else{this.buttons.sound.attr("value","enable sound")}},updateStatus:function(s){this.status.text("")},writeAudio:function(samples){return this.dynamicaudio.writeInt(samples)},writeFrame:function(buffer,prevBuffer){var imageData=this.canvasImageData.data;var pixel,i,j;for(i=0;i<256*240;i++){pixel=buffer[i];if(pixel!=prevBuffer[i]){j=i*4;imageData[j]=pixel&255;imageData[j+1]=pixel>>8&255;imageData[j+2]=pixel>>16&255;prevBuffer[i]=pixel}}this.canvasContext.putImageData(this.canvasImageData,0,0)}};return UI}})(jQuery)}
